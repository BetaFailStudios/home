const music = {
    "Haunted Armory": [
        {
            file: new Audio('Cubic Battles.mp3'),
            bpm: 135,            //loops, offset
            bpb: 8,
            attacklist: JSON.parse(
                `[[0,"a1"],[0.375,"a1"],[0.5,"a1"],[1,"a1"],[1.375,"a1"],[1.5,"a1"],[1.875,"a1"],[2,"a1"],[2.375,"a1"],[2.5,"a1"],[2.875,"a1"],[3,"a1"],[3.375,"a1"],[3.5,"a1"],[3.875,"a1"],[3.90625,"a1"],[3.9375,"a1"],[3.96875,"a1"],[4,"a2"],[4.125,"a1"],[4.15625,"a1"],[4.1875,"a1"],[4.21875,"a2"],[4.375,"a1"],[4.40625,"a1"],[4.5,"a2"],[4.625,"a1"],[4.65625,"a1"],[4.6875,"a1"],[4.71875,"a2"],[4.875,"a1"],[4.90625,"a1"],[4.9375,"a1"],[4.96875,"a1"],[5,"a2"],[5.125,"a1"],[5.15625,"a1"],[5.1875,"a1"],[5.21875,"a2"],[5.34375,"a1"],[5.375,"a1"],[5.40625,"a1"],[5.4375,"a1"],[5.46875,"a1"],[5.5,"a3"],[5.59375,"a2"],[5.9375,"a1"],[5.953125,"a1"],[5.96875,"a1"],[5.984375,"a1"],[6,"a2"],[6.125,"a1"],[6.15625,"a1"],[6.1875,"a1"],[6.21875,"a2"],[6.375,"a1"],[6.40625,"a1"],[6.46875,"a1"],[6.5,"a2"],[6.625,"a1"],[6.65625,"a1"],[6.6875,"a1"],[6.71875,"a2"],[6.875,"a1"],[6.90625,"a1"],[6.9375,"a1"],[6.96875,"a1"],[7,"a2"],[7.125,"a1"],[7.15625,"a1"],[7.1875,"a1"],[7.21875,"a3"],[7.34375,"a1"],[7.375,"a1"],[7.40625,"a1"],[7.4375,"a1"],[7.46875,"a1"],[7.5,"a3"],[7.875,"a2"],[7.9375,"a1"],[7.96875,"a1"],[8,"a3"],[8.5,"a3"],[9,"a3"],[9.5,"a3"],[9.75,"a3"],[9.8125,"a3"],[9.875,"a3"],[9.9375,"a3"],[10,"a3"],[10.5,"a3"],[11,"a3"],[11.5,"a3"],[11.75,"a3"],[11.8125,"a3"],[11.875,"a3"],[11.9375,"a3"],[12.25,"a1"],[12.4375,"a1"],[12.5625,"a1"],[13.0625,"a1"],[13.125,"a1"],[13.25,"a1"],[13.3125,"a1"],[13.4375,"a1"],[13.5625,"a1"],[13.75,"a3"],[13.8125,"a3"],[13.875,"a3"],[13.9375,"a3"],[14.0625,"a1"],[14.125,"a1"],[14.25,"a1"],[14.3125,"a1"],[14.4375,"a1"],[14.5625,"a1"],[14.625,"a1"],[14.75,"a1"],[14.8125,"a1"],[14.9375,"a1"],[15.0625,"a1"],[15.4375,"a1"],[15.5625,"a1"],[15.75,"a1"],[15.9375,"a1"],[12.625,"a1"],[12.75,"a1"],[12.8125,"a1"],[12.9375,"a1"],[15,"a1"],[15.1875,"a1"],[15.25,"a1"],[15.375,"a1"],[15.5,"a1"],[15.6875,"a1"],[15.875,"a1"],[12,"a1"],[12.1875,"a1"],[12.375,"a1"],[12.125,"a1"],[12.5,"a1"],[12.6875,"a1"],[12.875,"a1"],[13,"a1"],[12.0625,"a1"],[12.125,"a2"],[12.625,"a2"],[12.8125,"a2"],[13.125,"a2"],[13.1875,"a1"],[13.3125,"a2"],[13.375,"a1"],[13.5,"a1"],[13.625,"a1"],[13.625,"a2"],[13.6875,"a1"],[14,"a1"],[14.1875,"a1"],[14.375,"a1"],[14.5,"a1"],[14.6875,"a1"],[14.875,"a1"],[14.125,"a2"],[14.3125,"a2"],[14.625,"a2"],[14.8125,"a2"],[15.125,"a1"],[15.3125,"a1"],[15.625,"a1"],[15.8125,"a1"],[15.125,"a2"],[15.3125,"a2"],[15.625,"a2"],[15.8125,"a2"],[7.59375,"a2"],[4.46875,"a1"],[5.875,"a1"],[16.21875,"a1"],[16.25,"a1"],[16.28125,"a1"],[16.34375,"a1"],[16.40625,"a1"],[16.46875,"a1"],[16.625,"a1"],[16.65625,"a1"],[16.5,"a2"],[16.71875,"a2"],[16.84375,"a1"],[16.875,"a1"],[16.90625,"a1"],[16.9375,"a1"],[16.96875,"a1"],[17,"a2"],[17.125,"a1"],[17.15625,"a1"],[17.21875,"a1"],[17.28125,"a2"],[17.375,"a1"],[17.40625,"a1"],[17.4375,"a1"],[17.46875,"a1"],[17.625,"a1"],[17.65625,"a1"],[17.71875,"a1"],[17.78125,"a2"],[17.875,"a1"],[17.90625,"a1"],[17.9375,"a1"],[17.96875,"a1"],[18.1875,"a1"],[18.25,"a2"],[18,"a3"],[18.375,"a1"],[18.40625,"a1"],[18.46875,"a2"],[18.5625,"a1"],[18.625,"a1"],[18.65625,"a1"],[18.71875,"a2"],[18.3125,"a1"],[18.84375,"a1"],[18.875,"a1"],[18.90625,"a1"],[18.9375,"a1"],[18.96875,"a1"],[19.125,"a1"],[19.15625,"a1"],[19.21875,"a1"],[19.28125,"a2"],[19.375,"a1"],[19.40625,"a1"],[19.4375,"a1"],[19.46875,"a1"],[19.5,"a3"],[19.625,"a1"],[19.65625,"a1"],[19.71875,"a1"],[19.78125,"a2"],[19.875,"a1"],[19.90625,"a1"],[19.9375,"a1"],[19.96875,"a1"],[20,"a3"],[20.21875,"a1"],[20.25,"a1"],[20.28125,"a1"],[20.34375,"a1"],[20.40625,"a1"],[20.46875,"a1"],[20.5,"a2"],[20.53125,"a1"],[20.59375,"a1"],[20.65625,"a1"],[20.71875,"a1"],[20.75,"a2"],[20.78125,"a1"],[20.84375,"a1"],[20.90625,"a1"],[20.96875,"a1"],[21,"a2"],[21.09375,"a1"],[21.15625,"a1"],[21.21875,"a1"],[21.25,"a2"],[21.28125,"a1"],[21.3125,"a1"],[21.34375,"a1"],[21.375,"a1"],[21.4375,"a1"],[21.46875,"a1"],[21.53125,"a1"],[21.5625,"a1"],[21.625,"a1"],[21.65625,"a1"],[21.71875,"a1"],[21.75,"a1"],[21.8125,"a1"],[21.84375,"a1"],[21.875,"a1"],[21.90625,"a1"],[21.9375,"a1"],[21.96875,"a1"],[22,"a3"],[22.125,"a1"],[22.15625,"a1"],[22.21875,"a1"],[22.28125,"a2"],[22.375,"a1"],[22.40625,"a1"],[22.4375,"a1"],[22.46875,"a1"],[22.5,"a2"],[22.625,"a1"],[22.65625,"a1"],[22.71875,"a1"],[22.78125,"a2"],[22.875,"a1"],[22.90625,"a1"],[22.9375,"a1"],[22.96875,"a1"],[23,"a3"],[23.125,"a1"],[23.15625,"a1"],[23.21875,"a1"],[23.28125,"a2"],[23.375,"a1"],[23.40625,"a1"],[23.4375,"a1"],[23.46875,"a1"],[23.5,"a2"],[23.625,"a1"],[23.65625,"a1"],[23.71875,"a1"],[23.78125,"a2"],[23.875,"a1"],[23.90625,"a1"],[23.9375,"a1"],[23.96875,"a1"],[24.125,"a1"],[24.15625,"a1"],[24.21875,"a2"],[24.375,"a1"],[24.40625,"a1"],[24.4375,"a1"],[24.46875,"a1"],[24.5,"a2"],[24.5625,"a1"],[24.625,"a1"],[24.65625,"a1"],[24.71875,"a3"],[24.8125,"a3"],[24.90625,"a3"],[25,"a2"],[25.125,"a1"],[25.15625,"a1"],[25.21875,"a2"],[25.34375,"a1"],[25.375,"a1"],[25.40625,"a1"],[25.4375,"a1"],[25.46875,"a1"],[25.625,"a1"],[25.65625,"a1"],[25.71875,"a3"],[25.84375,"a3"],[25.5,"a2"],[25.921875,"a3"],[26,"a2"],[26.125,"a1"],[26.15625,"a1"],[26.21875,"a2"],[26.3125,"a1"],[26.375,"a1"],[26.4375,"a1"],[26.5,"a1"],[26.53125,"a1"],[26.5625,"a1"],[26.59375,"a1"],[26.625,"a1"],[26.65625,"a1"],[26.71875,"a3"],[26.8125,"a3"],[26.921875,"a3"],[27,"a2"],[27.125,"a1"],[27.15625,"a1"],[27.21875,"a2"],[27.3125,"a1"],[27.375,"a1"],[27.4375,"a1"],[27.5,"a2"],[27.625,"a3"],[27.71875,"a3"],[27.8125,"a3"],[27.90625,"a3"],[28,"a3"],[28,"a1"],[0.1875,"a1"],[0.28125,"a1"],[0.3125,"a1"],[0.34375,"a1"],[0.390625,"a1"],[0.125,"a3"],[0,"a2"],[0.5,"a2"],[0.625,"a3"],[0.40625,"a1"],[0.46875,"a1"],[0.6875,"a1"],[0.78125,"a1"],[0.8125,"a1"],[0.84375,"a1"],[0.890625,"a1"],[0.875,"a1"],[0.9375,"a1"],[1.1875,"a1"],[1.28125,"a1"],[1.3125,"a1"],[1.34375,"a1"],[1.40625,"a1"],[1.390625,"a1"],[1.46875,"a1"],[1.5,"a2"],[1,"a2"],[1.125,"a3"],[1.625,"a3"],[1.6875,"a1"],[1.78125,"a1"],[1.8125,"a1"],[1.84375,"a1"],[1.90625,"a1"],[1.9375,"a1"],[1.96875,"a1"],[2,"a2"],[2.125,"a3"],[2.1875,"a1"],[2.28125,"a1"],[2.3125,"a1"],[2.34375,"a1"],[2.390625,"a1"],[2.40625,"a1"],[2.5,"a2"],[2.6875,"a1"],[2.78125,"a1"],[2.8125,"a1"],[2.84375,"a1"],[2.890625,"a1"],[2.9375,"a1"],[3.1875,"a1"],[3.28125,"a1"],[3.3125,"a1"],[3.34375,"a1"],[3.390625,"a1"],[3.40625,"a1"],[3.6875,"a1"],[3.78125,"a1"],[3.8125,"a1"],[3.84375,"a1"],[3.5,"a2"],[3,"a2"],[3.125,"a3"],[3.625,"a3"],[2.625,"a3"],[4,"a1"],[4.21875,"a1"],[4.5,"a1"],[4.71875,"a1"],[5,"a1"],[5.21875,"a1"],[5.5,"a1"],[5.59375,"a1"],[6,"a1"],[6.21875,"a1"],[6.5,"a1"],[6.71875,"a1"],[7,"a1"],[7.21875,"a1"],[7.5,"a1"],[7.59375,"a1"],[7.875,"a1"],[8,"a1"],[8.125,"a2"],[8.1875,"a1"],[8.28125,"a1"],[8.3125,"a1"],[8.34375,"a1"],[8.375,"a1"],[8.390625,"a1"],[8.40625,"a1"],[8.5,"a1"],[8.6875,"a1"],[8.78125,"a1"],[8.8125,"a1"],[8.84375,"a1"],[8.875,"a1"],[8.890625,"a1"],[8.625,"a2"],[8.9375,"a1"],[9,"a1"],[9.125,"a2"],[9.1875,"a1"],[9.28125,"a1"],[9.3125,"a1"],[9.34375,"a1"],[9.5,"a1"],[9.625,"a2"],[9.6875,"a1"],[10,"a1"],[10.125,"a2"],[10.1875,"a1"],[10.28125,"a1"],[10.3125,"a1"],[10.34375,"a1"],[10.375,"a1"],[10.390625,"a1"],[10.40625,"a1"],[10.5,"a1"],[10.625,"a2"],[10.6875,"a1"],[10.78125,"a1"],[10.8125,"a1"],[10.84375,"a1"],[10.875,"a1"],[10.890625,"a1"],[10.9375,"a1"],[11,"a1"],[11.125,"a2"],[11.1875,"a1"],[11.28125,"a1"],[11.3125,"a1"],[11.34375,"a1"],[11.375,"a1"],[11.390625,"a1"],[11.40625,"a1"],[11.5,"a1"],[11.625,"a2"],[12.3125,"a1"],[12.3125,"a2"],[16,"a3"],[16.5,"a1"],[16.71875,"a1"],[17,"a1"],[17.28125,"a1"],[17.5,"a3"],[17.78125,"a1"],[17.5,"a1"],[18,"a1"],[18.25,"a1"],[18.46875,"a1"],[19,"a3"],[19,"a1"],[18.71875,"a1"],[19.28125,"a1"],[19.5,"a1"],[19.78125,"a1"],[20,"a1"],[20.5,"a1"],[20.75,"a1"],[21,"a1"],[21.25,"a1"],[21.46875,"a3"],[21.5625,"a3"],[21.65625,"a3"],[21.75,"a3"],[22,"a1"],[22.28125,"a1"],[22.5,"a1"],[22.78125,"a1"],[23,"a1"],[23.28125,"a1"],[23.5,"a1"],[23.78125,"a1"],[24,"a1"],[24.21875,"a1"],[24,"a3"],[24.5,"a1"],[24.71875,"a1"],[24.8125,"a1"],[24.90625,"a1"],[25,"a1"],[25.21875,"a1"],[25.5,"a1"],[25.71875,"a1"],[25.84375,"a1"],[25.921875,"a1"],[26,"a1"],[26.21875,"a1"],[26.71875,"a1"],[26.8125,"a1"],[26.921875,"a1"],[27,"a1"],[27.21875,"a1"],[27.5,"a1"],[27.625,"a1"],[27.71875,"a1"],[27.8125,"a1"],[27.90625,"a1"],[28.1875,"a1"],[28.28125,"a1"],[28.3125,"a1"],[28.34375,"a1"],[28.375,"a1"],[28.390625,"a1"],[28.40625,"a1"],[28.5,"a1"],[28.5,"a2"],[28.625,"a3"],[28.6875,"a1"],[28.78125,"a1"],[28.8125,"a1"],[28.84375,"a1"],[28.875,"a1"],[28.90625,"a1"],[28.9375,"a1"],[28.96875,"a1"]]`
            )
        },{
            file: new Audio('slthunderLOOPVERSION.mp3'),
            bpm: 150,            //loops, offset
            bpb: 8,
            attacklist: [
                [0.125, "a1", 14, 0.25],[4.125, "a1", 27*4, 0.25],
                [4, "a6",3,4],[4.5-1/32, "a5",3,4],[4.625, "a5",3,4],[4.5+7/32, "a6",3,4], // bar 2
                [5.25, "a4",3,4],[5.375, "a5",3,4],[5.5+1/16, "a5",3,4],[5.5+3/16, "a6",3,4], // bar 3
                [6, "a5",3,4],[6+3/16, "a5",3,4],[6.375, "a5",3,4],[6.5+1/16, "a5",3,4], // bar 4
                [7, "a7",3,4],[7.5+3/16, "a8",3,4], // bar 5
                [16, "a5",3,1],[16+3/32, "a2",3,1],[16 + 3/16, "a3",3,1], // bar 10
                [19, "a5",3,0.125],[19 + 11/32, "a2"],[19 + 7/16, "a3"], // bar 11
                [20, "a5",3,1],[20+3/32, "a2",3,1],[20 + 3/16, "a3",3,1], // bar 10
                [23, "a5",3,0.125],[23 + 11/32, "a2"],[23 + 7/16, "a6"], // bar 14
                [24, "a4",4,2],[24 + 3/8, "a5",4,2],[24 + 7/16, "a3",4,2],[24 + 15/16, "a6",4,2], // bar 12
                [25+3/16, "a5",4,2],[25 + 5/16, "a5",4,2],[25 + 7/16, "a6",4,2],[25 + 11/16, "a4",4,2], // bar 13
                [32, "a7"],[32, "a2", 48, 0.08333333], // amen break
                [36.125, "a3", 8, 1],[36 + 5/16, "a3", 8, 1],[36.625, "a3", 8, 1],[36.5 + 5/16, "a3", 7, 1],[36.5 + 7/16, "a3", 8, 1], // picked string
                [37.5 + 3/8, "a2", 4, 2], // picked string
                [40, "a8"], // appearance
                [44, "a4", 2, 4],[44 + 3/16, "a5", 2, 4],[44.375, "a2", 2, 4],[44.5, "a5", 2, 4],[44.5 + 3/16, "a4", 2, 4],[44.5 + 3/16, "a2", 2, 4], // bar 20
                [45.125, "a2", 2, 4],[45 + 3/16, "a5", 2, 4],[45 + 5/16, "a2", 2, 4],[45 + 6/16, "a2", 2, 4],[45.5 - 1/16, "a6", 2, 4],[45.625, "a2", 2, 4],[45.5 + 3/16, "a6", 2, 4],[45.5 + 3/8, "a5", 2, 4], // bar 21
                [46, "a5", 2, 4],[46 + 3/16, "a5", 2, 4],[46 + 3/8, "a4", 2, 4],[46.5, "a6", 2, 4],[46.625, "a2", 2, 4],[46.625 + 1/16, "a5", 2, 4],[46.875, "a5", 2, 4], // bar 23
                [47, "a2", 2, 4],[47.125, "a2", 2, 4],[47 + 3/16, "a6", 2, 4],[47 + 5/16, "a5", 2, 4],[47 + 7/16, "a5", 2, 4],[47 + 11/16, "a4", 2, 4],[47.875, "a5", 2, 4], // bar 24
                [52, "a5", 2, 0.5],[52 + 3/32, "a2"],[52.5 + 3/32, "a3"], // bar 28
                [53, "a2"],[53.125, "a2"],[53 + 3/16, "a6"],[53+3/8, "a2", 10, 1/16], // bar 29
                [54, "a2"],[54.125, "a2", 4, 0.25],[54 + 3/16, "a6",4, 0.25], // bar 30
                [55, "a6"],[55.25, "a4"],[55.375, "a2"],[55 + 7/16, "a5"] // bar 31
            ]
        }
    ]
}

function startMusic() {
    const posToCheck = game.musicPos;

    const song = music[game.region.name][game.musicPos];

    song.attacklist.forEach((item) => { 
        if (item[2] && item[3]) for (var i = 0; i < item[2]; i++) {
            setTimeout( ( ) => { 
                if (game.musicPos == posToCheck) game.enemyAttackWarning += item[1];
            }, (item[0] + item[3]*i)*song.bpb*1000*60/song.bpm-500);
            setTimeout( ( ) => { 
                if (game.musicPos == posToCheck) game.enemyAttack += item[1];
            }, (item[0] + item[3]*i)*song.bpb*1000*60/song.bpm);
        }
        else {
            setTimeout( ( ) => { 
                if (game.musicPos == posToCheck) game.enemyAttackWarning += item[1];
            }, (item[0])*song.bpb*1000*60/song.bpm-500);
            setTimeout( ( ) => { 
                if (game.musicPos == posToCheck) game.enemyAttack += item[1];
            }, (item[0])*song.bpb*1000*60/song.bpm);
        }
    })

    song.file.currentTime = 0;
    song.file.volume = game.audioVolume;
    song.file.play();
    setTimeout(() => { if (game.musicPos == posToCheck) startMusic() }, song.file.duration*1000);
}

function restartMusic(input) {
    ease(music[game.region.name][game.musicPos].file,"volume",0,1);
    game.musicPos = input;
    music[game.region.name][game.musicPos].file.volume = 0;
    setTimeout(() => {
        ease(music[game.region.name][game.musicPos].file,"volume",game.audioVolume,1.5);
        startMusic();
    },1000)
}