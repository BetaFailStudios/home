<html lang="en">
<head>
    <title>SubLiminal StickShift</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jura:wght@700&display=swap" rel="stylesheet">
</head>
<body>
    <style>
        body {
            background-color: #222;
            margin: auto;
            height: 100%;
            overflow: hidden;
            cursor: none;
        }
        .jura {
            font-family: "Jura", sans-serif;
            font-optical-sizing: auto;
            font-weight: 700;
            font-style: normal;
        }
    </style>
    <canvas onmousemove="xy(event)" id="gameScreen" width="1800" height="1000"></canvas>
    <p id="fps">60</p>
    <script>
        //setup
        {
            // initialize the timer variables and start the animation

            function startAnimating(fps) {
                fpsInterval = 1000 / fps;
                then = Date.now();
                startTime = then;
                animate();
            }

            // the animation loop calculates time elapsed since the last loop
            // and only draws if your specified fps interval is achieved

            function animate() {

                // request another frame

                requestAnimationFrame(animate);

                // calc elapsed time since last loop

                now = Date.now();
                elapsed = now - then;

                // if enough time has elapsed, draw the next frame

                if (elapsed > fpsInterval) {

                    // Get ready for next frame by setting then=now, but also adjust for your
                    // specified fpsInterval not being a multiple of RAF's interval (16.7ms)
                    then = now - (elapsed % fpsInterval);

                    // Put your drawing code here
                    tickloop();
                }
            }
            //canvas or gamescreen
            var canvas = document.getElementById("gameScreen");
            //context, for drawing
            var ctx = canvas.getContext("2d");
            //settings canvas size and scale
            var screenScale = window.innerWidth/1800;
            if (window.innerHeight/1000 < screenScale) screenScale = window.innerHeight/1000;

            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            ctx.translate(window.innerWidth/2, window.innerHeight/2);

            ctx.scale(screenScale, screenScale);

            //resizing
            window.addEventListener("resize", (  ) => {
                ctx.resetTransform();

                //settings canvas size and scale
                screenScale = window.innerWidth/1800;
                if (window.innerHeight/1000 < screenScale) screenScale = window.innerHeight/1000;

                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;

                ctx.translate(window.innerWidth/2, window.innerHeight/2);

                ctx.scale(screenScale, screenScale);

                ctx.lineWidth = 10;
                ctx.textBaseline = 'middle';
                ctx.textAlign = 'center';
                ctx.lineJoin = "round";
                ctx.lineCap = "round";

                ctx.beginPath();
                ctx.fillStyle = "#000";
                ctx.fillRect(-1000,-1000,1800+1000,1000+1000);

                ctx.font = "100px serif";
            });
            
            /*canvas.addEventListener("click", async () => {
                await canvas.requestPointerLock();
            });*/
        }

        const mouse = {
            x: 0,
            y: 0,
            x: 0,
            y: 1,
            down: false
        };

        const keys = [];

        //detect keypresses
        window.addEventListener('keydown', function (e) { if (!e.repeat) {
            const key = e.key.toLowerCase();
            if (!keys.includes(key) && !game.menu) keys.push(key);

            if (key == "escape" && !game.menu && game.status == "driving") game.menu = "pause";
            else if (key == "escape" && game.menu == "pause") game.menu = false;
        }}, false);
        window.addEventListener('keyup', function (e) {
            const key = e.key.toLowerCase();
            while (keys.includes(key)) {
                keys.splice(keys.indexOf(key), 1);
            }
        }, false);
        window.addEventListener('mousedown', function (e) {
            mouse.down = true;

            if (game.menu) {
                if (game.menu == "main") {
                    if (mouse.hover == "drive") {
                        game.timer = 0;
                        game.menu = false;
                    } else if (mouse.hover == "menu1") {
                        game.menu = "settings";
                    }
                } else if (game.menu == "settings") {
                    if (mouse.hover == "menu1") {
                        game.menu = "main";
                        game.subMenu = false;
                    } else if (mouse.hover) game.subMenu = mouse.hover;
                    else {
                        if (mouse.x > 250 && mouse.x < 750 && mouse.y > -100 && mouse.y < -50) game.masterVolume = Math.min(1,Math.max(0,(mouse.x-300)/400)).toFixed(2);
                        else if (mouse.x > 275 && mouse.x < 775 && mouse.y > 75 && mouse.y < 125) game.musicVolume = Math.min(1,Math.max(0,(mouse.x-325)/400)).toFixed(2);
                        else if (mouse.x > 200 && mouse.x < 700 && mouse.y > 250 && mouse.y < 300) game.sfxVolume = Math.min(1,Math.max(0,(mouse.x-250)/400)).toFixed(2);
                    }
                } else if (game.menu == "pause") {
                    if (mouse.hover == "menu1") {
                        game.menu = false;
                    } else if (mouse.hover == "menu2") {
                        window.location.reload();
                    }
                }
                mouse.hover = false;

                return;
            }
            mouse.selected = mouse.hover;
            if (mouse.selected == "wheel") {
                const wheelAngle = -car.wheel*Math.PI*5/2+Math.PI/2;
                const mouseWheelAngle = Math.atan( (mouse.y-currentCar.positions.wheel[1]) / (mouse.x-currentCar.positions.wheel[0]) ) + Math.PI*(mouse.x > currentCar.positions.wheel[0]);

                //difference
                mouse.wheelOffset = mouseWheelAngle-wheelAngle;

                while (Math.abs(mouse.wheelOffset-Math.PI*2) < Math.abs(mouse.wheelOffset)) mouse.wheelOffset -= Math.PI*2;
                while (Math.abs(mouse.wheelOffset+Math.PI*2) < Math.abs(mouse.wheelOffset)) mouse.wheelOffset += Math.PI*2;
            } else if (mouse.selected == "radio") mouse.wheelOffset = game.audioVolume*500-250 - mouse.x+200;
            else if (mouse.selected == "ignition") {
                car.running = !car.running;
                game.timerCounting = true;

                if (car.running) engineRev.play();
                else engineRev.pause();
            }else if (mouse.selected == "horn") {
                horn.play();

                if (stats.hornJump && !car.jumpPos) {
                    car.jumpPosVel = 60;
                    car.jumpPos = 0;
                }
            } else if (mouse.selected == "blinkerR") {
                if (car.blinker == "r") car.blinker = false; 
                else car.blinker = "r";
            } else if (mouse.selected == "blinkerL") {
                if (car.blinker == "l") car.blinker = false; 
                else car.blinker = "l";
            } else if (mouse.selected == "hazard") {
                car.hazard = !car.hazard; 
            }

            if (game.status == "choosing") chooseChoice();
        }, false);
        window.addEventListener('mouseup', function (e) {
            mouse.down = false;

            if (mouse.selected == "horn") {
                horn.pause();
            }

            mouse.selected = false;
        }, false);
        window.oncontextmenu = () => {
            return false;
        }
        
        function xy(e) {
            //mouse.x = e.x/screenScale - (window.innerWidth)/2/screenScale;
            //mouse.y = e.y/screenScale - (window.innerHeight)/2/screenScale;

            mouse.actualX = e.x/screenScale - (window.innerWidth)/2/screenScale;
            mouse.actualY = e.y/screenScale - (window.innerHeight)/2/screenScale;

            if (game.status == "driving") checkHover();
        }

        //saving settings
        window.addEventListener("beforeunload", function(e) {
            localStorage.setItem("SlSsGameSettings", JSON.stringify( { master: game.masterVolume, music: game.musicVolume, sfx: game.sfxVolume } ));
        })

        // initialize the timer variables and start the animation

        function startAnimating(fps) {
            fpsInterval = 1000 / fps;
            then = Date.now();
            startTime = then;
            animate();
        }

        var filterStrength = 10; //used  to be 20
        var frameTime = 0, lastLoop = new Date, thisLoop;
        var fpsOut = document.getElementById('fps');

        // Report the fps only every second, to only lightly affect measurements
        setInterval(function(){
            fpsOut.innerHTML = (1000/frameTime).toFixed(1);
            game.fps = Math.max(30, Number(fpsOut.innerHTML));
        },1000);

        ctx.lineWidth = 10;
        ctx.textBaseline = 'middle';
        ctx.textAlign = 'center';
        ctx.lineJoin = "round";
        ctx.lineCap = "round";
    </script>
    <script>
        const stackablePerks = [
            {
                name: "Wider Road",
                desc: "Increased road width",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(-150,100);
                    ctx.lineTo(0,-100);
                    ctx.lineTo(150,-100);
                    ctx.lineTo(0,100);
                    ctx.fillStyle = "#333"
                    ctx.fill();

                    ctx.beginPath();
                    ctx.moveTo(-150,100);
                    ctx.lineTo(0,-100);
                    ctx.moveTo(150,-100);
                    ctx.lineTo(0,100);
                    ctx.strokeStyle = "#666"
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(-67.5,90);
                    ctx.lineTo(-52.5, 70);
                    ctx.moveTo(-37.5,50);
                    ctx.lineTo(-22.5, 30);
                    ctx.moveTo(-7.5, 10);
                    ctx.lineTo(7.5, -10);
                    ctx.moveTo(22.5,-30);
                    ctx.lineTo(37.5, -50);
                    ctx.moveTo(52.5,-70);
                    ctx.lineTo(67.5, -90);
                    ctx.strokeStyle = "#990"
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(-30,-20);
                    ctx.lineTo(-60,20);
                    ctx.lineTo(-110,20);
                    ctx.lineTo(-125,40);
                    ctx.lineTo(-150,0);
                    ctx.lineTo(-65,-40);
                    ctx.lineTo(-80,-20);
                    ctx.closePath();
                    ctx.moveTo(30,20);
                    ctx.lineTo(60,-20);
                    ctx.lineTo(110,-20);
                    ctx.lineTo(125,-40);
                    ctx.lineTo(150,0);
                    ctx.lineTo(65,40);
                    ctx.lineTo(80,20);
                    ctx.closePath();
                    ctx.fillStyle = "#ffffff33";
                    ctx.fill();
                    ctx.strokeStyle = "#999";
                    ctx.stroke();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#333";
                        ctx.fillStyle = "#990";
                        ctx.strokeText("Wider",0,-150);
                        ctx.fillText("Wider",0,-150);
                        ctx.strokeText("Road",0,150);
                        ctx.fillText("Road",0,150);
                    }

                    ctx.lineWidth = game.defaultLineWidth;
                },
                chooseFunction() {
                    stats.roadSize *= 1.1;
                }
            },
            {
                name: "Straighter Roads",
                desc: "Decrease the curvature of roads",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(-150,100);
                    ctx.lineTo(-50,50);
                    ctx.lineTo(25,0);
                    ctx.lineTo(0,-50);
                    ctx.lineTo(-150,-100);
                    ctx.lineTo(-100,-100);
                    ctx.lineTo(75,-50);
                    ctx.lineTo(125,0);
                    ctx.lineTo(100,50);
                    ctx.lineTo(0,100);
                    ctx.fillStyle = "#333"
                    ctx.fill();

                    ctx.beginPath();
                    ctx.moveTo(-75,100);
                    ctx.lineTo(-25,75);
                    ctx.moveTo(25,50);
                    ctx.lineTo(50,25);
                    ctx.moveTo(75,0);
                    ctx.lineTo(50,-25);
                    ctx.moveTo(25,-50);
                    ctx.lineTo(-30,-70);
                    ctx.moveTo(-125,-100);
                    ctx.lineTo(-87.5,-90);
                    ctx.strokeStyle = "#990"
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(-150,100);
                    ctx.lineTo(-50,50);
                    ctx.lineTo(25,0);
                    ctx.lineTo(0,-50);
                    ctx.lineTo(-150,-100);
                    ctx.moveTo(-100,-100);
                    ctx.lineTo(75,-50);
                    ctx.lineTo(125,0);
                    ctx.lineTo(100,50);
                    ctx.lineTo(0,100);
                    ctx.strokeStyle = "#666"
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(-70,50);
                    ctx.lineTo(-10,50);
                    ctx.lineTo(50,-30);
                    ctx.lineTo(80,-30);
                    ctx.lineTo(50,-70);
                    ctx.lineTo(-40,-30);
                    ctx.lineTo(-10,-30);
                    ctx.closePath();
                    ctx.fillStyle = "#ffffff33";
                    ctx.fill();
                    ctx.strokeStyle = "#999";
                    ctx.stroke();
                

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#333";
                        ctx.fillStyle = "#990";
                        ctx.strokeText("Straighter",0,-150);
                        ctx.fillText("Straighter",0,-150);
                        ctx.strokeText("Road",0,150);
                        ctx.fillText("Road",0,150);
                    }

                    ctx.lineWidth = game.defaultLineWidth;
                },
                chooseFunction() {
                    stats.roadAngle *= 0.8;
                }
            },
            {
                name: "Duck Tape",
                desc: "Minorly slows fuel leak",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(80,0);
                    ctx.lineTo(50,70);
                    ctx.lineTo(20,80);
                    ctx.lineTo(80,80);
                    ctx.lineTo(80,100);
                    ctx.lineTo(-20,100);
                    ctx.lineTo(-90,70);
                    ctx.lineTo(-120,0);
                    ctx.lineTo(-90,-70);
                    ctx.lineTo(-20,-100);
                    ctx.lineTo(50,-70);
                    ctx.closePath();
                    ctx.moveTo(-70,0);
                    ctx.lineTo(-55,35);
                    ctx.lineTo(-20,50);
                    ctx.lineTo(15,35);
                    ctx.lineTo(30,0);
                    ctx.lineTo(15,-35);
                    ctx.lineTo(-20,-50);
                    ctx.lineTo(-55,-35);
                    ctx.closePath();
                    ctx.strokeStyle = "#990";
                    ctx.stroke();
                    ctx.fillStyle = "#cc0";
                    ctx.fill();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#333";
                        ctx.fillStyle = "#990";
                        ctx.strokeText("Duck",0,-150);
                        ctx.fillText("Duck",0,-150);
                        ctx.strokeText("Tape",0,150);
                        ctx.fillText("Tape",0,150);
                    }
                },
                chooseFunction() {
                    stats.timerMax *= 1.15;
                }
            },
            {
                name: "Offroad Tires",
                desc: "Reduces the deceleration speed off-road",
                drawFunction(timer) {
                    ctx.beginPath();
                    let num = 0;
                    for(var i = 0; i <= Math.PI*2; i += Math.PI/18) {
                        num++;
                        ctx.lineTo((100-20*(num == 3))*Math.cos(i),(100-20*(num == 3))*Math.sin(i));
                        if (num == 3) num = 0;
                    }
                    ctx.moveTo(-50,0);
                    ctx.lineTo(-35,35);
                    ctx.lineTo(0,50);
                    ctx.lineTo(35,35);
                    ctx.lineTo(50,0);
                    ctx.lineTo(35,-35);
                    ctx.lineTo(0,-50);
                    ctx.lineTo(-35,-35);
                    ctx.closePath();
                    ctx.strokeStyle = "#666";
                    ctx.stroke();
                    ctx.fillStyle = "#333";
                    ctx.fill();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#333";
                        ctx.fillStyle = "#666";
                        ctx.strokeText("Offroad",0,-150);
                        ctx.fillText("Offroad",0,-150);
                        ctx.strokeText("Tires",0,150);
                        ctx.fillText("Tires",0,150);
                    }
                },
                chooseFunction() {
                    stats.offroadSpeedLoss *= 0.35;
                }
            },
            {
                name: "Grippy Tires",
                desc: "Increased Drifting friction",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(-80,0);
                    ctx.lineTo(-56,56);
                    ctx.lineTo(0,80);
                    ctx.lineTo(56,56);
                    ctx.lineTo(80,0);
                    ctx.lineTo(56,-56);
                    ctx.lineTo(0,-80);
                    ctx.lineTo(-56,-56);
                    ctx.closePath();
                    let num = 0;
                    ctx.strokeStyle = "#666";
                    ctx.stroke();
                    ctx.fillStyle = "#333";
                    ctx.fill();
                    ctx.beginPath();
                    for(var i = Math.PI/8; i <= Math.PI*2+Math.PI/8; i += Math.PI/4) {
                        ctx.moveTo(100*Math.cos(i),100*Math.sin(i));
                        ctx.lineTo(110*Math.cos(i),110*Math.sin(i));
                    }
                    ctx.strokeStyle = "#ffff0099";
                    ctx.stroke();
                    
                    ctx.beginPath();
                    ctx.moveTo(50,0);
                    ctx.lineTo(35,35);
                    ctx.lineTo(0,50);
                    ctx.lineTo(-35,35);
                    ctx.lineTo(-50,0);
                    ctx.lineTo(-35,-35);
                    ctx.lineTo(0,-50);
                    ctx.lineTo(35,-35);
                    ctx.closePath();
                    ctx.strokeStyle = "#666";
                    ctx.stroke();
                    ctx.fillStyle = "#999";
                    ctx.fill();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#333";
                        ctx.fillStyle = "#666";
                        ctx.strokeText("Grippy",0,-150);
                        ctx.fillText("Grippy",0,-150);
                        ctx.strokeText("Tires",0,150);
                        ctx.fillText("Tires",0,150);
                    }
                },
                chooseFunction() {
                    stats.driftGrip *= 1.3;
                    stats.requiredDriftAngle *= 1.2;
                }
            },
            {
                name: "Better Transmission",
                desc: "Increased Acceleration",
                drawFunction(timer) {
                    ctx.beginPath();
                    let num = 0;
                    for(var i = 0; i <= Math.PI*2; i += Math.PI/9) {
                        num++;
                        ctx.lineTo((80-30*(num == 3))*Math.cos(i)-85,(80-30*(num == 3))*Math.sin(i));
                        if (num == 3) num = 0;
                    }
                    ctx.closePath();
                    num = 0;
                    ctx.moveTo(150,-35)
                    for(var i = 0; i <= Math.PI*2; i += Math.PI/16) {
                        num++;
                        ctx.lineTo((100-30*(num == 1 || num == 4))*Math.cos(i)+80,(100-30*(num == 1 || num == 4))*Math.sin(i));
                        if (num == 4) num = 0;
                    }
                    ctx.closePath();
                    ctx.strokeStyle = "#666";
                    ctx.stroke();
                    ctx.fillStyle = "#333";
                    ctx.fill();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#333";
                        ctx.fillStyle = "#666";
                        ctx.strokeText("Better",0,-150);
                        ctx.fillText("Better",0,-150);
                        ctx.strokeText("Transmission",0,150);
                        ctx.fillText("Transmission",0,150);
                    }
                },
                chooseFunction() {
                    stats.acceleration *= 1.2;
                }
            },
        ]

        const unStackablePerks = [
            {
                name: "Metal Pedal",
                desc: "Lot more acceleration, little more top speed",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(-120,-40);
                    ctx.lineTo(-100,20);
                    ctx.lineTo(-40,40);
                    ctx.lineTo(-20,0);
                    ctx.lineTo(-80,-20);
                    ctx.lineTo(-100,-80);
                    ctx.strokeStyle = "#666";
                    ctx.stroke();
                    ctx.fillStyle = "#333";
                    ctx.fill();
                    ctx.beginPath();
                    ctx.moveTo(-60,-40);
                    ctx.lineTo(20,-60);
                    ctx.lineTo(60,80);
                    ctx.lineTo(-20,100);
                    ctx.closePath();
                    ctx.strokeStyle = "#666";
                    ctx.stroke();
                    ctx.fillStyle = "#999";
                    ctx.fill();
                    ctx.beginPath();
                    ctx.moveTo(-30,-20);
                    ctx.lineTo(-5,70);
                    ctx.moveTo(0,-30);
                    ctx.lineTo(25,60);
                    ctx.strokeStyle = "#666";
                    ctx.stroke();
                    ctx.fillStyle = "#333";
                    ctx.fill();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#333";
                        ctx.fillStyle = "#666";
                        ctx.strokeText("Metal",0,-150);
                        ctx.fillText("Metal",0,-150);
                        ctx.strokeText("Pedal",0,150);
                        ctx.fillText("Pedal",0,150);
                    }
                },
                chooseFunction() {
                    stats.acceleration *= 3;
                    stats.topSpeed *= 1.1;
                }
            },
            {
                name: "Spedometer",
                desc: "Higher Top Speed but lower acceleration",
                drawFunction(timer) {
                    ctx.beginPath();
                    //ctx.arc(0,-0,100,Math.PI-Math.PI/5,Math.PI/5);
                    
                    ctx.moveTo(-50,70);
                    ctx.lineTo(-90,50);
                    ctx.lineTo(-100,0);
                    ctx.lineTo(-90,-50);
                    ctx.lineTo(-50,-90);
                    ctx.lineTo(0,-100);
                    ctx.lineTo(50,-90);
                    ctx.lineTo(90,-50);
                    ctx.lineTo(100,0);
                    ctx.lineTo(90,50);
                    ctx.lineTo(50,70);
                    
                    ctx.lineTo(25,60);
                    ctx.lineTo(-25,60);
                    ctx.closePath();
                    ctx.strokeStyle = "#666";
                    ctx.stroke();
                    ctx.fillStyle = "#333";
                    ctx.fill();

                    ctx.beginPath();
                    for(var i = Math.PI/8; i >= -Math.PI-Math.PI/8; i -= Math.PI/4) {
                        ctx.moveTo(85*Math.cos(i),85*Math.sin(i));
                        ctx.lineTo(95*Math.cos(i),95*Math.sin(i));
                    }
                    ctx.strokeStyle = "#999";
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(0,0)
                    ctx.lineTo(10,-90);
                    ctx.strokeStyle = "#c00";
                    ctx.stroke();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#333";
                        ctx.fillStyle = "#c00";
                        ctx.strokeText("Speedometer",0,150);
                        ctx.fillText("Speedometer",0,150);
                    }
                },
                chooseFunction() {
                    stats.topSpeed *= 1.5;
                    stats.acceleration *= 0.6;
                }
            },
            {
                name: "Buggy Build",
                desc: "Increases Off-Road capabilties",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(-120,-50);
                    ctx.lineTo(120,-50);
                    ctx.moveTo(-120,50);
                    ctx.lineTo(120,50);
                    ctx.moveTo(-10,-50);
                    ctx.lineTo(-10,50);
                    ctx.moveTo(10,-50);
                    ctx.lineTo(10,50);
                    ctx.moveTo(-100,50);
                    ctx.lineTo(-100,30);
                    ctx.lineTo(-80,30);
                    ctx.lineTo(-80,10);
                    ctx.lineTo(-60,10);
                    ctx.lineTo(-60,-10);
                    ctx.lineTo(-40,-10);
                    ctx.lineTo(-40,-30);
                    ctx.lineTo(-20,-30);
                    ctx.lineTo(-20,-50);
                    ctx.moveTo(100,50);
                    ctx.lineTo(100,30);
                    ctx.lineTo(80,30);
                    ctx.lineTo(80,10);
                    ctx.lineTo(60,10);
                    ctx.lineTo(60,-10);
                    ctx.lineTo(40,-10);
                    ctx.lineTo(40,-30);
                    ctx.lineTo(20,-30);
                    ctx.lineTo(20,-50);
                    ctx.lineWidth = game.defaultLineWidth*2;
                    ctx.strokeStyle = "#333";
                    ctx.stroke();
                    ctx.lineWidth = game.defaultLineWidth;
                    ctx.strokeStyle = "#666";
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.rect(-140, -70, 40, 140);
                    ctx.rect(100, -70, 40, 140);
                    ctx.strokeStyle = "#666";
                    ctx.stroke();
                    ctx.fillStyle = "#333";
                    ctx.fill();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#333";
                        ctx.fillStyle = "#666";
                        ctx.strokeText("Buggy",0,-150);
                        ctx.fillText("Buggy",0,-150);
                        ctx.strokeText("Build",0,150);
                        ctx.fillText("Build",0,150);
                    }
                },
                chooseFunction() {
                    stats.offroadSpeedLoss *= 0.15;
                    stats.offroadMaxSpeed *= 2.3;
                }
            },
            {
                name: "EZ Drive",
                desc: "Wider, straighter, and Shorter roads",
                drawFunction(timer) {
                    ctx.save();

                    ctx.rotate(Math.PI/10);
                    
                    ctx.fillStyle = "#0f0";
                    ctx.strokeStyle = "#0f0";
                    ctx.font = "100px Jura";
                    ctx.fillText("EZ",0,0);
                    ctx.beginPath();
                    ctx.rect(-100,-62.5,200,125)
                    ctx.fillStyle = "#00ff0040";
                    ctx.fill();
                    ctx.stroke();

                    ctx.restore();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#333";
                        ctx.fillStyle = "#666";
                        ctx.strokeText("E Z",0,-150);
                        ctx.fillText("E Z",0,-150);
                        ctx.strokeText("Drive",0,150);
                        ctx.fillText("Drive",0,150);
                    }
                },
                chooseFunction() {
                    stats.roadAngle *= 0.80;
                    stats.roadSize *= 1.2;
                    stats.roadLength *= 0.85;
                }
            },
            {
                name: "Look Ma', No hands",
                desc: "Increased speed while not holding the the wheel",
                drawFunction(timer) {
                    //wheel
                    ctx.save();
                    ctx.rotate(Math.PI/5);
                    
                    ctx.strokeStyle = "#333";
                    ctx.fillStyle = "#ad7d53";
                    ctx.beginPath();
                    ctx.moveTo(100,0);
                    ctx.lineTo(70,70);
                    ctx.lineTo(0,100);
                    ctx.lineTo(-70,70);
                    ctx.lineTo(-100,0);
                    ctx.lineTo(-70,-70);
                    ctx.lineTo(0,-100);
                    ctx.lineTo(70,-70);
                    ctx.closePath();

                    ctx.moveTo(80,0);
                    ctx.lineTo(55,-55);
                    ctx.lineTo(0,-80);
                    ctx.lineTo(-55,-55);
                    ctx.lineTo(-80,0);
                    ctx.lineTo(-55,55);
                    ctx.lineTo(0,80);
                    ctx.lineTo(55,55);
                    ctx.closePath();
                    ctx.rect(-90,-10,180,20);
                    ctx.rect(-10,0,20,90);
                    ctx.stroke();
                    ctx.fill();

                    ctx.restore();

                    ctx.beginPath();
                    for(var i = 0; i <= Math.PI*2; i += Math.PI/10) {
                        ctx.moveTo(110*Math.cos(i),110*Math.sin(i));
                        ctx.lineTo(120*Math.cos(i),120*Math.sin(i));
                    }
                    ctx.strokeStyle = "#ffff0099";
                    ctx.stroke();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#333";
                        ctx.fillStyle = "#666";
                        ctx.strokeText("Look Ma'",0,-150);
                        ctx.fillText("Look Ma'",0,-150);
                        ctx.strokeText("No hands",0,150);
                        ctx.fillText("No hands",0,150);
                    }
                },
                chooseFunction() {
                    stats.noHands = true;
                }
            },
            {
                name: "Offroad Cruisin'",
                desc: "No speed penalty on offroad if the engine is off",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(30,0);
                    ctx.lineTo(10,-45);
                    ctx.lineTo(-30,-60);
                    ctx.lineTo(-70,-45);
                    ctx.lineTo(-90,0);
                    ctx.lineTo(-70,45);
                    ctx.lineTo(-30,60);
                    ctx.lineTo(10,45);
                    ctx.closePath();
                    //ctx.arc(-30,0,50,0,Math.PI*2, true);
                    let num = 0;
                    for(var i = 0; i <= Math.PI*2; i += Math.PI/18) {
                        num++;
                        ctx.lineTo(-30+(100-20*(num == 3))*Math.cos(i),(100-20*(num == 3))*Math.sin(i));
                        if (num == 3) num = 0;
                    }
                    ctx.strokeStyle = "#666";
                    ctx.stroke();
                    ctx.fillStyle = "#333";
                    ctx.fill();

                    ctx.beginPath();
                    ctx.moveTo(90,0);
                    ctx.lineTo(150,0);
                    ctx.moveTo(80,-40);
                    ctx.lineTo(140,-40);
                    ctx.moveTo(80,40);
                    ctx.lineTo(140,40);
                    ctx.moveTo(50,-80);
                    ctx.lineTo(110,-80);
                    ctx.moveTo(50,80);
                    ctx.lineTo(110,80);
                    ctx.strokeStyle = "#999";
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(-55,0);
                    ctx.lineTo(-48,-18);
                    ctx.lineTo(-30,-25);
                    ctx.lineTo(-12,-18);
                    ctx.lineTo(-5,0);
                    ctx.lineTo(-12,18);
                    ctx.lineTo(-30,25);
                    ctx.lineTo(-48,18);
                    ctx.closePath();
                    //ctx.arc(0,0,25,0,Math.PI*2);
                    
                    ctx.fillStyle = "#922";
                    ctx.fill();
                    ctx.strokeStyle = "#222";
                    ctx.stroke();

                    ctx.beginPath();

                    ctx.moveTo(-40,-10);
                    ctx.lineTo(-20,10);

                    ctx.strokeStyle = "#666";
                    ctx.stroke();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#333";
                        ctx.fillStyle = "#666";
                        ctx.strokeText("Offroad",0,-150);
                        ctx.fillText("Offroad",0,-150);
                        ctx.strokeText("Cruisin'",0,150);
                        ctx.fillText("Cruisin'",0,150);
                    }
                },
                chooseFunction() {
                    stats.offroadCruise = true;
                }
            },
            {
                name: "Anti-Lock Brakes",
                desc: "Much harder to drift and slide out",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(100,0);
                    ctx.lineTo(70,70);
                    ctx.lineTo(0,100);
                    ctx.lineTo(-70,70);
                    ctx.lineTo(-100,0);
                    ctx.lineTo(-70,-70);
                    ctx.lineTo(0,-100);
                    ctx.lineTo(70,-70);
                    ctx.closePath();
                    ctx.moveTo(90,-90);
                    ctx.lineTo(130,-40);
                    ctx.lineTo(130,40);
                    ctx.lineTo(90,90);
                    ctx.moveTo(-90,-90);
                    ctx.lineTo(-130,-40);
                    ctx.lineTo(-130,40);
                    ctx.lineTo(-90,90);
                    ctx.lineWidth = game.defaultLineWidth*2;
                    ctx.strokeStyle = "#950";
                    ctx.stroke();
                    ctx.lineWidth = game.defaultLineWidth;
                    ctx.strokeStyle = "#fc3";
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.font = "75px Jura";
                    ctx.strokeStyle = "#950";
                    ctx.fillStyle = "#fc3";
                    ctx.strokeText("ABS",0,0);
                    ctx.fillText("ABS",0,0);

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#950";
                        ctx.fillStyle = "#fc3";
                        ctx.strokeText("Anti-Lock",0,-150);
                        ctx.fillText("Anti-Lock",0,-150);
                        ctx.strokeText("Brakes",0,150);
                        ctx.fillText("Brakes",0,150);
                    }
                },
                chooseFunction() {
                    stats.requiredDriftAngle *= 4;
                }
            },
            {
                name: "No-Drift Wipers",
                desc: "Impossible to slip out on side of your windshield wipers",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(30,25);
                    ctx.lineTo(5,80);
                    ctx.lineTo(-50,105);
                    ctx.lineTo(-105,80);
                    ctx.lineTo(-130,25);
                    ctx.lineTo(-105,-30);
                    ctx.lineTo(-50,-55);
                    ctx.lineTo(5,-30);
                    ctx.closePath();
                    let num = 0;
                    ctx.strokeStyle = "#666";
                    ctx.stroke();
                    ctx.fillStyle = "#333";
                    ctx.fill();
                    
                    ctx.beginPath();
                    ctx.moveTo(0,25);
                    ctx.lineTo(-15,60);
                    ctx.lineTo(-50,75);
                    ctx.lineTo(-85,60);
                    ctx.lineTo(-100,25);
                    ctx.lineTo(-85,-10);
                    ctx.lineTo(-50,-25);
                    ctx.lineTo(-15,-10);
                    ctx.closePath();
                    ctx.strokeStyle = "#666";
                    ctx.stroke();
                    ctx.fillStyle = "#999";
                    ctx.fill();

                    ctx.moveTo(-50+50,25-50);
                    ctx.lineTo(-50+35,25-65);

                    ctx.moveTo(-50+70,25-70);
                    ctx.lineTo(-50+50,25-90);
                    ctx.lineTo(-50+20,25-100);

                    ctx.moveTo(-50,25);
                    ctx.lineTo(-50+90,25-90);
                    ctx.lineTo(-50+62.5,25-110);
                    ctx.lineTo(-50+20,25-125);
                    ctx.lineTo(-50-30,25-125);
                    ctx.lineWidth = game.defaultLineWidth*2;
                    ctx.strokeStyle = "#333";
                    ctx.stroke();
                    ctx.lineWidth = game.defaultLineWidth;
                    ctx.strokeStyle = "#666";
                    ctx.stroke();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#333";
                        ctx.fillStyle = "#666";
                        ctx.strokeText("No-Drift",0,-150);
                        ctx.fillText("No-Drift",0,-150);
                        ctx.strokeText("Wipers",0,150);
                        ctx.fillText("Wipers",0,150);
                    }
                },
                chooseFunction() {
                    stats.driftWiper = true;
                }
            },
            {
                name: "Boosters",
                desc: "Boosters spawn on the road",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(-150,100);
                    ctx.lineTo(0,0);
                    ctx.lineTo(150,100);
                    ctx.moveTo(-125,50);
                    ctx.lineTo(0,-50);
                    ctx.lineTo(125,50);
                    ctx.moveTo(-100,0);
                    ctx.lineTo(0,-100);
                    ctx.lineTo(100,0);
                    ctx.lineWidth = game.defaultLineWidth*2;
                    ctx.strokeStyle = "#950";
                    ctx.stroke();
                    ctx.lineWidth = game.defaultLineWidth;
                    ctx.strokeStyle = "#fc3";
                    ctx.stroke();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#950";
                        ctx.fillStyle = "#fc3";
                        ctx.strokeText("Boosters",0,150);
                        ctx.fillText("Boosters",0,150);
                    }
                },
                chooseFunction() {
                    stats.booster = true;
                }
            },
            {
                name: "Horn Jump",
                desc: "Honk to pop a wheelie and avoid the ground below",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(-75,-25);
                    ctx.lineTo(-25,-75);
                    ctx.lineTo(-25,75);
                    ctx.lineTo(-75,25);
                    ctx.closePath();
                    ctx.strokeStyle = "#950";
                    ctx.stroke();
                    ctx.fillStyle = "#c93";
                    ctx.fill();

                    ctx.beginPath();
                    ctx.moveTo(0,-50);
                    ctx.lineTo(25,0);
                    ctx.lineTo(0,50);
                    ctx.moveTo(25,-75);
                    ctx.lineTo(62.5,0);
                    ctx.lineTo(25,75);
                    ctx.moveTo(50,-100);
                    ctx.lineTo(100,0);
                    ctx.lineTo(50,100);
                    ctx.lineWidth = game.defaultLineWidth*2;
                    ctx.strokeStyle = "#950";
                    ctx.stroke();
                    ctx.lineWidth = game.defaultLineWidth;
                    ctx.strokeStyle = "#c93";
                    ctx.stroke();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#950";
                        ctx.fillStyle = "#c93";
                        ctx.strokeText("Horn",0,-150);
                        ctx.fillText("Horn",0,-150);
                        ctx.strokeText("Jump",0,150);
                        ctx.fillText("Jump",0,150);
                    }
                },
                chooseFunction() {
                    stats.hornJump = true;
                }
            },
            {
                name: "Telekinetic Steering",
                desc: "Steer slowly with the A & D keys",
                drawFunction(timer) {
                    //wheel
                    ctx.save();
                    ctx.rotate(-Math.PI/8);
                    
                    ctx.strokeStyle = "#333";
                    ctx.fillStyle = "#ad7d53";
                    ctx.beginPath();
                    ctx.moveTo(100,0);
                    ctx.lineTo(70,70);
                    ctx.lineTo(0,100);
                    ctx.lineTo(-70,70);
                    ctx.lineTo(-100,0);
                    ctx.lineTo(-70,-70);
                    ctx.lineTo(0,-100);
                    ctx.lineTo(70,-70);
                    ctx.closePath();

                    ctx.moveTo(80,0);
                    ctx.lineTo(55,-55);
                    ctx.lineTo(0,-80);
                    ctx.lineTo(-55,-55);
                    ctx.lineTo(-80,0);
                    ctx.lineTo(-55,55);
                    ctx.lineTo(0,80);
                    ctx.lineTo(55,55);
                    ctx.closePath();
                    ctx.rect(-90,-10,180,20);
                    ctx.rect(-10,0,20,90);
                    ctx.stroke();
                    ctx.fill();
                    ctx.lineWidth = game.defaultLineWidth*2;
                    ctx.strokeStyle = "#708";
                    ctx.stroke();
                    ctx.lineWidth = game.defaultLineWidth;
                    ctx.strokeStyle = "#333";
                    ctx.stroke();
                    ctx.fill();

                    ctx.restore();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#708";
                        ctx.fillStyle = "#90c";
                        ctx.strokeText("Telekinetic",0,-150);
                        ctx.fillText("Telekinetic",0,-150);
                        ctx.strokeText("Steering",0,150);
                        ctx.fillText("Steering",0,150);
                    }
                },
                chooseFunction() {
                    stats.telekinesis = true;
                }
            },
            {
                name: "Jammin' Out",
                desc: "Higher Top speed but lower drift grip relative to radio volume",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.save();
                    ctx.translate(-75,25);

                    for(var i = 0; i < 3; i++) {
                        ctx.moveTo(25,-125);
                        ctx.lineTo(25,0);
                        ctx.lineTo(17.5,17.5);
                        ctx.lineTo(0,25);
                        ctx.lineTo(-17.5,17.5);
                        ctx.lineTo(-25,0);
                        ctx.lineTo(-17.5,-17.5);
                        ctx.lineTo(0,-25);
                        ctx.lineTo(17.5,-17.5);
                        ctx.lineTo(20,-17.5);
                        ctx.lineTo(20,-125);
                        ctx.closePath();

                        ctx.translate(60,25);
                    }

                    ctx.restore();

                    ctx.strokeStyle = "#77c";
                    ctx.fillStyle = "#99f";
                    ctx.stroke();
                    ctx.fill();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#77c";
                        ctx.fillStyle = "#99f";
                        ctx.strokeText("Jammin'",0,-150);
                        ctx.fillText("Jammin'",0,-150);
                        ctx.strokeText("Out",0,150);
                        ctx.fillText("Out",0,150);
                    }
                },
                chooseFunction() {
                    stats.jamin = true;
                }
            },
            {
                name: "Boosted Drift",
                desc: "Drifting charges a boost that is released after",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(125,100);
                    ctx.lineTo(25,75);
                    ctx.lineTo(-75,25);
                    ctx.lineTo(-115,-25);
                    ctx.lineTo(-135,-100);
                    ctx.moveTo(150,50);
                    ctx.lineTo(50,25);
                    ctx.lineTo(-25,0);
                    ctx.lineTo(-65,-50);
                    ctx.lineTo(-75,-100);
                    ctx.strokeStyle = "#333333cc";
                    ctx.lineWidth = game.defaultLineWidth*3;
                    ctx.stroke();
                    ctx.lineWidth = game.defaultLineWidth;

                    ctx.beginPath();
                    ctx.moveTo(-150,100);
                    ctx.lineTo(0,0);
                    ctx.lineTo(150,100);
                    ctx.moveTo(-125,50);
                    ctx.lineTo(0,-50);
                    ctx.lineTo(125,50);
                    ctx.moveTo(-100,0);
                    ctx.lineTo(0,-100);
                    ctx.lineTo(100,0);
                    ctx.strokeStyle = "#7c7";
                    ctx.fillStyle = "#99ff9944";
                    ctx.stroke();
                    ctx.fill();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#7c7";
                        ctx.fillStyle = "#9f9";
                        ctx.strokeText("Boosted",0,-150);
                        ctx.fillText("Boosted",0,-150);
                        ctx.strokeText("Drift",0,150);
                        ctx.fillText("Drift",0,150);
                    }
                },
                chooseFunction() {
                    stats.driftBoost = true;
                    stats.driftBoostCharge = 0;
                }
            },
            {
                name: "Particle Accelerator",
                desc: "Braking while accelerating removes max speed and reduces steering",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(50,0);
                    ctx.lineTo(35,35);
                    ctx.lineTo(0,50);
                    ctx.lineTo(-35,35);
                    ctx.lineTo(-50,0);
                    ctx.lineTo(-35,-35);
                    ctx.lineTo(0,-50);
                    ctx.lineTo(35,-35);
                    ctx.closePath();
                    ctx.strokeStyle = "#c77";
                    ctx.fillStyle = "#f99";
                    ctx.stroke();
                    ctx.fill();

                    ctx.save();
                    ctx.rotate(Math.PI/6);
                    ctx.beginPath();
                    for(var i = 0; i < 3; i++) {
                        ctx.rotate(Math.PI/3);

                        ctx.moveTo(65,0);
                        ctx.lineTo(40,105);
                        ctx.lineTo(0,130);
                        ctx.lineTo(-40,105);
                        ctx.lineTo(-65,0);
                        ctx.lineTo(-40,-105);
                        ctx.lineTo(0,-130);
                        ctx.lineTo(40,-105);
                        ctx.closePath();
                    }
                    ctx.strokeStyle = "#222";
                    ctx.stroke();
                    ctx.strokeStyle = "#222";
                    ctx.lineWidth = game.defaultLineWidth/2;
                    ctx.stroke();
                    ctx.lineWidth = game.defaultLineWidth;
                    ctx.restore();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#c77";
                        ctx.fillStyle = "#f99";
                        ctx.strokeText("Particle",0,-150);
                        ctx.fillText("Particle",0,-150);
                        ctx.strokeText("Accelerator",0,150);
                        ctx.fillText("Accelerator",0,150);
                    }
                },
                chooseFunction() {
                    stats.partAcc = true;
                }
            },
            {
                name: "Regenerative Brakes",
                desc: "Braking charges a boost that is released after",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(80,0);
                    ctx.lineTo(55,55);
                    ctx.lineTo(0,80);
                    ctx.lineTo(-55,55);
                    ctx.lineTo(-80,0);
                    ctx.lineTo(-55,-55);
                    ctx.lineTo(0,-80);
                    ctx.lineTo(55,-55);
                    ctx.closePath();
                    ctx.strokeStyle = "#333";
                    ctx.stroke();
                    ctx.fillStyle = "#999";
                    ctx.fill();

                    ctx.beginPath();
                    ctx.moveTo(-90,35);
                    ctx.lineTo(-100,0);
                    ctx.lineTo(-70,-70);
                    ctx.lineTo(0,-100);
                    ctx.lineTo(35,-90);
                    ctx.closePath();

                    ctx.moveTo(20,0);
                    ctx.lineTo(14,14);
                    ctx.lineTo(0,20);
                    ctx.lineTo(-14,14);
                    ctx.lineTo(-20,0);
                    ctx.lineTo(-14,-14);
                    ctx.lineTo(0,-20);
                    ctx.lineTo(14,-14);
                    ctx.closePath();
                    ctx.closePath();
                    ctx.strokeStyle = "#333";
                    ctx.stroke();
                    ctx.fillStyle = "#222";
                    ctx.fill();

                    ctx.beginPath();
                    ctx.moveTo(100,0);
                    ctx.lineTo(70,70);
                    ctx.lineTo(0,100);
                    ctx.lineTo(-70,70);
                    ctx.lineTo(-100,0);
                    ctx.lineTo(-70,-70);
                    ctx.lineTo(0,-100);
                    ctx.lineTo(70,-70);
                    ctx.lineTo(65,-90);
                    ctx.moveTo(70,-70);
                    ctx.lineTo(50,-60);
                    
                    ctx.strokeStyle = "#090";
                    ctx.lineWidth = game.defaultLineWidth*2;
                    ctx.stroke();
                    ctx.strokeStyle = "#0c0";
                    ctx.lineWidth = game.defaultLineWidth;
                    ctx.stroke();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#090";
                        ctx.fillStyle = "#0c0";
                        ctx.strokeText("Regenerative",0,-150);
                        ctx.fillText("Regenerative",0,-150);
                        ctx.strokeText("Brakes",0,150);
                        ctx.fillText("Brakes",0,150);
                    }
                },
                chooseFunction() {
                    stats.regenBrake = true;
                }
            },
        ]

        const stackablePunishments = [
            {
                name: "Thin Road",
                desc: "Roads are thinner",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(-150,100);
                    ctx.lineTo(0,-100);
                    ctx.lineTo(150,-100);
                    ctx.lineTo(0,100);
                    ctx.fillStyle = "#333"
                    ctx.fill();

                    ctx.beginPath();
                    ctx.moveTo(-150,100);
                    ctx.lineTo(0,-100);
                    ctx.moveTo(150,-100);
                    ctx.lineTo(0,100);
                    ctx.strokeStyle = "#666"
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(-67.5,90);
                    ctx.lineTo(-52.5, 70);
                    ctx.moveTo(-37.5,50);
                    ctx.lineTo(-22.5, 30);
                    ctx.moveTo(-7.5, 10);
                    ctx.lineTo(7.5, -10);
                    ctx.moveTo(22.5,-30);
                    ctx.lineTo(37.5, -50);
                    ctx.moveTo(52.5,-70);
                    ctx.lineTo(67.5, -90);
                    ctx.strokeStyle = "#990"
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(150,-20);
                    ctx.lineTo(120,20);
                    ctx.lineTo(70,20);
                    ctx.lineTo(45,40);
                    ctx.lineTo(30,0);
                    ctx.lineTo(115,-40);
                    ctx.lineTo(100,-20);
                    ctx.closePath();
                    ctx.moveTo(-150,20);
                    ctx.lineTo(-120,-20);
                    ctx.lineTo(-70,-20);
                    ctx.lineTo(-55,-40);
                    ctx.lineTo(-30,0);
                    ctx.lineTo(-115,40);
                    ctx.lineTo(-100,20);
                    ctx.closePath();
                    ctx.fillStyle = "#ffffff33";
                    ctx.fill();
                    ctx.strokeStyle = "#999";
                    ctx.stroke();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#333";
                        ctx.fillStyle = "#990";
                        ctx.strokeText("Thinner",0,-150);
                        ctx.fillText("Thinner",0,-150);
                        ctx.strokeText("Road",0,150);
                        ctx.fillText("Road",0,150);
                    }

                    ctx.lineWidth = game.defaultLineWidth;
                },
                chooseFunction() {
                    stats.roadSize *= 0.7;
                }
            },
            {
                name: "Curvy Roads",
                desc: "Increase the curvature of roads",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(-150,100);
                    ctx.lineTo(-50,50);
                    ctx.lineTo(25,0);
                    ctx.lineTo(0,-50);
                    ctx.lineTo(-150,-100);
                    ctx.lineTo(-100,-100);
                    ctx.lineTo(75,-50);
                    ctx.lineTo(125,0);
                    ctx.lineTo(100,50);
                    ctx.lineTo(0,100);
                    ctx.fillStyle = "#333"
                    ctx.fill();

                    ctx.beginPath();
                    ctx.moveTo(-75,100);
                    ctx.lineTo(-25,75);
                    ctx.moveTo(25,50);
                    ctx.lineTo(50,25);
                    ctx.moveTo(75,0);
                    ctx.lineTo(50,-25);
                    ctx.moveTo(25,-50);
                    ctx.lineTo(-30,-70);
                    ctx.moveTo(-125,-100);
                    ctx.lineTo(-87.5,-90);
                    ctx.strokeStyle = "#990"
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(-150,100);
                    ctx.lineTo(-50,50);
                    ctx.lineTo(25,0);
                    ctx.lineTo(0,-50);
                    ctx.lineTo(-150,-100);
                    ctx.moveTo(-100,-100);
                    ctx.lineTo(75,-50);
                    ctx.lineTo(125,0);
                    ctx.lineTo(100,50);
                    ctx.lineTo(0,100);
                    ctx.strokeStyle = "#666"
                    ctx.stroke();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#333";
                        ctx.fillStyle = "#990";
                        ctx.strokeText("Curvy",0,-150);
                        ctx.fillText("Curvy",0,-150);
                        ctx.strokeText("Road",0,150);
                        ctx.fillText("Road",0,150);
                    }

                    ctx.lineWidth = game.defaultLineWidth;
                },
                chooseFunction() {
                    stats.roadAngle *= 1.45;
                }
            },
            {
                name: "Longer Road",
                desc: "Longer road, more time allotted",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(-150,100);
                    ctx.lineTo(0,-100);
                    ctx.lineTo(150,-100);
                    ctx.lineTo(0,100);
                    ctx.fillStyle = "#333"
                    ctx.fill();

                    ctx.beginPath();
                    ctx.moveTo(-150,100);
                    ctx.lineTo(0,-100);
                    ctx.moveTo(150,-100);
                    ctx.lineTo(0,100);
                    ctx.strokeStyle = "#666"
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(-67.5,90);
                    ctx.lineTo(-52.5, 70);
                    ctx.moveTo(-37.5,50);
                    ctx.lineTo(-22.5, 30);
                    ctx.moveTo(-7.5, 10);
                    ctx.lineTo(7.5, -10);
                    ctx.moveTo(22.5,-30);
                    ctx.lineTo(37.5, -50);
                    ctx.moveTo(52.5,-70);
                    ctx.lineTo(67.5, -90);
                    ctx.strokeStyle = "#990"
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(-140,50);
                    ctx.lineTo(-80,50);
                    ctx.lineTo(-20,-30);
                    ctx.lineTo(10,-30);
                    ctx.lineTo(-20,-70);
                    ctx.lineTo(-110,-30);
                    ctx.lineTo(-80,-30);
                    ctx.closePath();

                    ctx.moveTo(10,50);
                    ctx.lineTo(70,50);
                    ctx.lineTo(130,-30);
                    ctx.lineTo(160,-30);
                    ctx.lineTo(130,-70);
                    ctx.lineTo(40,-30);
                    ctx.lineTo(70,-30);
                    ctx.closePath();
                    ctx.fillStyle = "#ffffff33";
                    ctx.fill();
                    ctx.strokeStyle = "#999";
                    ctx.stroke();
                

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#333";
                        ctx.fillStyle = "#990";
                        ctx.strokeText("Longer",0,-150);
                        ctx.fillText("Longer",0,-150);
                        ctx.strokeText("Road",0,150);
                        ctx.fillText("Road",0,150);
                    }

                    ctx.lineWidth = game.defaultLineWidth;
                },
                chooseFunction() {
                    stats.roadLength *= 1.2;
                    stats.timerMax *= 1.15;
                }
            },
            {
                name: "Bigger Leak",
                desc: "Minorly increased fuel Loss",
                drawFunction(timer) {
                    ctx.beginPath();
                    let num = 0;
                    for(var i = 0; i <= Math.PI*2; i += Math.PI/18) {
                        num++;
                        ctx.lineTo((40+80*(num == 1)+50*(num == 5)+20*(num == 7))*Math.cos(i),(40+80*(num == 1)+50*(num == 5)+20*(num == 7))*Math.sin(i));
                        if (num == 8) num = 0;
                    }
                    ctx.closePath();
                    ctx.strokeStyle = "#333";
                    ctx.stroke();
                    ctx.fillStyle = "#222";
                    ctx.fill();


                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#333";
                        ctx.fillStyle = "#990";
                        ctx.strokeText("Bigger",0,-150);
                        ctx.fillText("Bigger",0,-150);
                        ctx.strokeText("Leak",0,150);
                        ctx.fillText("Leak",0,150);
                    }
                },
                chooseFunction() {
                    stats.timerMax *= 0.92;
                }
            },
            {
                name: "Light Breeze",
                desc: "Winds can nudge you around",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.save();
                    ctx.translate(-50,0);
                    for (var i = 0; i < 3; i++) {
                        ctx.moveTo(-50,0);
                        ctx.lineTo(0,0);
                        ctx.lineTo(18,-7);
                        ctx.lineTo(25,-25);
                        ctx.lineTo(18,-43);
                        ctx.lineTo(0,-50);

                        ctx.translate(50,25);
                    }

                    ctx.strokeStyle = "#999";
                    ctx.lineWidth = game.defaultLineWidth*2;
                    ctx.stroke();
                    ctx.strokeStyle = "#ccc";
                    ctx.lineWidth = game.defaultLineWidth;
                    ctx.stroke();

                    ctx.restore();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#999";
                        ctx.fillStyle = "#ccc";
                        ctx.strokeText("Light",0,-150);
                        ctx.fillText("Light",0,-150);
                        ctx.strokeText("Breeze",0,150);
                        ctx.fillText("Breeze",0,150);
                    }
                },
                chooseFunction() {
                    if (!stats.wind) {
                        stats.wind = true;
                        stats.windForce = 0;
                    }
                    stats.windForce += 0.15;
                }
            },
            {
                name: "Slick Tires",
                desc: "Reduced Drifting friction",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(-80,0);
                    ctx.lineTo(-56,56);
                    ctx.lineTo(0,80);
                    ctx.lineTo(56,56);
                    ctx.lineTo(80,0);
                    ctx.lineTo(56,-56);
                    ctx.lineTo(0,-80);
                    ctx.lineTo(-56,-56);
                    ctx.closePath();
                    let num = 0;
                    ctx.strokeStyle = "#666";
                    ctx.stroke();
                    ctx.fillStyle = "#333";
                    ctx.fill();
                    ctx.beginPath();
                    ctx.moveTo(-100,0);
                    ctx.lineTo(-70,70);
                    ctx.lineTo(0,100);
                    ctx.lineTo(70,70);
                    ctx.lineTo(100,0);
                    ctx.lineTo(70,-70);
                    ctx.lineTo(0,-100);
                    ctx.lineTo(-70,-70);
                    ctx.closePath();
                    for(var i = Math.PI/8; i <= Math.PI*2+Math.PI/8; i += Math.PI/4) {
                        ctx.moveTo(100*Math.cos(i),100*Math.sin(i));
                        ctx.lineTo(110*Math.cos(i),110*Math.sin(i));
                    }
                    ctx.strokeStyle = "#00ffff99";
                    ctx.stroke();
                    
                    ctx.beginPath();
                    ctx.moveTo(50,0);
                    ctx.lineTo(35,35);
                    ctx.lineTo(0,50);
                    ctx.lineTo(-35,35);
                    ctx.lineTo(-50,0);
                    ctx.lineTo(-35,-35);
                    ctx.lineTo(0,-50);
                    ctx.lineTo(35,-35);
                    ctx.closePath();
                    ctx.strokeStyle = "#666";
                    ctx.stroke();
                    ctx.fillStyle = "#999";
                    ctx.fill();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#333";
                        ctx.fillStyle = "#666";
                        ctx.strokeText("Slick",0,-150);
                        ctx.fillText("Slick",0,-150);
                        ctx.strokeText("Tires",0,150);
                        ctx.fillText("Tires",0,150);
                    }
                },
                chooseFunction() {
                    stats.driftGrip *= 0.6;
                    stats.requiredDriftAngle *= 0.75;
                }
            },
            {
                name: "Road Hazards",
                desc: "Increased road hazard chances, reduced off-road speed",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(-125,100)
                    ctx.lineTo(125,100);
                    ctx.lineTo(0,-100);
                    ctx.closePath();
                    ctx.strokeStyle = "#640";
                    ctx.fillStyle = "#a93";
                    ctx.stroke();
                    ctx.fill();

                    ctx.beginPath();
                    ctx.moveTo(0,-75)
                    ctx.lineTo(0,50);
                    ctx.moveTo(0,75)
                    ctx.lineTo(0,80);
                    ctx.closePath();
                    ctx.strokeStyle = "#333";
                    ctx.lineWidth = game.defaultLineWidth*2;
                    ctx.stroke();
                    ctx.strokeStyle = "#111";
                    ctx.lineWidth = game.defaultLineWidth;
                    ctx.stroke();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#640";
                        ctx.fillStyle = "#a93";
                        ctx.strokeText("Road",0,-150);
                        ctx.fillText("Road",0,-150);
                        ctx.strokeText("Hazards",0,150);
                        ctx.fillText("Hazards",0,150);
                    }
                },
                chooseFunction() {
                    stats.roadHazardChance *= 1.3;
                    stats.offroadSpeedLoss *= 1.4;
                }
            },
            {
                name: "Slipping Clutch",
                desc: "Reduced Acceleration",
                drawFunction(timer) {
                    ctx.beginPath();
                    let num = 0;
                    for(var i = 0; i <= Math.PI*2; i += Math.PI/18) {
                        num++;
                        ctx.lineTo((80-20*(num == 3))*Math.cos(i),(80-20*(num == 3))*Math.sin(i));
                        if (num == 3) num = 0;
                    }
                    ctx.moveTo(40,0)
                    for(var i = 0; i <= Math.PI*2; i += Math.PI/6) {
                        ctx.lineTo(40*Math.cos(i),40*Math.sin(i));
                    }
                    ctx.closePath();
                    ctx.moveTo(-100,0);
                    ctx.lineTo(-70,70);
                    ctx.lineTo(0,100);
                    ctx.lineTo(70,70);
                    ctx.lineTo(100,0);
                    ctx.lineTo(70,-70);
                    ctx.lineTo(0,-100);
                    ctx.lineTo(-70,-70);
                    ctx.closePath();
                    ctx.strokeStyle = "#666";
                    ctx.stroke();
                    ctx.fillStyle = "#333";
                    ctx.fill();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#333";
                        ctx.fillStyle = "#666";
                        ctx.strokeText("Slipping",0,-150);
                        ctx.fillText("Slipping",0,-150);
                        ctx.strokeText("Clutch",0,150);
                        ctx.fillText("Clutch",0,150);
                    }
                },
                chooseFunction() {
                    stats.acceleration *= 0.8;
                }
            },
        ]

        const unStackablePunishments = [
            {
                name: "F O G",
                desc: "The  F O G  is here: Heavily obscures vision",
                drawFunction(timer) {
                    ctx.beginPath();
                    linearGradient = ctx.createLinearGradient(0, -200, 0, 200);

                    linearGradient.addColorStop(0, "#cccccc99");
                    linearGradient.addColorStop(0.1, "#cccccc");
                    linearGradient.addColorStop(1, "#cccccc00");

                    ctx.fillStyle = linearGradient;
                    ctx.moveTo(-100,0);
                    ctx.lineTo(-70,70);
                    ctx.lineTo(0,100);
                    ctx.lineTo(70,70);
                    ctx.lineTo(100,0);
                    ctx.lineTo(70,-70);
                    ctx.lineTo(0,-100);
                    ctx.lineTo(-70,-70);
                    ctx.closePath();
                    ctx.strokeStyle = "#ccc";
                    ctx.fill();
                    ctx.stroke();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#999";
                        ctx.fillStyle = "#ccc";
                        ctx.strokeText("F O G",0,150);
                        ctx.fillText("F O G",0,150);
                    }
                },
                chooseFunction() {
                    stats.fog = true;
                },
            },
            {
                name: "Unpowered Steering",
                desc: "Heavily reduces turning speed",
                drawFunction(timer) {
                    ctx.save();
                    ctx.rotate(-Math.PI/6);

                    ctx.beginPath();
                    ctx.rect(50,-15,80,30);
                    ctx.strokeStyle = "#333";
                    ctx.stroke();
                    ctx.fillStyle = "#999";
                    ctx.fill();
                    ctx.beginPath();
                    ctx.rect(-120,-30,170,60);
                    ctx.rect(120,-20,20,40);
                    ctx.strokeStyle = "#333";
                    ctx.stroke();
                    ctx.fillStyle = "#69c";
                    ctx.fill();

                    ctx.restore();

                    ctx.beginPath();
                    ctx.moveTo(100,0);
                    ctx.lineTo(70,70);
                    ctx.lineTo(0,100);
                    ctx.lineTo(-70,70);
                    ctx.lineTo(-100,0);
                    ctx.lineTo(-70,-70);
                    ctx.lineTo(0,-100);
                    ctx.lineTo(70,-70);
                    ctx.closePath();
                    ctx.moveTo(-65, -65);
                    ctx.lineTo(65, 65);
                    
                    ctx.strokeStyle = "#900";
                    ctx.lineWidth = game.defaultLineWidth*2;
                    ctx.stroke();
                    ctx.strokeStyle = "#c00";
                    ctx.lineWidth = game.defaultLineWidth;
                    ctx.stroke();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#333";
                        ctx.fillStyle = "#69c";
                        ctx.strokeText("Unpowered",0,-150);
                        ctx.fillText("Unpowered",0,-150);
                        ctx.strokeText("Steering",0,150);
                        ctx.fillText("Steering",0,150);
                    }
                },
                chooseFunction() {
                    stats.turnSpeed *= 0.25;
                }
            },
            {
                name: "Pot Holes",
                desc: "Pot holes can spawn on the road",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(-150,100);
                    ctx.lineTo(0,-100);
                    ctx.lineTo(150,-100);
                    ctx.lineTo(0,100);
                    ctx.fillStyle = "#333"
                    ctx.fill();

                    ctx.beginPath();
                    ctx.moveTo(-150,100);
                    ctx.lineTo(0,-100);
                    ctx.moveTo(150,-100);
                    ctx.lineTo(0,100);
                    ctx.strokeStyle = "#666"
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(-67.5,90);
                    ctx.lineTo(-52.5, 70);
                    ctx.moveTo(-37.5,50);
                    ctx.lineTo(-22.5, 30);
                    ctx.moveTo(-7.5, 10);
                    ctx.lineTo(7.5, -10);
                    ctx.moveTo(22.5,-30);
                    ctx.lineTo(37.5, -50);
                    ctx.moveTo(52.5,-70);
                    ctx.lineTo(67.5, -90);
                    ctx.strokeStyle = "#990"
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(5,-40);
                    ctx.lineTo(-10,-25);
                    ctx.lineTo(-25,-40);
                    ctx.lineTo(-10,-55);
                    ctx.closePath();
                    ctx.moveTo(30,30);
                    ctx.lineTo(15,45);
                    ctx.lineTo(0,30);
                    ctx.lineTo(15,15);
                    ctx.closePath();
                    ctx.moveTo(-45,40);
                    ctx.lineTo(-60,55);
                    ctx.lineTo(-75,40);
                    ctx.lineTo(-60,25);
                    ctx.closePath();
                    ctx.strokeStyle = "#999";
                    ctx.stroke();
                    ctx.fillStyle = "#222";
                    ctx.fill();
                

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#333";
                        ctx.fillStyle = "#990";
                        ctx.strokeText("Pot",0,-150);
                        ctx.fillText("Pot",0,-150);
                        ctx.strokeText("Holes",0,150);
                        ctx.fillText("Holes",0,150);
                    }

                    ctx.lineWidth = game.defaultLineWidth;
                },
                chooseFunction() {
                    stats.potholes = true;
                }
            },
            {
                name: "Strong Winds",
                desc: "Winds can push you around",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.save();
                    ctx.translate(-75,30);
                    for (var i = 0; i < 3; i++) {
                        ctx.moveTo(-50,0);
                        ctx.lineTo(0,0);
                        ctx.lineTo(18,-7);
                        ctx.lineTo(25,-25);
                        ctx.lineTo(18,-43);
                        ctx.lineTo(0,-50);

                        ctx.translate(50,25);
                    }
                    ctx.translate(-100,-150);
                    for (var i = 0; i < 3; i++) {
                        ctx.moveTo(-50,0);
                        ctx.lineTo(0,0);
                        ctx.lineTo(18,-7);
                        ctx.lineTo(25,-25);
                        ctx.lineTo(18,-43);
                        ctx.lineTo(0,-50);

                        ctx.translate(50,25);
                    }

                    ctx.strokeStyle = "#999";
                    ctx.lineWidth = game.defaultLineWidth*2;
                    ctx.stroke();
                    ctx.strokeStyle = "#ccc";
                    ctx.lineWidth = game.defaultLineWidth;
                    ctx.stroke();

                    ctx.restore();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#999";
                        ctx.fillStyle = "#ccc";
                        ctx.strokeText("Strong",0,-150);
                        ctx.fillText("Strong",0,-150);
                        ctx.strokeText("Winds",0,150);
                        ctx.fillText("Winds",0,150);
                    }
                },
                chooseFunction() {
                    if (!stats.wind) {
                        stats.wind = true;
                        stats.windForce = 0;
                    }
                    stats.windForce += 0.33;
                }
            },
            {
                name: "Slippery Road",
                desc: "Drifts are harder to control",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(-150,100);
                    ctx.lineTo(-50,50);
                    ctx.lineTo(25,0);
                    ctx.lineTo(0,-50);
                    ctx.lineTo(-150,-100);
                    ctx.lineTo(-100,-100);
                    ctx.lineTo(75,-50);
                    ctx.lineTo(125,0);
                    ctx.lineTo(100,50);
                    ctx.lineTo(0,100);
                    ctx.fillStyle = "#356"
                    ctx.fill();

                    ctx.beginPath();
                    ctx.moveTo(-75,100);
                    ctx.lineTo(-25,75);
                    ctx.moveTo(25,50);
                    ctx.lineTo(50,25);
                    ctx.moveTo(75,0);
                    ctx.lineTo(50,-25);
                    ctx.moveTo(25,-50);
                    ctx.lineTo(-30,-70);
                    ctx.moveTo(-125,-100);
                    ctx.lineTo(-87.5,-90);
                    ctx.strokeStyle = "#990"
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(-150,100);
                    ctx.lineTo(-50,50);
                    ctx.lineTo(25,0);
                    ctx.lineTo(0,-50);
                    ctx.lineTo(-150,-100);
                    ctx.moveTo(-100,-100);
                    ctx.lineTo(75,-50);
                    ctx.lineTo(125,0);
                    ctx.lineTo(100,50);
                    ctx.lineTo(0,100);
                    ctx.strokeStyle = "#666"
                    ctx.stroke();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#333";
                        ctx.fillStyle = "#356";
                        ctx.strokeText("Slippery",0,-150);
                        ctx.fillText("Slippery",0,-150);
                        ctx.strokeText("Road",0,150);
                        ctx.fillText("Road",0,150);
                    }

                    ctx.lineWidth = game.defaultLineWidth;
                },
                chooseFunction() {
                    stats.driftGrip *= 0.4;
                    stats.requiredDriftAngle *= 0.2;
                    stats.slipRoad = true;
                }
            },
            {
                name: "Sweaty Palms",
                desc: "Every once and a while, you lose grip",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(-40,100);
                    ctx.lineTo(-55,0);
                    ctx.lineTo(-50,-75);
                    ctx.lineTo(-40,-75);
                    ctx.lineTo(-35,-0);
                    ctx.lineTo(-30,-90);
                    ctx.lineTo(-20,-90);
                    ctx.lineTo(-15,-0);
                    ctx.lineTo(-10,-100);
                    ctx.lineTo(0,-100);
                    ctx.lineTo(5,-0);
                    ctx.lineTo(10,-90);
                    ctx.lineTo(20,-90);
                    ctx.lineTo(25,0);
                    ctx.lineTo(35,30);
                    ctx.lineTo(60,-30);
                    ctx.lineTo(67,-27);
                    ctx.lineTo(50,40);
                    ctx.lineTo(30,90);
                    ctx.closePath();
                    ctx.strokeStyle = "#333";
                    ctx.stroke();
                    ctx.fillStyle = "#c96";
                    ctx.fill();

                    ctx.beginPath();
                    ctx.moveTo(-5,-5);
                    ctx.lineTo(5,30);
                    ctx.lineTo(20,50);
                    ctx.lineTo(15,70);
                    ctx.lineTo(-5,80);
                    ctx.lineTo(-25,70);
                    ctx.lineTo(-30,50);
                    ctx.lineTo(-15,30);
                    ctx.closePath();
                    ctx.strokeStyle = "#369";
                    ctx.stroke();
                    ctx.fillStyle = "#69c";

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#333";
                        ctx.fillStyle = "#c96";
                        ctx.strokeText("Sweaty",0,-150);
                        ctx.fillText("Sweaty",0,-150);
                        ctx.strokeText("Palms",0,150);
                        ctx.fillText("Palms",0,150);
                    }
                },
                chooseFunction() {
                    stats.sweaty = true;
                }
            },
            {
                name: "Old Discs",
                desc: "Braking and reversing compromised, reduced acceleration",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(80,0);
                    ctx.lineTo(55,55);
                    ctx.lineTo(0,80);
                    ctx.lineTo(-55,55);
                    ctx.lineTo(-80,0);
                    ctx.lineTo(-55,-55);
                    ctx.lineTo(0,-80);
                    ctx.lineTo(55,-55);
                    ctx.closePath();
                    ctx.strokeStyle = "#333";
                    ctx.stroke();
                    ctx.fillStyle = "#999";
                    ctx.fill();

                    ctx.beginPath();
                    ctx.moveTo(-90,35);
                    ctx.lineTo(-100,0);
                    ctx.lineTo(-70,-70);
                    ctx.lineTo(0,-100);
                    ctx.lineTo(35,-90);
                    ctx.closePath();

                    ctx.moveTo(20,0);
                    ctx.lineTo(14,14);
                    ctx.lineTo(0,20);
                    ctx.lineTo(-14,14);
                    ctx.lineTo(-20,0);
                    ctx.lineTo(-14,-14);
                    ctx.lineTo(0,-20);
                    ctx.lineTo(14,-14);
                    ctx.closePath();
                    ctx.closePath();
                    ctx.strokeStyle = "#333";
                    ctx.stroke();
                    ctx.fillStyle = "#222";
                    ctx.fill();

                    ctx.beginPath();
                    ctx.moveTo(100,0);
                    ctx.lineTo(70,70);
                    ctx.lineTo(0,100);
                    ctx.lineTo(-70,70);
                    ctx.lineTo(-100,0);
                    ctx.lineTo(-70,-70);
                    ctx.lineTo(0,-100);
                    ctx.lineTo(70,-70);
                    ctx.closePath();
                    ctx.moveTo(-65, -65);
                    ctx.lineTo(65, 65);
                    
                    ctx.strokeStyle = "#900";
                    ctx.lineWidth = game.defaultLineWidth*2;
                    ctx.stroke();
                    ctx.strokeStyle = "#c00";
                    ctx.lineWidth = game.defaultLineWidth;
                    ctx.stroke();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#333";
                        ctx.fillStyle = "#666";
                        ctx.strokeText("Old",0,-150);
                        ctx.fillText("Old",0,-150);
                        ctx.strokeText("Discs",0,150);
                        ctx.fillText("Discs",0,150);
                    }
                },
                chooseFunction() {
                    stats.noBrake = true;
                    stats.acceleration *= 0.7;
                }
            },
            {
                name: "Failing Engine",
                desc: "The engine turns off every once and a while, reduced top speed",
                drawFunction(timer) {
                    ctx.save();
                    ctx.rotate(-Math.PI/12);

                    ctx.beginPath();
                    ctx.rect(-120,-80,240,160);
                    ctx.strokeStyle = "#333";
                    ctx.stroke();
                    ctx.fillStyle = "#999";
                    ctx.fill();
                    ctx.beginPath();
                    ctx.rect(-115,-15,230,30);
                    ctx.strokeStyle = "#666"
                    ctx.stroke();
                    ctx.fillStyle = "#444";
                    ctx.fill();

                    ctx.beginPath();
                    ctx.rect(-95,-70,40,40);
                    ctx.rect(-20,-70,40,40);
                    ctx.rect(55,-70,40,40);
                    ctx.rect(-95,30,40,40);
                    ctx.rect(-20,30,40,40);
                    ctx.moveTo(95,50);
                    ctx.rect(55,30,40,40);
                    ctx.strokeStyle = "#333"
                    ctx.stroke();
                    ctx.fillStyle = "#222";
                    ctx.fill();

                    ctx.restore();

                    ctx.beginPath();
                    ctx.moveTo(100,0);
                    ctx.lineTo(70,70);
                    ctx.lineTo(0,100);
                    ctx.lineTo(-70,70);
                    ctx.lineTo(-100,0);
                    ctx.lineTo(-70,-70);
                    ctx.lineTo(0,-100);
                    ctx.lineTo(70,-70);
                    ctx.closePath();
                    ctx.moveTo(-65, -65);
                    ctx.lineTo(65, 65);
                    
                    ctx.strokeStyle = "#900";
                    ctx.lineWidth = game.defaultLineWidth*2;
                    ctx.stroke();
                    ctx.strokeStyle = "#c00";
                    ctx.lineWidth = game.defaultLineWidth;
                    ctx.stroke();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#333";
                        ctx.fillStyle = "#666";
                        ctx.strokeText("Failing",0,-150);
                        ctx.fillText("Failing",0,-150);
                        ctx.strokeText("Engine",0,150);
                        ctx.fillText("Engine",0,150);
                    }
                },
                chooseFunction() {
                    stats.engineFailure = true;
                    stats.topSpeed *= 0.93;
                }
            },
            {
                name: "Oil Spills",
                desc: "Oil spills on the road",
                drawFunction(timer) {
                    ctx.save();
                    ctx.rotate(Math.PI/12);
                    
                    ctx.save();
                    ctx.scale(1,0.5);

                    ctx.beginPath();
                    ctx.moveTo(60,180);
                    ctx.lineTo(42,222);
                    ctx.lineTo(0,240);
                    ctx.lineTo(-42,222);
                    ctx.lineTo(-60,180);
                    ctx.rect(-60,-180,120,360);
                    ctx.strokeStyle = "#222";
                    ctx.stroke();
                    ctx.fillStyle = "#444";
                    ctx.fill();
                    ctx.beginPath();
                    ctx.moveTo(60,-180);
                    ctx.lineTo(42,-142);
                    ctx.lineTo(0,-120);
                    ctx.lineTo(-42,-142);
                    ctx.lineTo(-60,-180);
                    ctx.lineTo(-42,-222);
                    ctx.lineTo(0,-240);
                    ctx.lineTo(42,-222);
                    ctx.closePath();
                    ctx.strokeStyle = "#222";
                    ctx.stroke();
                    ctx.fillStyle = "#444";
                    ctx.fill();

                    ctx.restore();
                    
                    ctx.beginPath();
                    ctx.moveTo(0,-40);
                    ctx.lineTo(5,-15);
                    ctx.lineTo(15,10);
                    ctx.lineTo(30,30);
                    ctx.lineTo(40,50);
                    ctx.lineTo(40,70);
                    ctx.lineTo(30,80);
                    ctx.lineTo(20,90);
                    ctx.lineTo(0,100);
                    ctx.lineTo(-20,90);
                    ctx.lineTo(-30,80);
                    ctx.lineTo(-40,70);
                    ctx.lineTo(-40,50);
                    ctx.lineTo(-30,30);
                    ctx.lineTo(-15,10);
                    ctx.closePath();

                    //ctx.arc(80,-50,80,Math.PI,Math.PI*3/4, true);
                    //ctx.arc(0,30,40,0,Math.PI);
                    //ctx.arc(-80,-50,80,Math.PI/4, 0, true);
                    ctx.strokeStyle = "#222";
                    ctx.stroke();
                    ctx.fillStyle = "#000";
                    ctx.fill();

                    ctx.restore();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.strokeStyle = "#000";
                        ctx.fillStyle = "#222";
                        ctx.strokeText("Oil",0,-150);
                        ctx.fillText("Oil",0,-150);
                        ctx.strokeText("Spills",0,150);
                        ctx.fillText("Spills",0,150);
                    }
                },
                chooseFunction() {
                    stats.oilslick = true;
                }
            },
            {
                name: "Muddy Road",
                desc: "Wet mud on the road",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(-150,100);
                    ctx.lineTo(0,-100);
                    ctx.lineTo(150,-100);
                    ctx.lineTo(0,100);
                    ctx.fillStyle = "#333"
                    ctx.fill();

                    ctx.beginPath();
                    ctx.moveTo(-150,100);
                    ctx.lineTo(0,-100);
                    ctx.moveTo(150,-100);
                    ctx.lineTo(0,100);
                    ctx.strokeStyle = "#666"
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(-67.5,90);
                    ctx.lineTo(-52.5, 70);
                    ctx.moveTo(-37.5,50);
                    ctx.lineTo(-22.5, 30);
                    ctx.moveTo(-7.5, 10);
                    ctx.lineTo(7.5, -10);
                    ctx.moveTo(22.5,-30);
                    ctx.lineTo(37.5, -50);
                    ctx.moveTo(52.5,-70);
                    ctx.lineTo(67.5, -90);
                    ctx.strokeStyle = "#990"
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(80,0);
                    ctx.lineTo(55,55);
                    ctx.lineTo(0,80);
                    ctx.lineTo(-55,55);
                    ctx.lineTo(-80,0);
                    ctx.lineTo(-55,-55);
                    ctx.lineTo(0,-80);
                    ctx.lineTo(55,-55);
                    ctx.closePath();
                    ctx.strokeStyle = "#321"
                    ctx.stroke();
                    ctx.fillStyle = "#553322cc";
                    ctx.fill();;
                

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.fillStyle = "#532";
                        ctx.strokeStyle = "#321";
                        ctx.strokeText("Muddy",0,-150);
                        ctx.fillText("Muddy",0,-150);
                        ctx.strokeText("Road",0,150);
                        ctx.fillText("Road",0,150);
                    }

                    ctx.lineWidth = game.defaultLineWidth;
                },
                chooseFunction() {
                    stats.mud = true;
                }
            },
            {
                name: "Big Bugs",
                desc: "Bugs can splatter on your windsheild",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(5,-25);
                    ctx.lineTo(-20,30);
                    ctx.lineTo(-75,55);
                    ctx.lineTo(-130,30);
                    ctx.lineTo(-155,-25);
                    ctx.lineTo(-130,-80);
                    ctx.lineTo(-75,-105);
                    ctx.lineTo(-20,-80);
                    ctx.closePath();
                    ctx.moveTo(-5,-25);
                    ctx.lineTo(20,30);
                    ctx.lineTo(75,55);
                    ctx.lineTo(130,30);
                    ctx.lineTo(155,-25);
                    ctx.lineTo(130,-80);
                    ctx.lineTo(75,-105);
                    ctx.lineTo(20,-80);
                    ctx.closePath();
                    ctx.fillStyle = "#999";
                    ctx.fill();
                    ctx.strokeStyle = "#ccc";
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.moveTo(80,25);
                    ctx.lineTo(55,80);
                    ctx.lineTo(0,105);
                    ctx.lineTo(-55,80);
                    ctx.lineTo(-80,25);
                    ctx.lineTo(-55,-30);
                    ctx.lineTo(0,-55);
                    ctx.lineTo(55,-30);
                    ctx.closePath();
                    ctx.fillStyle = "#222";
                    ctx.fill();
                    ctx.strokeStyle = "#444";
                    ctx.stroke();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.fillStyle = "#252";
                        ctx.strokeStyle = "#232";
                        ctx.strokeText("Big",0,-150);
                        ctx.fillText("Big",0,-150);
                        ctx.strokeText("Bugs",0,150);
                        ctx.fillText("Bugs",0,150);
                    }

                    ctx.lineWidth = game.defaultLineWidth;
                },
                chooseFunction() {
                    stats.bug = true;
                }
            },
            {
                name: "Sleepy",
                desc: "Every once and a while your eyes close, then re-open",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(0,-25);
                    ctx.lineTo(100,-25);
                    ctx.lineTo(0,75);
                    ctx.lineTo(100,75);

                    ctx.moveTo(-50,-85);
                    ctx.lineTo(25,-85);
                    ctx.lineTo(-50,-10);
                    ctx.lineTo(25,-10);
                    
                    ctx.moveTo(-90,-115);
                    ctx.lineTo(-40,-115);
                    ctx.lineTo(-90,-65);
                    ctx.lineTo(-40,-65);
                    ctx.lineWidth = game.defaultLineWidth*2;
                    ctx.strokeStyle = "#226";
                    ctx.stroke();
                    ctx.lineWidth = game.defaultLineWidth;
                    ctx.strokeStyle = "#449";
                    ctx.stroke();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.fillStyle = "#449";
                        ctx.strokeStyle = "#226";
                        ctx.strokeText("Sleepy",0,150);
                        ctx.fillText("Sleepy",0,150);
                    }

                    ctx.lineWidth = game.defaultLineWidth;
                },
                chooseFunction() {
                    stats.sleepy = true;
                    stats.eyePos = 1000;
                    stats.eyeVel = -100;
                }
            },
            {
                name: "Reverse Rack & Pinion",
                desc: "Inverted Steering",
                drawFunction(timer) {
                    ctx.beginPath();
                    let num = 0;
                    for(var i = 0; i <= Math.PI*2; i += Math.PI/9) {
                        num++;
                        ctx.lineTo((80-30*(num == 3))*Math.cos(i),(80-30*(num == 3))*Math.sin(i)-35);
                        if (num == 3) num = 0;
                    }
                    ctx.closePath();
                    ctx.moveTo(-125,50);
                    ctx.lineTo(-112.5,50);
                    num = 0;
                    for(var i = -100; i <= 100; i += 25) {
                        num++;
                        ctx.lineTo(i+12.5,50-25*(num == 1));
                        if (num == 3) num = 0;
                    }
                    ctx.lineTo(125,50);
                    ctx.lineTo(125,70);
                    ctx.lineTo(-125,70);
                    ctx.closePath();
                    ctx.strokeStyle = "#666";
                    ctx.stroke();
                    ctx.fillStyle = "#333";
                    ctx.fill();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.fillStyle = "#999";
                        ctx.strokeStyle = "#555";
                        ctx.strokeText("Reverse",0,-150);
                        ctx.fillText("Reverse",0,-150);
                        ctx.strokeText("Rack & Pinion",0,150);
                        ctx.fillText("Rack & Pinion",0,150);
                    }

                    ctx.lineWidth = game.defaultLineWidth;
                },
                chooseFunction() {
                    stats.invertSteering = true;
                }
            },
            {
                name: "Black Ice",
                desc: "Barely visible black ice spawns",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(-100,0);
                    ctx.lineTo(100,0);
                    ctx.moveTo(0,-100);
                    ctx.lineTo(0,100);
                    ctx.moveTo(-70,-70);
                    ctx.lineTo(70,70);
                    ctx.moveTo(70,-70);
                    ctx.lineTo(-70,70);
                    ctx.moveTo(-90,-25);
                    ctx.lineTo(-70,0);
                    ctx.lineTo(-90,25);
                    ctx.moveTo(90,-25);
                    ctx.lineTo(70,0);
                    ctx.lineTo(90,25);
                    ctx.moveTo(-25,90);
                    ctx.lineTo(0,70);
                    ctx.lineTo(25,90);
                    ctx.moveTo(-25,-90);
                    ctx.lineTo(0,-70);
                    ctx.lineTo(25,-90);
                    ctx.moveTo(-80,-50);
                    ctx.lineTo(-50,-50);
                    ctx.lineTo(-50,-80);
                    ctx.moveTo(-80,50);
                    ctx.lineTo(-50,50);
                    ctx.lineTo(-50,80);
                    ctx.moveTo(80,-50);
                    ctx.lineTo(50,-50);
                    ctx.lineTo(50,-80);
                    ctx.moveTo(80,50);
                    ctx.lineTo(50,50);
                    ctx.lineTo(50,80);
                    ctx.lineWidth = game.defaultLineWidth*2;
                    ctx.strokeStyle = "#444";
                    ctx.stroke();
                    ctx.lineWidth = game.defaultLineWidth;
                    ctx.strokeStyle = "#222";
                    ctx.stroke();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.fillStyle = "#444";
                        ctx.strokeStyle = "#222";
                        ctx.strokeText("Black",0,-150);
                        ctx.fillText("Black",0,-150);
                        ctx.strokeText("Ice",0,150);
                        ctx.fillText("Ice",0,150);
                    }

                    ctx.lineWidth = game.defaultLineWidth;
                },
                chooseFunction() {
                    stats.bIce = true;
                }
            },
            {
                name: "Windsheild Crack",
                desc: "Gain a crack on the windsheild that slowly grows",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(0,0);
                    ctx.lineTo(50,0);
                    ctx.lineTo(75,-25);
                    ctx.lineTo(85,-45);
                    ctx.moveTo(75,-25);
                    ctx.lineTo(100,25);
                    ctx.moveTo(0,0);
                    ctx.lineTo(35,-20);
                    ctx.moveTo(0,0);
                    ctx.lineTo(-15,50);
                    ctx.lineTo(-10,75);
                    ctx.lineTo(45,85);
                    ctx.moveTo(-10,75);
                    ctx.lineTo(-25,100);
                    ctx.moveTo(0,0);
                    ctx.lineTo(-50,-50);
                    ctx.lineTo(-40,-10);
                    ctx.lineTo(-80,20);
                    ctx.moveTo(-50,-50);
                    ctx.lineTo(-30,-80);
                    ctx.lineWidth = game.defaultLineWidth*2;
                    ctx.strokeStyle = "#999";
                    ctx.stroke();
                    ctx.lineWidth = game.defaultLineWidth;
                    ctx.strokeStyle = "#fff";
                    ctx.stroke();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.fillStyle = "#fff";
                        ctx.strokeStyle = "#999";
                        ctx.strokeText("Windsheild",0,-150);
                        ctx.fillText("Windsheild",0,-150);
                        ctx.strokeText("Crack",0,150);
                        ctx.fillText("Crack",0,150);
                    }

                    ctx.lineWidth = game.defaultLineWidth;
                },
                chooseFunction() {
                    let pos = { x: -100 + 200*Math.random(), y: -50 + 100*Math.random() };
                    stats.crack = [[[pos.x-25+Math.random()*50,pos.y-25+Math.random()*50],[pos.x,pos.y],[pos.x-25+Math.random()*50,pos.y-25+Math.random()*50]],[[pos.x-25+Math.random()*50,pos.y-25+Math.random()*50],[pos.x,pos.y],[pos.x-25+Math.random()*50,pos.y-25+Math.random()*50]]];
                    developCrack();
                }
            },
            {
                name: "Heavy Handed",
                desc: "Your cursor slowly falls downard",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(-40,100);
                    ctx.lineTo(-55,0);
                    ctx.lineTo(-50,-75);
                    ctx.lineTo(-40,-75);
                    ctx.lineTo(-35,-0);
                    ctx.lineTo(-30,-90);
                    ctx.lineTo(-20,-90);
                    ctx.lineTo(-15,-0);
                    ctx.lineTo(-10,-100);
                    ctx.lineTo(0,-100);
                    ctx.lineTo(5,-0);
                    ctx.lineTo(10,-90);
                    ctx.lineTo(20,-90);
                    ctx.lineTo(25,0);
                    ctx.lineTo(35,30);
                    ctx.lineTo(60,-30);
                    ctx.lineTo(67,-27);
                    ctx.lineTo(50,40);
                    ctx.lineTo(30,90);
                    ctx.closePath();
                    ctx.strokeStyle = "#222";
                    ctx.lineWidth = game.defaultLineWidth*2;
                    ctx.stroke();
                    ctx.strokeStyle = "#333";
                    ctx.lineWidth = game.defaultLineWidth;
                    ctx.stroke();
                    ctx.fillStyle = "#555";
                    ctx.fill();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.fillStyle = "#666";
                        ctx.strokeStyle = "#333";
                        ctx.strokeText("Heavy",0,-150);
                        ctx.fillText("Heavy",0,-150);
                        ctx.strokeText("Handed",0,150);
                        ctx.fillText("Handed",0,150);
                    }

                    ctx.lineWidth = game.defaultLineWidth;
                },
                chooseFunction() {
                    stats.heavyHand = true;
                }
            },
            /*{
                name: "Relaxed Muscles",
                desc: "Cursor movement velocity is fixed",
                drawFunction(timer) {
                    ctx.save();
                    ctx.rotate(-Math.PI/6);
                    ctx.beginPath();
                    ctx.moveTo(-80,0);
                    ctx.lineTo(-40,20);
                    ctx.lineTo(0,25);
                    ctx.lineTo(40,20);
                    ctx.lineTo(80,0);
                    ctx.lineTo(40,-20);
                    ctx.lineTo(0,-25);
                    ctx.lineTo(-40,-20);
                    ctx.closePath();
                    ctx.strokeStyle = "#c33";
                    ctx.stroke();
                    ctx.fillStyle = "#f66";
                    ctx.fill();
                    
                    ctx.beginPath();
                    ctx.moveTo(-80,0);
                    ctx.lineTo(-40,12.5);
                    ctx.lineTo(0,17.5);
                    ctx.lineTo(40,12.5);
                    ctx.lineTo(80,0);
                    ctx.lineTo(40,-12.5);
                    ctx.lineTo(0,-17.5);
                    ctx.lineTo(-40,-12.5);
                    ctx.closePath();
                    ctx.moveTo(-80,0);
                    ctx.lineTo(80,0);
                    ctx.lineWidth = game.defaultLineWidth/3;
                    ctx.strokeStyle = "#c33";
                    ctx.stroke();
                    
                    ctx.beginPath();
                    ctx.moveTo(-100,0);
                    ctx.lineTo(-60,10);
                    ctx.lineTo(-60,-10);
                    ctx.closePath();
                    ctx.moveTo(100,0);
                    ctx.lineTo(60,10);
                    ctx.lineTo(60,-10);
                    ctx.closePath();
                    ctx.lineWidth = game.defaultLineWidth;
                    ctx.strokeStyle = "#c66";
                    ctx.stroke();
                    ctx.fillStyle = "#f99";
                    ctx.fill();

                    ctx.restore();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.fillStyle = "#f66";
                        ctx.strokeStyle = "#c33";
                        ctx.strokeText("Relaxed",0,-150);
                        ctx.fillText("Relaxed",0,-150);
                        ctx.strokeText("Muscles",0,150);
                        ctx.fillText("Muscles",0,150);
                    }

                    ctx.lineWidth = game.defaultLineWidth;
                },
                chooseFunction() {
                    stats.heavyHand = true;
                }
            },*/
            {
                name: "Poltergeist",
                desc: "dashboard elements randomly arranged themselves every level",
                drawFunction(timer) {                  
                    ctx.beginPath();
                    ctx.moveTo(-100,-50);
                    ctx.lineTo(-60,0);
                    ctx.lineTo(-20,20);
                    ctx.lineTo(20,20);
                    ctx.lineTo(60,0);
                    ctx.lineTo(100,-50);
                    ctx.lineTo(80,10);
                    ctx.lineTo(60,50);
                    ctx.lineTo(20,80);
                    ctx.lineTo(-20,80);
                    ctx.lineTo(-60,50);
                    ctx.lineTo(-80,10);
                    ctx.closePath();
                    ctx.moveTo(-40,-90);
                    ctx.lineTo(-60,-60);
                    ctx.lineTo(-40,-30);
                    ctx.lineTo(-20,-60);
                    ctx.closePath();
                    ctx.moveTo(40,-90);
                    ctx.lineTo(60,-60);
                    ctx.lineTo(40,-30);
                    ctx.lineTo(20,-60);
                    ctx.closePath();
                    ctx.fillStyle = "#96f";
                    ctx.strokeStyle = "#93c";
                    ctx.stroke();
                    ctx.fill();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.fillStyle = "#96f";
                        ctx.strokeStyle = "#93c";
                        ctx.strokeText("Poltergeist",0,150);
                        ctx.fillText("Poltergeist",0,150);
                    }

                    ctx.lineWidth = game.defaultLineWidth;
                },
                chooseFunction() {
                    stats.poltergeist = true;
                },
            },
            {
                name: "Polite Lane-Change",
                desc: "Much less grip if steering without blinkers",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.rect(-10,-100,20,50);
                    ctx.rect(-10,50,20,50);
                    ctx.moveTo(-80,100);
                    ctx.lineTo(-80,40);
                    ctx.lineTo(60,-50);
                    ctx.lineTo(60,-100);
                    ctx.lineTo(80,-100);
                    ctx.lineTo(80,-40);
                    ctx.lineTo(-60,50);
                    ctx.lineTo(-60,100);
                    ctx.closePath();
                    ctx.fillStyle = "#222";
                    ctx.strokeStyle = "#333";
                    ctx.stroke();
                    ctx.fill();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.fillStyle = "#996";
                        ctx.strokeStyle = "#330";
                        ctx.strokeText("Polite",0,-150);
                        ctx.fillText("Polite",0,-150);
                        ctx.strokeText("Lane-Change",0,150);
                        ctx.fillText("Lane-Change",0,150);
                    }

                    ctx.lineWidth = game.defaultLineWidth;
                },
                chooseFunction() {
                    stats.pLaneChange = true;
                },
            },
            {
                name: "Peripheral Blinding",
                desc: "You can only see thing in the vicinity of your cursor",
                drawFunction(timer) {
                    ctx.beginPath();
                    ctx.moveTo(-140,0);
                    ctx.lineTo(-80,50);
                    ctx.lineTo(-20,65);
                    ctx.lineTo(0,70);
                    ctx.lineTo(20,65);
                    ctx.lineTo(80,50);
                    ctx.lineTo(140,0);
                    ctx.lineTo(80,-50);
                    ctx.lineTo(20,-65);
                    ctx.lineTo(0,-70);
                    ctx.lineTo(-20,-65);
                    ctx.lineTo(-80,-50);
                    ctx.closePath();
                    ctx.fillStyle = "#222";
                    ctx.strokeStyle = "#333";
                    ctx.stroke();
                    ctx.fill();

                    ctx.beginPath();
                    ctx.moveTo(50,0);
                    ctx.lineTo(35,35);
                    ctx.lineTo(0,50);
                    ctx.lineTo(-35,35);
                    ctx.lineTo(-50,0);
                    ctx.lineTo(-35,-35);
                    ctx.lineTo(0,-50);
                    ctx.lineTo(35,-35);
                    ctx.closePath();
                    ctx.moveTo(-32.5, -32.5);
                    ctx.lineTo(32.5, 32.5);
                    
                    ctx.strokeStyle = "#900";
                    ctx.lineWidth = game.defaultLineWidth*2;
                    ctx.stroke();
                    ctx.strokeStyle = "#c00";
                    ctx.lineWidth = game.defaultLineWidth;
                    ctx.stroke();

                    if (!timer) {
                        ctx.beginPath();
                        ctx.font = "50px Jura";
                        ctx.fillStyle = "#c00";
                        ctx.strokeStyle = "#700";
                        ctx.strokeText("Peripheral",0,-150);
                        ctx.fillText("Peripheral",0,-150);
                        ctx.strokeText("Blinding",0,150);
                        ctx.fillText("Blinding",0,150);
                    }

                    ctx.lineWidth = game.defaultLineWidth;
                },
                chooseFunction() {
                    stats.mouseBlind = true;
                },
            },
        ]

        const cars = [
            {
                name: "Cardboard Car",
                desc: "Simple and Reliable",
                drawFunctions: {
                    dash() {
                        //wipers
                        {
                            const wiperAngle = -Math.PI*11/10*car.wiper+Math.PI/20;

                            ctx.beginPath();
                            ctx.moveTo(0,300);
                            ctx.lineTo(Math.cos(wiperAngle)*800,300+Math.sin(wiperAngle)*800);
                            ctx.closePath();
                            ctx.strokeStyle = "#222";
                            ctx.stroke();
                        }
                        
                        //windshield gradient
                        {
                            ctx.beginPath();

                            ctx.fillStyle = windshieldGradient;

                            //ctx.fillStyle = "#9999ff22";
                            ctx.rect(-1800,-500,3600,1000);
                            ctx.fill();
                        }
                        
                        //dash
                        {
                            ctx.beginPath();
                            ctx.strokeStyle = "#222";
                            ctx.fillStyle = "#664e3a";
                            ctx.moveTo(-2000, 800);
                            ctx.lineTo(-700, 300);
                            ctx.lineTo(-300, 200);
                            ctx.lineTo(300, 200);
                            ctx.lineTo(700, 300);
                            ctx.lineTo(2000, 800);
                            ctx.lineTo(2000, 1000);
                            ctx.lineTo(-2000, 1000);
                            ctx.closePath();
                            ctx.stroke();
                            ctx.fill();

                            ctx.beginPath();
                            ctx.moveTo(-1000, -300);
                            ctx.lineTo(-700, -400);
                            ctx.lineTo(-200, -475);
                            ctx.lineTo(200, -475);
                            ctx.lineTo(700, -400);
                            ctx.lineTo(1000, -300);
                            ctx.lineTo(1000, -1000);
                            ctx.lineTo(-1000, -1000);
                            ctx.closePath();
                            ctx.stroke();
                            ctx.fill();
                        }

                        //upgrades
                        {
                            ctx.beginPath();
                            ctx.save();
                            ctx.translate(-500,-375);
                            ctx.scale(0.2,0.2);

                            chosenPunish.forEach( (thing) => {
                                ctx.beginPath();
                                ctx.rect(25,-500,-50,500);
                                ctx.moveTo(-140,0);
                                ctx.lineTo(-100,100);
                                ctx.lineTo(0,140);
                                ctx.lineTo(100,100);
                                ctx.lineTo(140,0);
                                ctx.lineTo(100,-100);
                                ctx.lineTo(0,-140);
                                ctx.lineTo(-100,-100);
                                ctx.closePath();

                                ctx.fillStyle = "#777";
                                ctx.strokeStyle = "#ccc";

                                ctx.stroke();
                                ctx.fill();

                                thing.drawFunction(true);

                                ctx.translate(-300,50);
                            })

                            ctx.restore();
                            ctx.save();
                            ctx.translate(500,-375);
                            ctx.scale(0.2,0.2)
                            
                            chosenPerk.forEach( (thing) => {
                                ctx.beginPath();
                                ctx.rect(25,-500,-50,500);
                                ctx.moveTo(-140,0);
                                ctx.lineTo(-100,100);
                                ctx.lineTo(0,140);
                                ctx.lineTo(100,100);
                                ctx.lineTo(140,0);
                                ctx.lineTo(100,-100);
                                ctx.lineTo(0,-140);
                                ctx.lineTo(-100,-100);
                                ctx.closePath();

                                ctx.fillStyle = "#777";
                                ctx.strokeStyle = "#ccc";

                                ctx.stroke();
                                ctx.fill();

                                thing.drawFunction(true);

                                ctx.translate(450,87.5);
                            })

                            ctx.restore();
                            //Trip Plan
                            {
                                ctx.save();
                                
                                ctx.translate(150,250);

                                ctx.rotate(Math.PI/20);

                                ctx.beginPath();
                                ctx.rect(-25,-75,400,150);

                                ctx.fillStyle = "#cc9";
                                ctx.strokeStyle = "#222";
                                ctx.stroke();
                                ctx.fill();

                                ctx.fillStyle = "#ffffff22";

                                ctx.lineWidth = 3;

                                ctx.beginPath();
                                
                                perkChoices.forEach( (choice, i) => {
                                    if (i >= perkChoicePos) {
                                        if ( i == perkChoicePos) {
                                            ctx.strokeStyle = "#555";
                                            ctx.fill();
                                            ctx.stroke();

                                            ctx.beginPath();
                                            ctx.moveTo(25,0);
                                            ctx.lineTo(19,19);
                                            ctx.lineTo(0,25);
                                            ctx.lineTo(-19,19);
                                            ctx.lineTo(-25,0);
                                            ctx.lineTo(-19,-19);
                                            ctx.lineTo(0,-25);
                                            ctx.lineTo(19,-19);
                                            ctx.closePath();

                                            ctx.strokeStyle = "#900";
                                            ctx.fill();
                                            ctx.stroke();

                                            ctx.beginPath();
                                        }

                                        ctx.moveTo(20,0);
                                        ctx.lineTo(15,15);
                                        ctx.lineTo(0,20);
                                        ctx.lineTo(-15,15);
                                        ctx.lineTo(-20,0);
                                        ctx.lineTo(-15,-15);
                                        ctx.lineTo(0,-20);
                                        ctx.lineTo(15,-15);
                                        ctx.closePath();

                                        switch(choice) {
                                            case "perk": {
                                                ctx.moveTo(-10, -3);
                                                ctx.lineTo(-3, -3);
                                                ctx.lineTo(-3, -10);
                                                ctx.lineTo(3, -10);
                                                ctx.lineTo(3, -3);
                                                ctx.lineTo(10, -3);
                                                ctx.lineTo(10, 3);
                                                ctx.lineTo(3, 3);
                                                ctx.lineTo(3, 10);
                                                ctx.lineTo(-3, 10);
                                                ctx.lineTo(-3, 3);
                                                ctx.lineTo(-10, 3);
                                                ctx.closePath();

                                                break;
                                            }
                                            case "punish": {
                                                ctx.moveTo(-10, -3);
                                                ctx.lineTo(10, -3);
                                                ctx.lineTo(10, 3);
                                                ctx.lineTo(-10, 3);
                                                ctx.closePath();

                                                break;
                                            }
                                            case "unstackPerk": {
                                                ctx.translate(-7,7);
                                                
                                                ctx.moveTo(-10, -3);
                                                ctx.lineTo(-3, -3);
                                                ctx.lineTo(-3, -10);
                                                ctx.lineTo(3, -10);
                                                ctx.lineTo(3, -3);
                                                ctx.lineTo(10, -3);
                                                ctx.lineTo(10, 3);
                                                ctx.lineTo(3, 3);
                                                ctx.lineTo(3, 10);
                                                ctx.lineTo(-3, 10);
                                                ctx.lineTo(-3, 3);
                                                ctx.lineTo(-10, 3);
                                                ctx.closePath();

                                                ctx.translate(14,-14);
                                                
                                                ctx.moveTo(-10, -3);
                                                ctx.lineTo(-3, -3);
                                                ctx.lineTo(-3, -10);
                                                ctx.lineTo(3, -10);
                                                ctx.lineTo(3, -3);
                                                ctx.lineTo(10, -3);
                                                ctx.lineTo(10, 3);
                                                ctx.lineTo(3, 3);
                                                ctx.lineTo(3, 10);
                                                ctx.lineTo(-3, 10);
                                                ctx.lineTo(-3, 3);
                                                ctx.lineTo(-10, 3);
                                                ctx.closePath();
                                                
                                                ctx.translate(-7,7);

                                                break;
                                            }
                                            case "unstackPunish": {
                                                ctx.translate(-7,7);

                                                ctx.moveTo(-10, -3);
                                                ctx.lineTo(10, -3);
                                                ctx.lineTo(10, 3);
                                                ctx.lineTo(-10, 3);
                                                ctx.closePath();

                                                ctx.translate(14,-14);
                                                
                                                ctx.moveTo(-10, -3);
                                                ctx.lineTo(10, -3);
                                                ctx.lineTo(10, 3);
                                                ctx.lineTo(-10, 3);
                                                ctx.closePath();
                                                
                                                ctx.translate(-7,7);

                                                break;
                                            }
                                            case "final": {
                                                ctx.strokeStyle = "#222";
                                                ctx.fill();
                                                ctx.stroke();

                                                ctx.beginPath();
                                                
                                                ctx.moveTo(0, -13);
                                                ctx.lineTo(8, 10);
                                                ctx.lineTo(-11, -5);
                                                ctx.lineTo(11, -5);
                                                ctx.lineTo(-8, 10);
                                                ctx.closePath();
                                                
                                                ctx.fillStyle = "#222";

                                                ctx.fill();
                                                ctx.stroke();

                                                break;
                                            }
                                            case "finish": {
                                                ctx.fill();
                                                ctx.stroke();

                                                ctx.beginPath();
                                                
                                                ctx.moveTo(0, -13);
                                                ctx.lineTo(8, 10);
                                                ctx.lineTo(-11, -5);
                                                ctx.lineTo(11, -5);
                                                ctx.lineTo(-8, 10);
                                                ctx.closePath();
                                                
                                                ctx.fillStyle = "#222";

                                                ctx.fill();
                                                ctx.stroke();

                                                break;
                                            }
                                        }
                                    } else if (chosenPerkDraw[i]) {
                                        ctx.save();

                                        ctx.scale(0.2,0.2);
                                        ctx.lineWidth = game.defaultLineWidth;
                                        chosenPerkDraw[i](true);
                                        ctx.beginPath();

                                        ctx.lineWidth = 3;

                                        ctx.restore();
                                    }

                                    ctx.translate(50,0);
                                    if (i == 7) ctx.translate(-400, 50);
                                })

                                ctx.strokeStyle = "#222";
                                ctx.fill();
                                ctx.stroke();

                                ctx.fillStyle = "#222";
                                ctx.font = "40px Jura";
                                ctx.fillText("Trip Plan: " + currentRegion.toUpperCase(),-225, -100);

                                ctx.restore();
                            }
        
                        }
                    },
                    wheel(x,y) {
                        ctx.save();
                        ctx.translate(x,y);
                        ctx.rotate(-car.wheel*Math.PI*5/2);

                        ctx.strokeStyle = "#333";
                        if (mouse.selected == "wheel") ctx.strokeStyle = "#fff";
                        else if (mouse.hover == "wheel") ctx.strokeStyle = "#888";
                        ctx.fillStyle = "#ad7d53";
                        ctx.beginPath();
                        ctx.arc(0,0,200,0,Math.PI*2);
                        ctx.moveTo(-180,0);
                        ctx.arc(0,0,180,0,Math.PI*2, true);
                        ctx.rect(-190,-10,380,20);
                        ctx.rect(-10,0,20,190);
                        ctx.stroke();
                        ctx.fill();
                        
                        ctx.strokeStyle = "#333";
                        if (mouse.selected == "horn") ctx.strokeStyle = "#fff";
                        else if (mouse.hover == "horn") ctx.strokeStyle = "#888";
                        ctx.beginPath();
                        ctx.moveTo(-50,-20);
                        ctx.lineTo(-30,-40);
                        ctx.lineTo(30,-40);
                        ctx.lineTo(50,-20);
                        ctx.lineTo(50,30);
                        ctx.lineTo(30,50);
                        ctx.lineTo(-30,50);
                        ctx.lineTo(-50,30);
                        ctx.closePath();
                        ctx.stroke();
                        ctx.fill();

                        ctx.restore();

                        //drawLine
                        if (mouse.selected == "wheel") {
                            ctx.strokeStyle = "#ffffff66";
                            ctx.beginPath();
                            ctx.moveTo(mouse.x, mouse.y);
                            ctx.lineTo(x + Math.cos(-car.wheel*Math.PI*5/2-Math.PI/2+mouse.wheelOffset)*190, y + Math.sin(-car.wheel*Math.PI*5/2-Math.PI/2+mouse.wheelOffset)*190);
                            ctx.stroke();
                        }
                    },
                    speedometer(x,y) {
                        //spedometer
                        {
                            ctx.save();
                            
                            ctx.translate(x,y);

                            ctx.beginPath();
                            ctx.moveTo(-25,35);
                            ctx.lineTo(-45,25);
                            ctx.lineTo(-50,0);
                            ctx.lineTo(-45,-25);
                            ctx.lineTo(-25,-45);
                            ctx.lineTo(0,-50);
                            ctx.lineTo(25,-45);
                            ctx.lineTo(45,-25);
                            ctx.lineTo(50,0);
                            ctx.lineTo(45,25);
                            ctx.lineTo(25,35);

                            ctx.lineTo(10,25);
                            ctx.lineTo(-10,25);
                            ctx.closePath();
                            
                            ctx.strokeStyle = "#222";
                            ctx.fillStyle = "#444";
                            ctx.fill();
                            ctx.stroke();

                            ctx.strokeStyle = "#a00";

                            ctx.beginPath();
                            

                            ctx.rotate(-Math.PI*4.75/4);

                            //ctx.rect(25, -3, 15, 3);
                            
                            ctx.fillStyle = "#900";

                            ctx.fill();

                            ctx.beginPath();

                            for (var i = 0; i < 9; i++) {
                                ctx.rect(30, -3, 10, 3);

                                if (i-8) ctx.rotate(Math.PI*5.50/32);
                            }
                            
                            ctx.fillStyle = "#666";

                            ctx.fill();

                            ctx.beginPath();

                            ctx.rotate(-Math.PI*5.5/4 + Math.min(105,Math.abs(car.speed))/100*Math.PI*5.5/4);

                            ctx.rect(5, -3, 30, 3);
                            
                            ctx.fillStyle = "#a00";

                            ctx.fill();

                            ctx.beginPath();
                            ctx.moveTo(0,0);

                            ctx.stroke();

                            ctx.restore();
                        }

                    },
                    gasMeter(x,y) {
                        ctx.save();
                        ctx.translate(x,y);

                        ctx.beginPath();
                        ctx.moveTo(-50,0);
                        ctx.lineTo(-45,-25);
                        ctx.lineTo(-25,-45);
                        ctx.lineTo(0,-50);
                        ctx.lineTo(25,-45);
                        ctx.lineTo(45,-25);
                        ctx.lineTo(50,0);
                        ctx.lineTo(45,25);
                        ctx.lineTo(25,45);
                        ctx.lineTo(0,50);
                        ctx.lineTo(-25,45);
                        ctx.lineTo(-45,25);
                        ctx.closePath();
                        
                        ctx.strokeStyle = "#222";
                        ctx.fillStyle = "#444";
                        ctx.fill();
                        ctx.stroke();

                        ctx.beginPath();

                        ctx.rect(0,-15,20,30);
                        ctx.rect(-2,15,24,5);
                        ctx.rect(16,-10,-12,10);
                        ctx.rect(20,-10,5,5);
                        ctx.rect(23,-10,5,20);

                        ctx.fillStyle = "#000";

                        ctx.fill();

                        ctx.beginPath();

                        ctx.rotate(-Math.PI/3);

                        ctx.rect(-40, -3, 15, 3);
                        
                        ctx.fillStyle = "#900";

                        ctx.fill();

                        ctx.beginPath();

                        for (var i = 0; i < 4; i++) {
                            ctx.rotate(Math.PI/6);

                            ctx.rect(-40, -3, 10, 3);
                        }
                        
                        ctx.fillStyle = "#666";

                        ctx.fill();

                        ctx.beginPath();

                        ctx.rotate(-Math.PI/1.5 * game.timer/stats.timerMax);

                        ctx.rect(-35, -3, 15, 3);
                        
                        ctx.fillStyle = "#999";

                        ctx.fill();

                        ctx.restore();
                    },
                    ignition(x,y) {
                        ctx.save();
                        
                        ctx.translate(x,y);

                        ctx.beginPath();
                        ctx.moveTo(-25,0);
                        ctx.lineTo(-18,-18);
                        ctx.lineTo(0,-25);
                        ctx.lineTo(18,-18);
                        ctx.lineTo(25,0);
                        ctx.lineTo(18,18);
                        ctx.lineTo(0,25);
                        ctx.lineTo(-18,18);
                        ctx.closePath();
                        //ctx.arc(0,0,25,0,Math.PI*2);
                        
                        if (car.running) ctx.fillStyle = "#292";
                        else ctx.fillStyle = "#922";
                        ctx.fill();
                        ctx.strokeStyle = "#222";
                        if (mouse.selected == "ignition") ctx.strokeStyle = "#666";
                        else if (mouse.hover == "ignition") ctx.strokeStyle = "#444";
                        ctx.stroke();

                        ctx.beginPath();

                        ctx.moveTo(-10*(1-2*car.running),-10);
                        ctx.lineTo(10*(1-2*car.running),10);

                        ctx.strokeStyle = "#666";
                        if (mouse.selected == "ignition") ctx.strokeStyle = "#ccc";
                        else if (mouse.hover == "ignition") ctx.strokeStyle = "#999";
                        ctx.stroke();

                        ctx.restore();
                    },
                    hazard(x,y) {
                        ctx.save();
                        
                        ctx.translate(x,y);

                        ctx.beginPath();
                        ctx.moveTo(-25,0);
                        ctx.lineTo(-18,-18);
                        ctx.lineTo(0,-25);
                        ctx.lineTo(18,-18);
                        ctx.lineTo(25,0);
                        ctx.lineTo(18,18);
                        ctx.lineTo(0,25);
                        ctx.lineTo(-18,18);
                        ctx.closePath();
                        
                        ctx.fillStyle = "#111";
                        if (car.hazard && game.timer%40 > 20) ctx.fillStyle = "#600";
                        ctx.fill();
                        ctx.strokeStyle = "#222";
                        if (mouse.selected == "hazard") ctx.strokeStyle = "#666";
                        else if (mouse.hover == "hazard") ctx.strokeStyle = "#444";
                        ctx.stroke();

                        ctx.beginPath();
                        ctx.moveTo(0,-12.5);
                        ctx.lineTo(10,7.5);
                        ctx.lineTo(-10,7.5);
                        ctx.closePath();
                        ctx.strokeStyle = "#c00";
                        ctx.lineWidth = game.defaultLineWidth/1.5;
                        ctx.stroke();

                        ctx.lineWidth = game.defaultLineWidth;

                        ctx.restore();
                    },
                    blinker(x,y) {
                        ctx.save();
                        ctx.translate(x,y);
                        ctx.beginPath();
                        ctx.moveTo(60,0);
                        ctx.lineTo(10,25);
                        ctx.lineTo(10,-25);
                        ctx.closePath();
                        ctx.strokeStyle = "#333";
                        if (mouse.selected == "blinkerR") ctx.strokeStyle = "#fff";
                        else if (mouse.hover == "blinkerR") ctx.strokeStyle = "#888";
                        ctx.stroke();
                        ctx.fillStyle = "#222";
                        if (car.blinker == "r" && game.timer%40 > 20) ctx.fillStyle = "#990";
                        ctx.fill();
                        ctx.beginPath();
                        ctx.moveTo(-60,0);
                        ctx.lineTo(-10,25);
                        ctx.lineTo(-10,-25);
                        ctx.closePath();
                        ctx.strokeStyle = "#333";
                        if (mouse.selected == "blinkerL") ctx.strokeStyle = "#fff";
                        else if (mouse.hover == "blinkerL") ctx.strokeStyle = "#888";
                        ctx.stroke();
                        ctx.fillStyle = "#222";
                        if (car.blinker == "l" && game.timer%40 > 20) ctx.fillStyle = "#990";
                        ctx.fill();
                        ctx.restore();
                    },
                    radio(x,y) {
                        ctx.save();
                        ctx.translate(x,y);
                        
                        ctx.beginPath();
                        ctx.rect(-25,-20,325,40);
                        ctx.fillStyle = "#222";
                        ctx.strokeStyle = "#666";
                        ctx.stroke();
                        ctx.fill();

                        ctx.beginPath();
                        ctx.fillStyle = "#ccc";
                        ctx.font = "20px Jura";
                        ctx.fillText(songAuthor, 150, 0);

                        ctx.rotate((game.audioVolume-0.5)*Math.PI*3/2);

                        ctx.moveTo(-11,0);
                        ctx.lineTo(-8,-8);
                        ctx.lineTo(0,-11);
                        ctx.lineTo(8,-8);
                        ctx.lineTo(11, 0);
                        ctx.lineTo(8,8);
                        ctx.lineTo(0,11);
                        ctx.lineTo(-8,8);
                        ctx.closePath();

                        ctx.fillStyle = "#111";
                        ctx.strokeStyle = "#777";
                        if (mouse.selected == "radio") ctx.strokeStyle = "#aaa";
                        else if (mouse.hover == "radio") ctx.strokeStyle = "#888";

                        ctx.stroke();
                        ctx.fill();

                        ctx.beginPath();

                        ctx.moveTo(0,-5);
                        ctx.lineTo(0,-11);

                        ctx.strokeStyle = "#ccc";

                        ctx.lineWidth = game.defaultLineWidth/1.5;
                        ctx.stroke();
                        ctx.lineWidth = game.defaultLineWidth;

                        if (mouse.selected == "radio") {
                            const desiredOutput = (mouse.x-200 + mouse.wheelOffset)/500 + 0.5;

                            game.audioVolume = Math.min(1,Math.max(0, desiredOutput ));
                        }

                        ctx.restore();
                    },
                    windWipers(x,y) {
                        ctx.beginPath();
                        ctx.rect(x-150,y-15,300,30);
                        ctx.fillStyle = "#444";
                        ctx.fill();
                        ctx.strokeStyle = "#222";
                        ctx.stroke();
                        ctx.beginPath();
                        //-485 & -735
                        ctx.rect(-435 - 250 * (car.wiper), 390, 20, 50);
                        ctx.fillStyle = "#444";
                        ctx.fill();
                        ctx.strokeStyle = "#222";
                        if (mouse.selected == "wiper") ctx.strokeStyle = "#999";
                        else if (mouse.hover == "wiper") ctx.strokeStyle = "#666";
                        ctx.stroke();

                        //drawLine
                        if (mouse.selected == "wiper") {
                            ctx.strokeStyle = "#ffffff66";
                            ctx.beginPath();
                            ctx.moveTo(mouse.x, mouse.y);
                            ctx.lineTo(-425 - 250 * (car.wiper), 415);
                            ctx.stroke();
                        }
                    },
                },
                positions: {
                    wheel: [-200, 250],
                    speedometer: [-290,325],
                    gasMeter: [-110,325],
                    ignition: [50,350],
                    hazard: [60,270],
                    blinker: [-500,325],
                    radio: [200,420],
                    windWipers: [-550,415],
                },
                startupFunction() {

                },
                misc: {
                    randomDashPos() { return [ -800+Math.random()*1600, 200+Math.random()*300 ] }
                }
            }
        ]

        currentCar = cars[0];

        let choices = [];

        let perkChoices = [ "punish", "perk", "unstackPunish", "perk", "punish", "unstackPerk", "punish", "perk", "unstackPunish", "perk", "punish", "unstackPerk", "punish", "perk", "unstackPunish", "final" ];

        let chosenPerkDraw = [];

        const chosenPerk = [];
        const chosenPunish = [];

        let perkChoicePos = 0;

        const regions = [ "abyss", "city", "highway", "canyon" ];

        regions.sort( () => { if (Math.random() < 0.5) return 1; else return -1; } );

        regions[2] = "red carpet";

        let currentRegion = "rural";

        let stats = {
            roadLength: 80000,
            roadSize: 200,
            roadAngle: Math.PI/20,
            acceleration: 0.05,
            topSpeed: 30,
            turnSpeed: Math.PI/20,
            offroadSpeedLoss: 0.2,
            offroadMaxSpeed: 8,
            requiredDriftAngle: Math.PI/25,
            driftGrip: 0.07,
            inertia: 1,
            roadHazardChance: 1,
            timerMax: 4300,
        }

        const game = {
            menu: "main", previousMenu: "main", transitionTicks: 0,
            gravity: 0, fps: 60, zoom: 50, xOffset: 0, yOffset: 0, xVOffset: 0, yVOffset: 0, audioVolume: 0.75,
            renderType: "2d", defaultLineWidth: 10, timer: 0, rgbTimer: 0, timerCounting: false, status: "driving",

            masterVolume: 0.75, sfxVolume: 1, musicVolume: 1,
        };

        if (localStorage.getItem("SlSsGameSettings")) {
            const settings = JSON.parse(localStorage.getItem("SlSsGameSettings"));

            if (settings.master) game.masterVolume = settings.master;
            if (settings.music) game.musicVolue = settings.music;
            if (settings.sfx) game.sfxVolue = settings.sfx;
        }

        generateChoices();

        const car = {
            x: 0,
            y: 0,
            speed: 0,
            speedAngle: Math.PI/2,
            angle: Math.PI/2,
            wheel: 0,
            running: false,
            wiper: 0,
            blinker: false,
            hazard: false,
            booster: 0,
            brakeBoost: 0,
            jumpPos: 0,
        }
        
        let windshield = [];

        let buildings = [];

        let buildingPoints = [];

        let road = [];

        let roadDrawPoints = [];

        let perspectivePoints = [];

        let perspectiveBuildingPoints = [];
            
        const horizon = -200;

        const clouds = [];
        for(var i = 0; i < Math.PI*2; i += Math.PI/100*(1+0.5*Math.random())) clouds.push( {angle: i, size: 100+50*Math.random(), y: -400-75*Math.random()} );

        let linearGradient;

        const linearGradientBG = ctx.createLinearGradient(-1800, 0, 1800, 0);

        linearGradientBG.addColorStop(0, "#000000");
        linearGradientBG.addColorStop(0.24, "#000000");
        linearGradientBG.addColorStop(0.25, "#00000000");
        linearGradientBG.addColorStop(0.75, "#00000000");
        linearGradientBG.addColorStop(0.76, "#000000");
        linearGradientBG.addColorStop(1, "#000000");

        const linearGradientBG1 = ctx.createLinearGradient(0, -1000, 0, 1000);

        linearGradientBG1.addColorStop(0, "#000000");
        linearGradientBG1.addColorStop(0.24, "#000000");
        linearGradientBG1.addColorStop(0.25, "#00000000");
        linearGradientBG1.addColorStop(0.75, "#00000000");
        linearGradientBG1.addColorStop(0.76, "#000000");
        linearGradientBG1.addColorStop(1, "#000000");

        const fogGradient = ctx.createLinearGradient(0, -1200, 0, 800);

        fogGradient.addColorStop(0, "#77777750");
        fogGradient.addColorStop(0.5, "#777777ff");
        fogGradient.addColorStop(0.51, "#777777f5");
        fogGradient.addColorStop(0.52, "#777777f0");
        fogGradient.addColorStop(0.55, "#777777c0");
        fogGradient.addColorStop(0.65, "#77777760");
        fogGradient.addColorStop(1, "#77777722");

        const timerGradient = ctx.createRadialGradient(250, 300, 10, 250, 300, 60);

        timerGradient.addColorStop(0, "#00000000");
        timerGradient.addColorStop(1, "#000");

        const windshieldGradient = ctx.createLinearGradient(0, -300, 0, 500);

        windshieldGradient.addColorStop(0, "#55999955");
        windshieldGradient.addColorStop(1, "#00779955");

        const skyboxGradient = ctx.createLinearGradient(0, -500+horizon, 0, 500+horizon);

        skyboxGradient.addColorStop(0.497, "#0099ff");
        skyboxGradient.addColorStop(0.503, "#003300");

        const skyboxGradientCanyon = ctx.createLinearGradient(0, -500+horizon, 0, 500+horizon);

        skyboxGradientCanyon.addColorStop(0.497, "#d98341");
        skyboxGradientCanyon.addColorStop(0.503, "#404405");

        const skyboxGradientHighway = ctx.createLinearGradient(0, -500+horizon, 0, 500+horizon);

        skyboxGradientHighway.addColorStop(0.497, "#001133");
        skyboxGradientHighway.addColorStop(0.503, "#111");


        const menuGradient = ctx.createLinearGradient(0, -1000, 0, 1000);

        menuGradient.addColorStop(0.45, "#140");
        menuGradient.addColorStop(0.55, "#410");
        
        const peripheralBlindGradient = ctx.createRadialGradient(0, 0, 300, 0, 0, 500);

        peripheralBlindGradient.addColorStop(0, "#00000000");
        peripheralBlindGradient.addColorStop(1, "#000");
        function tickloop() {
            if (stats.heavyHand) {
                let moveX = mouse.actualX-mouse.x;
                let moveY = mouse.actualY-mouse.y;

                const speed = Math.hypot(moveX, moveY);
                if (stats.heavyHand && speed > 17) {
                    moveX *= 17/speed;
                    moveY *= 17/speed;
                }

                
                mouse.x += moveX;
                mouse.y += moveY;

            } else {
                mouse.x = mouse.actualX;
                mouse.y = mouse.actualY;
            }

            mouse.x = Math.min(Math.max(-1000,mouse.x),1000);
            mouse.y = Math.min(Math.max(-500,mouse.y),500);

            //sortBuildings
            if (game.timer%10 == 0) buildingPoints.sort( (a,b) => {
                if (Math.hypot(a[4].x-car.x,a[4].y-car.y) < Math.hypot(b[4].x-car.x,b[4].y-car.y)) return 1; 
                else return -1; 
            } );

            if (Math.random() < 0.003 && stats.sweaty) mouse.selected = false;
            if (Math.random() < 0.002 && stats.engineFailure) {
                engineRev.pause();
                car.running = false;
            }
            if (Math.random() < 0.015 && stats.bug && game.timerCounting && game.status == "driving") windshield.push( { type: "bug", x: -600+1200*Math.random(), y: -300+500*Math.random(), durability: 2, maxDurability: 2 } );
            if (Math.random() < 0.15 && stats.sleepy && game.timerCounting && game.status == "driving") stats.eyeVel++;
            if (mouse.selected == "horn" && stats.eyeVel > -20 && stats.eyePos < 200) stats.eyeVel -= 2;

            ctx.save();

            //check frameRate
            var thisFrameTime = (thisLoop=new Date) - lastLoop;
            frameTime += (thisFrameTime - frameTime) / filterStrength;
            lastLoop = thisLoop;

            ctx.beginPath();
            ctx.fillStyle = "#000000";
            ctx.rect(-1000,-1000,3500,3600);
            ctx.fill();

            if (game.menu) {
                drawMenu();

                ctx.beginPath();
                ctx.rect(-3600,-3000,6000,6000);

                ctx.fillStyle = linearGradientBG;

                ctx.fill();

                ctx.fillStyle = linearGradientBG1;

                ctx.fill();

                return;
            }

            ctx.save();
            ctx.translate(0,( car.jumpPos/4 ));
            
            drawSkybox();

            drawRoadPerspective();

            ctx.restore();

            drawDash();

            if (perkChoices[perkChoicePos] == "finish" && game.status == "choosing") {
                ctx.beginPath();
                ctx.fillStyle = "#ff3";
                ctx.strokeStyle = "#993";
                ctx.font = "200px Jura";
                ctx.strokeText("You Win", 0, 0);
                ctx.fillText("You Win", 0, 0);
            } else if (game.timer > stats.timerMax+100 && Math.abs(car.speed) < 0.2) {
                ctx.beginPath();
                ctx.fillStyle = "#f33";
                ctx.strokeStyle = "#933";
                ctx.font = "200px Jura";
                ctx.strokeText("Game Over", 0, 0);
                ctx.fillText("Game Over", 0, 0);
            } else if (game.status == "choosing") {
                drawChoices();
            }
            else {
                checkCollision();
                
                drive();

                if (game.timerCounting && game.timer < stats.timerMax+150) game.timer++;
            }

            drawMouse();

            ctx.beginPath();
            ctx.rect(-3600,-3000,6000,6000);

            ctx.fillStyle = linearGradientBG;

            ctx.fill();

            ctx.fillStyle = linearGradientBG1;

            ctx.fill();

            if (stats.sleepy && game.status == "driving") {
                ctx.fillStyle = "#000";
                ctx.beginPath();
                ctx.moveTo(1000,-1000);
                ctx.lineTo(-1000,-1000);
                ctx.lineTo(-1000,-stats.eyePos+300);
                ctx.lineTo(-850,-stats.eyePos+200);
                ctx.lineTo(-400,-stats.eyePos+50);
                ctx.lineTo(-100,-stats.eyePos+5);
                ctx.lineTo(0,-stats.eyePos);
                ctx.lineTo(100,-stats.eyePos+5);
                ctx.lineTo(400,-stats.eyePos+50);
                ctx.lineTo(850,-stats.eyePos+200);
                ctx.lineTo(1000,-stats.eyePos+300);
                ctx.closePath();
                ctx.fill();
                
                ctx.moveTo(1000,1000);
                ctx.lineTo(-1000,1000);
                ctx.lineTo(-1000,stats.eyePos-300);
                ctx.lineTo(-850,stats.eyePos-200);
                ctx.lineTo(-400,stats.eyePos-50);
                ctx.lineTo(-100,stats.eyePos-5);
                ctx.lineTo(0,stats.eyePos);
                ctx.lineTo(100,stats.eyePos-5);
                ctx.lineTo(400,stats.eyePos-50);
                ctx.lineTo(850,stats.eyePos-200);
                ctx.lineTo(1000,stats.eyePos-300);
                ctx.closePath();
                ctx.fill();

                stats.eyePos -= stats.eyeVel;
                if (stats.eyePos < -1000) {
                    stats.eyeVel = -100;
                } else if (stats.eyePos > 1000) stats.eyePos = 1000;
            }

            ctx.restore();
        }

        function drawMouse() {
            if (stats.heavyHand) {
                ctx.beginPath();
                ctx.fillStyle = "#777";
                ctx.strokeStyle = "#ccc";
                
                //inner circle
                ctx.moveTo(mouse.actualX-8,mouse.actualY);
                ctx.lineTo(mouse.actualX-6,mouse.actualY-6);
                ctx.lineTo(mouse.actualX,mouse.actualY-8);
                ctx.lineTo(mouse.actualX+6,mouse.actualY-6);
                ctx.lineTo(mouse.actualX+8,mouse.actualY);
                ctx.lineTo(mouse.actualX+6,mouse.actualY+6);
                ctx.lineTo(mouse.actualX,mouse.actualY+8);
                ctx.lineTo(mouse.actualX-6,mouse.actualY+6);
                ctx.closePath();
                //ctx.stroke();
                ctx.fill();
            }

            ctx.beginPath();
            ctx.fillStyle = "#777";
            ctx.strokeStyle = "#ccc";
            
            //inner circle
            ctx.moveTo(mouse.x-8,mouse.y);
            ctx.lineTo(mouse.x-6,mouse.y-6);
            ctx.lineTo(mouse.x,mouse.y-8);
            ctx.lineTo(mouse.x+6,mouse.y-6);
            ctx.lineTo(mouse.x+8,mouse.y);
            ctx.lineTo(mouse.x+6,mouse.y+6);
            ctx.lineTo(mouse.x,mouse.y+8);
            ctx.lineTo(mouse.x-6,mouse.y+6);
            ctx.closePath();
            ctx.stroke();
            ctx.fill();

            if (stats.mouseBlind && !game.menu) {
                ctx.save();

                ctx.translate(mouse.x, mouse.y);

                ctx.beginPath();

                ctx.fillStyle = peripheralBlindGradient;
                
                ctx.fillRect(-3000,-2000,6000,4000);

                ctx.restore();
            }
        }

        function calculateRoadPoints() {
            //calculates the 2d positions
            roadDrawPoints = [];

            road.forEach((road) => {
                const size = Math.hypot( road.size, road.size );// * (1 - 2*(road.pothole == true));

                const points = [];
                points.push( { x: road.x - size*Math.sin(road.angle + Math.PI/4), y: road.y + size*Math.cos(road.angle + Math.PI/4), road: road.road, override: road.final || road.finalPothole || road.finalOilslick || road.finalBooster || road.finalMud || road.finalBIce, final: road.final, finalPothole: road.finalPothole, finalBIce: road.finalBIce, finalOilslick: road.finalOilslick, finalMud: road.finalMud, finalBooster: road.finalBooster } );
                points.push( { x: road.x - size*Math.sin(road.angle + Math.PI/2 + Math.PI/4), y: road.y + size*Math.cos(road.angle + Math.PI/2 + Math.PI/4) } );
                points.push( { x: road.x - size*Math.sin(road.angle + Math.PI + Math.PI/4), y: road.y + size*Math.cos(road.angle + Math.PI + Math.PI/4) } );
                points.push( { x: road.x - size*Math.sin(road.angle + Math.PI*3/2 + Math.PI/4), y: road.y + size*Math.cos(road.angle + Math.PI*3/2 + Math.PI/4) } );

                roadDrawPoints.push(points);
            });
            if (currentRegion != "abyss" && currentRegion != "red carpet") road.forEach((roadItem, i) => {
                if (!road[i+1] || !road[i+3] || !roadItem.road || i%2 == 0) return;
                if (road[i].final ||  road[i+1].final) return;

                const diff = { x: road[i+1].x - roadItem.x, y: road[i+1].y - roadItem.y }

                const points = [];
                points.push( { x: roadItem.x, y: roadItem.y, stripe: true } );
                points.push( { x: roadItem.x + diff.x, y: roadItem.y + diff.y, stripe: true } );
                
                roadDrawPoints.push(points);
            });

            buildings.forEach((road) => {
                const size = Math.hypot( road.size, road.size );// * (1 - 2*(road.pothole == true));

                const point1 = { x: road.x - size*Math.sin(road.angle + Math.PI/4), y: road.y + size*Math.cos(road.angle + Math.PI/4) };
                const point1T = { x: road.x - size*Math.sin(road.angle + Math.PI/4), y: road.y + size*Math.cos(road.angle + Math.PI/4), top: true, color: road.color, size: road.height };
                const point2 = { x: road.x - size*Math.sin(road.angle + Math.PI/2 + Math.PI/4), y: road.y + size*Math.cos(road.angle + Math.PI/2 + Math.PI/4) };
                const point2T = { x: road.x - size*Math.sin(road.angle + Math.PI/2 + Math.PI/4), y: road.y + size*Math.cos(road.angle + Math.PI/2 + Math.PI/4), top: true, color: road.color, size: road.height };
                const point3 = { x: road.x - size*Math.sin(road.angle + Math.PI + Math.PI/4), y: road.y + size*Math.cos(road.angle + Math.PI + Math.PI/4) };
                const point3T = { x: road.x - size*Math.sin(road.angle + Math.PI + Math.PI/4), y: road.y + size*Math.cos(road.angle + Math.PI + Math.PI/4) , top: true, color: road.color, size: road.height };
                const point4 = { x: road.x - size*Math.sin(road.angle + Math.PI*3/2 + Math.PI/4), y: road.y + size*Math.cos(road.angle + Math.PI*3/2 + Math.PI/4) };
                const point4T = { x: road.x - size*Math.sin(road.angle + Math.PI*3/2 + Math.PI/4), y: road.y + size*Math.cos(road.angle + Math.PI*3/2 + Math.PI/4), top: true, color: road.color, size: road.height };

                buildingPoints.push( [point1T, point1, point2, point2T] );
                buildingPoints.push( [point2T, point2, point3, point3T] );
                buildingPoints.push( [point3T, point3, point4, point4T] );
                buildingPoints.push( [point4T, point4, point1, point1T] );
            });

            buildingPoints.forEach( (item) => {
                item.push( {x: item[1].x/2 + item[2].x/2, y: item[1].y/2 + item[2].y/2} );
            });
        }

        function drawSkybox() {
            ctx.beginPath();

            if (currentRegion == "highway") ctx.fillStyle = skyboxGradientHighway
            else if (currentRegion == "canyon") ctx.fillStyle = skyboxGradientCanyon
            else ctx.fillStyle = skyboxGradient;

            if (currentRegion == "abyss" || currentRegion == "red carpet") ctx.fillStyle = "#000";

            ctx.rect(-1000,-1000,2000,2000);
            ctx.fill();

            // draw clouds
            if (currentRegion == "abyss") {
                ctx.beginPath();
                ctx.fillStyle = "#102";
                ctx.strokeStyle = "#203";
                let angleDiff;
                clouds.forEach((cloud) => {
                    angleDiff = car.angle-cloud.angle;

                    while (Math.abs(angleDiff-Math.PI*2) < Math.abs(angleDiff)) {
                        cloud.angle += Math.PI*2;
                        angleDiff = car.angle-cloud.angle;
                    }
                    while (Math.abs(angleDiff+Math.PI*2) < Math.abs(angleDiff)) {
                        cloud.angle -= Math.PI*2;
                        angleDiff = car.angle-cloud.angle;
                    }

                    if (Math.abs(angleDiff*2000) > 1000) return;

                    ctx.moveTo(-angleDiff*2000+cloud.size, -2000);
                    ctx.lineTo(-angleDiff*2000+cloud.size, cloud.y/2+horizon);
                    ctx.lineTo(-angleDiff*2000, cloud.y/2+cloud.size+horizon);
                    ctx.lineTo(-angleDiff*2000-cloud.size, cloud.y/2+horizon);
                    ctx.moveTo(-angleDiff*2000-cloud.size, -2000);

                    ctx.moveTo(-angleDiff*2000+cloud.size, 2000);
                    ctx.lineTo(-angleDiff*2000+cloud.size, -cloud.y/2+horizon);
                    ctx.lineTo(-angleDiff*2000, -cloud.y/2-cloud.size+horizon);
                    ctx.lineTo(-angleDiff*2000-cloud.size, -cloud.y/2+horizon);
                    ctx.lineTo(-angleDiff*2000+cloud.size, 2000);
                })
            } 
            else if (currentRegion == "red carpet") {
                ctx.beginPath();
                let angleDiff;
                let reverse;
                clouds.forEach((cloud, i) => {
                    angleDiff = car.angle-cloud.angle;

                    while (Math.abs(angleDiff-Math.PI*2) < Math.abs(angleDiff)) {
                        cloud.angle += Math.PI*2;
                        angleDiff = car.angle-cloud.angle;
                    }
                    while (Math.abs(angleDiff+Math.PI*2) < Math.abs(angleDiff)) {
                        cloud.angle -= Math.PI*2;
                        angleDiff = car.angle-cloud.angle;
                    }
                    if (Math.abs(angleDiff*2000) > 1000) return;

                    if (Math.abs(angleDiff) < Math.PI/2) {
                        if (Math.sign(angleDiff) != reverse && Math.abs(angleDiff) > Math.PI/5) {
                            ctx.moveTo(-angleDiff*2000, cloud.y/2+cloud.size+horizon);
                            reverse = Math.sign(angleDiff);
                        }
                        else ctx.lineTo(-angleDiff*2000, cloud.y/2+cloud.size+horizon);
                    }
                })
                ctx.strokeStyle = "#600";
                ctx.lineWidth = game.defaultLineWidth*4;
                ctx.stroke();
                ctx.strokeStyle = "#900";
                ctx.lineWidth = game.defaultLineWidth*2;
                ctx.stroke();
                ctx.strokeStyle = "#c00";
                ctx.lineWidth = game.defaultLineWidth;
                ctx.stroke();

                return;
            } 
            else {
                ctx.beginPath();
                if (currentRegion == "highway") ctx.fillStyle = "#444";
                else if (currentRegion == "canyon") ctx.fillStyle = "#a97";
                else ctx.fillStyle = "#999";
                ctx.strokeStyle = "#ccc";
                ctx.rect(-1000,-1000,2000,600);
                let angleDiff;
                clouds.forEach((cloud) => {
                    angleDiff = car.angle-cloud.angle;

                    while (Math.abs(angleDiff-Math.PI*2) < Math.abs(angleDiff)) {
                        cloud.angle += Math.PI*2;
                        angleDiff = car.angle-cloud.angle;
                    }
                    while (Math.abs(angleDiff+Math.PI*2) < Math.abs(angleDiff)) {
                        cloud.angle -= Math.PI*2;
                        angleDiff = car.angle-cloud.angle;
                    }
                    if (Math.abs(angleDiff*2000) > 1000) return;

                    ctx.moveTo(-angleDiff*2000+cloud.size, cloud.y);
                    ctx.lineTo(-angleDiff*2000+cloud.size*0.5, cloud.y+cloud.size*0.9);
                    ctx.lineTo(-angleDiff*2000, cloud.y+cloud.size);
                    ctx.lineTo(-angleDiff*2000-cloud.size*0.5, cloud.y+cloud.size*0.9);
                    ctx.lineTo(-angleDiff*2000-cloud.size, cloud.y);
                })
            }

            ctx.stroke();
            ctx.fill();
        }

        async function calculateRoadPerspectivePoints() {
            perspectivePoints = [];
            perspectiveBuildingPoints = [];

            const angle = car.angle-Math.PI/2;

            roadDrawPoints.forEach((points, pI) => {
                let pointSet = [];
                
                if (Math.hypot(points[0].x-car.x, points[0].y-car.y) < 15000 || points[0].override || (points[0].road && pI%20 == 0)) points.forEach((point, i) => {

                    originalY = ((point.y-car.y) * Math.cos(angle) - (point.x-car.x) * Math.sin(angle))+400;
                    x = (point.x-car.x) * Math.cos(angle) + (point.y-car.y) * Math.sin(angle);

                    y = -calculateHorizonY(-originalY, -horizon);
                    x = ( ( y-horizon ) / 50 ) * x;

                    if (!points[0].final && Math.hypot(points[0].x-car.x, points[0].y-car.y) > 15000 && points[0].road && pI%20 == 0) {
                        if (i) return;
                    }

                    if (i == 0) pointSet.push([x,y,{ final: point.final, finalPothole: point.finalPothole, finalOilslick: point.finalOilslick, finalMud: point.finalMud, finalBooster: point.finalBooster, finalBIce: point.finalBIce, stripe: point.stripe,  }])
                    else pointSet.push([x,y]);
                })

                if (pointSet.length) perspectivePoints.push(pointSet);
            });

            buildingPoints.forEach((points, pI) => {
                let pointSet = [];
                
                let contin = 3;

                points.forEach((point, i) => {
                    originalY = ((point.y-car.y) * Math.cos(angle) - (point.x-car.x) * Math.sin(angle))+400;
                    let originalX = (point.x-car.x) * Math.cos(angle) + (point.y-car.y) * Math.sin(angle);

                    y = -calculateHorizonY(-originalY, -horizon);
                    x = ( ( y-horizon ) / 50 ) * originalX;
                    
                    if (i == 1 || i == 2 || i == 4) { 
                        /*let angleDiff = Math.atan(originalY/originalX) + Math.PI * (originalX > 0) - Math.PI/2;
                        
                        if (Math.abs(angleDiff-Math.PI*2) < Math.abs(angleDiff)) {
                            angleDiff -= Math.PI*2;
                        }

                        if (Math.abs(angleDiff) > Math.PI || Math.hypot(originalX, originalY) > 10000 || Math.abs(x) > 1500) contin--;*/
                        if (y > 500 || Math.hypot(originalX, originalY) > 10000) contin--;

                        if ( i == 4 ) return;
                    }

                    if (point.top) {
                        pointSet.push([x, horizon - points[0].size * (y-horizon), point.color]);
                    } else {
                        pointSet.push([x,y, point.color]);
                    }
                })

                if (pointSet.length && contin > 0) perspectiveBuildingPoints.push(pointSet);
            });

            //requestAnimationFrame( () => { calculateRoadPerspectivePoints() } );
        }

        function drawRoadPerspective() {
            calculateRoadPerspectivePoints()

            let roadColor = "#333";
            if (stats.slipRoad) roadColor = "#344";
            if (currentRegion == "abyss") roadColor = "#111";
            else if (currentRegion == "red carpet") roadColor = "#a11";

            ctx.save();

            ctx.beginPath();
            const angle = car.angle-Math.PI/2;
            let originalY,x,y;
            perspectivePoints.forEach((points, pI) => {
                if (points[0][2].final) {
                    ctx.strokeStyle = "#666";
                    ctx.fillStyle = roadColor;
                    ctx.stroke();
                    ctx.lineWidth = 2;
                    ctx.strokeStyle = roadColor;
                    ctx.stroke();
                    ctx.fill();
                    ctx.lineWidth = game.defaultLineWidth;
            
                    ctx.beginPath();
                }

                points.forEach((point, i) => {
                    if (!i) if (point[2].stripe) ctx.lineWidth = Math.min(15,(point[1]-horizon)/40);

                    if (!i && points.length-1) ctx.moveTo( point[0], point[1] );
                    else ctx.lineTo( point[0], point[1] );
                })
                ctx.closePath();

                if (points[0][2].final) {
                    ctx.fillStyle = "#393";
                    ctx.strokeStyle = "#393";
                    ctx.lineWidth = game.defaultLineWidth;
                    ctx.stroke();
                    ctx.fill();
            
                    ctx.beginPath();
                }

                if (points[0][2].finalPothole) {
                    ctx.fillStyle = "#111";
                    ctx.strokeStyle = "#666";
                    ctx.lineWidth = game.defaultLineWidth/3;
                    ctx.fill();
                    ctx.stroke();
                    ctx.lineWidth = game.defaultLineWidth;
            
                    ctx.beginPath();
                }

                if (points[0][2].finalOilslick) {
                    ctx.fillStyle = "#00000099";
                    ctx.strokeStyle = "#111";
                    ctx.lineWidth = game.defaultLineWidth/3;
                    ctx.fill();
                    ctx.stroke();
                    ctx.lineWidth = game.defaultLineWidth;
            
                    ctx.beginPath();
                }

                if (points[0][2].finalMud) {
                    ctx.fillStyle = "#532";
                    ctx.strokeStyle = "#321";
                    ctx.lineWidth = game.defaultLineWidth/3;
                    ctx.fill();
                    ctx.stroke();
                    ctx.lineWidth = game.defaultLineWidth;
            
                    ctx.beginPath();
                }

                if (points[0][2].finalBooster) {
                    ctx.strokeStyle = "#fc3";
                    ctx.fillStyle = "#c93";
                    ctx.lineWidth = game.defaultLineWidth/3;
                    ctx.fill();
                    ctx.stroke();
                    ctx.lineWidth = game.defaultLineWidth;
            
                    ctx.beginPath();
                }

                if (points[0][2].finalBIce) {
                    ctx.strokeStyle = "#00000010";
                    ctx.fillStyle = "#00000010";
                    ctx.lineWidth = game.defaultLineWidth/3;
                    ctx.fill();
                    ctx.stroke();
                    ctx.lineWidth = game.defaultLineWidth;
            
                    ctx.beginPath();
                }
                
                if (points[0][2].stripe) {
                    ctx.lineJoin = "miter";
                    ctx.strokeStyle = "#990";
                    ctx.stroke();
                    ctx.lineWidth = game.defaultLineWidth;
            
                    ctx.beginPath();
                }
            });

            perspectiveBuildingPoints.forEach((points, pI) => {
                ctx.beginPath();
                points.forEach((point, i) => {
                    ctx.lineTo(point[0],point[1]);
                });
                ctx.closePath();

                ctx.strokeStyle = "#999";
                ctx.fillStyle = points[0][2];
                ctx.lineWidth = game.defaultLineWidth/3;
                ctx.stroke();
                ctx.fill();
                ctx.lineWidth = game.defaultLineWidth;
            });

            if (stats.fog) {
                ctx.fillStyle = fogGradient;
    
                ctx.beginPath();

                ctx.fillRect(-1000,-1000,2000,2000);
            }

            if (stats.wind) {
                let angleDiff = car.angle-stats.windAngle;

                const force = stats.windForce * Math.sin( angleDiff )/stats.inertia * Math.abs(Math.sin(game.timer/1000*Math.PI*2.12) * (0.7+0.3*Math.sin(game.timer/1000*Math.PI*10.3124)))
                //const force = 0.4;

                if (!stats.windTally) stats.windTally = force;
                else stats.windTally += force*100;

                if (stats.windTally > 2000) stats.windTally -= 4000;
                else if (stats.windTally < -2000) stats.windTally += 4000;

                ctx.globalAlpha = Math.min(1, Math.abs(force)/2)

                ctx.strokeStyle = "#fff";
                ctx.translate(-3200,0);
                for(var i = 0; i < 10; i++) {
                    ctx.moveTo(stats.windTally - force*500,0);
                    ctx.lineTo(stats.windTally + force*500,0);
                    ctx.moveTo(stats.windTally - force*500+1000,-50);
                    ctx.lineTo(stats.windTally + force*500+1000,-50);
                    ctx.moveTo(stats.windTally - force*500+500,-100);
                    ctx.lineTo(stats.windTally + force*500+500,-100);
                    ctx.moveTo(stats.windTally - force*500-500,-150);
                    ctx.lineTo(stats.windTally + force*500-500,-150);
                    ctx.moveTo(stats.windTally - force*500,100);
                    ctx.lineTo(stats.windTally + force*500,100);
                    ctx.moveTo(stats.windTally - force*500+1000,50);
                    ctx.lineTo(stats.windTally + force*500+1000,50);
                    ctx.moveTo(stats.windTally - force*500+500,-200);
                    ctx.lineTo(stats.windTally + force*500+500,-200);
                    ctx.moveTo(stats.windTally - force*500-500,-250);
                    ctx.lineTo(stats.windTally + force*500-500,-250);
                    ctx.moveTo(stats.windTally - force*500,-450);
                    ctx.lineTo(stats.windTally + force*500,-450);
                    ctx.moveTo(stats.windTally - force*500+1000,-350);
                    ctx.lineTo(stats.windTally + force*500+1000,-350);
                    ctx.moveTo(stats.windTally - force*500+500,-300);
                    ctx.lineTo(stats.windTally + force*500+500,-300);
                    ctx.moveTo(stats.windTally - force*500-500,-400);
                    ctx.lineTo(stats.windTally + force*500-500,-400);
                    ctx.moveTo(stats.windTally - force*500,350);
                    ctx.lineTo(stats.windTally + force*500,350);
                    ctx.moveTo(stats.windTally - force*500+1000,250);
                    ctx.lineTo(stats.windTally + force*500+1000,250);
                    ctx.moveTo(stats.windTally - force*500+500,200);
                    ctx.lineTo(stats.windTally + force*500+500,200);
                    ctx.moveTo(stats.windTally - force*500-500,300);
                    ctx.lineTo(stats.windTally + force*500-500,300);

                    ctx.translate(800,0);
                }
                ctx.stroke();
            }

            ctx.restore();

            /*buildingPoints.forEach( (building) => {
                ctx.beginPath();
                building.forEach((item)=> ctx.lineTo(item.x, item.y));
                ctx.stroke();
            })*/
        }

        function calculateHorizonY(input, horizon) {
            if (input < -499) return horizon-100000/(1);
            return horizon-100000/(input+500);
        }

        async function drive() {
            car.x += Math.cos(car.speedAngle)*car.speed;
            car.y += Math.sin(car.speedAngle)*car.speed;

            if ( game.timer < stats.timerMax && car.running && ( keys.includes("w") || keys.includes(" ") ) && ((car.braking && stats.partAcc) || car.speed > -stats.topSpeed * ( 1 + 0.2 * !!(stats.noHands && mouse.selected != "wheel") ) * ( 1 + 0.5 * (car.booster/300) ) * ( 1 + game.audioVolume/2.5 ) ) ) {
                car.speed -= stats.acceleration * (1 + 2*(car.speed > 0) ) * ( 1 + 0.7 * !!(stats.noHands && mouse.selected != "wheel") ) * ( 1 + 9 * (car.booster/300) );
                car.accelerating = true;
                if (car.brakeBoost > car.booster) {
                    car.booster = car.brakeBoost;
                    car.brakeBoost = 0;
                }
            } else {
                car.speed *= 0.998;
                car.accelerating = false;
            }
            if ( game.timer < stats.timerMax &&  car.running && ( keys.includes("s") || keys.includes("shift") ) && car.speed < stats.topSpeed/5 && !stats.noBrake) {
                if (!car.accelerating) {
                    if (stats.regenBrake && car.brakeBoost < 400) car.brakeBoost += 17*stats.acceleration * (1 + 2*(car.speed < 0) );

                    car.speed += stats.acceleration * (1 + 2*(car.speed < 0) );
                }
                car.braking = true;
            } else {
                car.braking = false;
            }

            if (mouse.selected == "wheel") {
                const wheelAngle = -car.wheel*Math.PI*5/2+Math.PI/2;
                let mouseWheelAngle = Math.atan( (mouse.y-currentCar.positions.wheel[1]) / (mouse.x-currentCar.positions.wheel[0]) ) + Math.PI*(mouse.x >= currentCar.positions.wheel[0])-mouse.wheelOffset;

                let angleDiff = wheelAngle-mouseWheelAngle;

                while (Math.abs(angleDiff-Math.PI*2) < Math.abs(angleDiff)) {
                    mouseWheelAngle += Math.PI*2;
                    angleDiff = wheelAngle-mouseWheelAngle;
                }
                while (Math.abs(angleDiff+Math.PI*2) < Math.abs(angleDiff)) {
                    mouseWheelAngle -= Math.PI*2;
                    angleDiff = wheelAngle-mouseWheelAngle;
                }

                if (Math.abs(angleDiff) > stats.turnSpeed) angleDiff = Math.sign(angleDiff)*stats.turnSpeed;

                car.wheel -= -(angleDiff) / (Math.PI*5/2) * (1 - 0.8*(!!stats.partAcc && car.accelerating && car.braking));
            } else if (stats.telekinesis && ( keys.includes("d") - keys.includes("a") )) {
                car.wheel -= 0.01*( keys.includes("d") - keys.includes("a") )*stats.turnSpeed;
            }
            else {
                car.wheel *= 0.98;
            }
            
            if (mouse.selected == "wiper") {
                const oldWiperAngle = -Math.PI*11/10*car.wiper+Math.PI/20;

                let diff = (mouse.x-currentCar.positions.windWipers[0] - 125 + 250 * (car.wiper))/250;

                diff = Math.max(-1/15,Math.min(1/15,diff));

                car.wiper -= diff;

                car.wiper = Math.max(0,Math.min(1,car.wiper));

                const wiperAngle = -Math.PI*11/10*car.wiper+Math.PI/20;

                let angle; 
                windshield = windshield.filter( (item) => {
                    angle = Math.atan( (item.y-300)/item.x )-Math.PI*(item.x < 0);
                    if (!item.x) angle = -Math.PI/2;
                    if ((angle > oldWiperAngle && angle < wiperAngle) || (angle < oldWiperAngle && angle > wiperAngle)) item.durability--;

                    if (item.durability <= 0) return false;
                    return true;
                } )
            }
            
            car.wheel = Math.max(-1,Math.min(1,car.wheel));

            if (!car.jumpPos && !car.bIce) {
                car.angleDiff = Math.PI/60/30 * car.wheel * car.speed * (1 - 0.5*car.oilslick) * (1-2*!!stats.invertSteering)
            }
            car.angle += car.angleDiff;
            car.angle = car.angle%(Math.PI*2);

            if (car.bIce) {
                car.angle += car.angleDiff*3;
            }

            //changing speedAngle
            let angleDiff = car.angle-car.speedAngle;

            while (Math.abs(angleDiff-Math.PI*2) < Math.abs(angleDiff)) {
                car.speedAngle += Math.PI*2;
                angleDiff = car.angle-car.speedAngle;
            }
            while (Math.abs(angleDiff+Math.PI*2) < Math.abs(angleDiff)) {
                car.speedAngle -= Math.PI*2;
                angleDiff = car.angle-car.speedAngle;
            }

            if (stats.driftWiper && Math.sign(angleDiff) == -Math.sign(car.wiper-0.5)) {
                car.speedAngle += angleDiff
            } else {
                if (Math.abs(angleDiff) > Math.PI/15) {
                    if (stats.driftBoost) stats.driftBoostCharge += Math.abs(angleDiff)*350;
                }else if (stats.driftBoostCharge && car.booster < stats.driftBoostCharge) {
                    car.booster = stats.driftBoostCharge;
                    stats.driftBoostCharge = 0;
                }

                if (stats.jamin && Math.abs(angleDiff) > Math.abs(stats.requiredDriftAngle/car.speed) / ( 1 + game.audioVolume )) {
                    angleDiff *= stats.driftGrip / ( 1 + game.audioVolume );
                }

                if (stats.pLaneChange && (Math.sign(angleDiff) == 1 && car.blinker != "r" || Math.sign(angleDiff) == -1 && car.blinker != "l")) {
                    angleDiff *= 0.07;
                }

                car.speedAngle += angleDiff * (1-0.75*car.oilslick) * (1-0.6*car.bIce);
            }

            if (stats.wind) {
                let angleDiff = car.angle-stats.windAngle;

                car.angle += (Math.PI/300) * stats.windForce * Math.sin( angleDiff )/stats.inertia * Math.abs(Math.sin(game.timer/1000*Math.PI*2.12) * (0.7+0.3*Math.sin(game.timer/1000*Math.PI*10.3124)));
            }

            if (car.pothole) {
                car.angle += car.pothole*Math.PI/1000 * car.speed;
            }

            if (car.booster > 0) car.booster--;
            
            if (car.jumpPos || car.jumpPosVel) {
                car.jumpPos += car.jumpPosVel;
                car.jumpPosVel--;

                if (car.jumpPos <= 0) {
                    car.jumpPos = false;
                    car.jumpPosVel = false;
                }
            }
        }

        async function checkCollision() {
            let mud = false;
            let touching = false;
            car.pothole = false;
            car.oilslick = false;
            car.bIce = false;

            let diffNeeded, diffNeededCos, carAngle, intAngle;
            
            road.forEach((road, i)=> {
                if (Math.hypot(road.x-car.x, road.y-car.y) > road.size*2) return;

                if (!road.final && car.jumpPos) return;

                //road.angle --> angle to rectangle
                carAngle = Math.atan( (road.y-car.y) / (road.x-car.x) ) + Math.PI*(road.x > car.x);
                if (!(road.x-car.x)) carAngle = Math.PI*(road.x > car.x);
                intAngle = (carAngle-road.angle);

                diffNeeded = Math.abs(Math.sin(intAngle))**-1*road.size;
                diffNeededCos = Math.abs(Math.cos(intAngle))**-1*road.size;
                if (diffNeededCos < diffNeeded) diffNeeded = diffNeededCos;
                if (Math.hypot(road.x-car.x,road.y-car.y) < diffNeeded) {
                    if (road.oilslick) car.oilslick = true;
                    else if (road.booster) car.booster = 300;
                    else if (road.mud) mud = true;
                    else if (road.bIce) car.bIce = true;
                    else if (road.pothole) {
                        touching = false;

                        car.pothole = Math.sign(road.angle);
                    } else {
                        touching = true;
                    }

                    if (road.final) {
                        mouse.selected = false;
                        mouse.hover = false;

                        game.status = "choosing";

                        generateChoices();

                        engineRev.pause();
                        horn.pause();
                    }
                }
            })

            buildings.forEach((road, i) => {
                if (Math.hypot(road.x-car.x, road.y-car.y) > road.size*2) return;

                //road.angle --> angle to rectangle
                carAngle = Math.atan( (road.y-car.y) / (road.x-car.x) ) + Math.PI*(road.x > car.x);
                if (!(road.x-car.x)) carAngle = Math.PI*(road.x > car.x);
                intAngle = (carAngle-road.angle);

                diffNeeded = Math.abs(Math.sin(intAngle))**-1*road.size;
                diffNeededCos = Math.abs(Math.cos(intAngle))**-1*road.size;
                if (diffNeededCos < diffNeeded) diffNeeded = diffNeededCos;
                diffNeeded = Math.hypot(road.x-car.x,road.y-car.y) - diffNeeded;
                if (diffNeeded < 0) {
                    car.x -= Math.cos(carAngle)*diffNeeded;
                    car.y -= Math.sin(carAngle)*diffNeeded;

                    //repurposing variables, angle of the wall
                    carAngle = road.angle + Math.PI/2 * Math.floor(0.5 + carAngle/(Math.PI/2));

                    car.speedAngle = carAngle + (carAngle-car.speedAngle) + Math.PI*(car.speed > 0);

                    car.speed *= 0.95;
                }
            })

            if (!car.jumpPos) if (!touching && Math.abs(car.speed) > stats.offroadMaxSpeed && (!stats.offroadCruise || car.running) && !car.jumpPos) {
                car.speed *= 1-stats.offroadSpeedLoss/stats.inertia;
            }

            if (!car.jumpPos) if (mud && !car.mud) {
                for(var i = 0; i < 5; i++) windshield.push( { type: "mud", x: -550+1100*Math.random(), y: -300+550*Math.random(), durability: 3, maxDurability: 3 } )
            }
            car.mud = mud;

            if (!car.jumpPos) if (car.mud && Math.abs(car.speed) > stats.offroadMaxSpeed && !(stats.offroadCruise && !stats.running)) {
                car.speed *= 1-0.02/stats.inertia;
            }
        }

        function drawDash() {
            //windshield crack
            if (stats.crackPath) {
                ctx.lineWidth = Math.min(game.defaultLineWidth*2, game.defaultLineWidth/200 * stats.crack.length);

                ctx.beginPath();
                stats.crackPath.forEach((pos) => {
                    if (pos[2] === true) ctx.moveTo(...pos);
                    else ctx.lineTo(...pos);
                } )
                ctx.strokeStyle = "#ccc";
                ctx.stroke();

                ctx.lineWidth = game.defaultLineWidth;
            }

            //boost lines
            if (car.booster) {
                const ratio = Math.max(0,50/(car.booster+1));
                ctx.strokeStyle = "#cccccc33";

                ctx.beginPath();
                ctx.moveTo(0,500);
                ctx.lineTo(0,100+1000*ratio);
                ctx.moveTo(0,-500);
                ctx.lineTo(0,-100-1000*ratio);
                ctx.moveTo(-1000,0);
                ctx.lineTo(-200-1000*ratio,0);
                ctx.moveTo(1000,0);
                ctx.lineTo(200+1000*ratio,0);
                ctx.moveTo(1000,500);
                ctx.lineTo(200+800*ratio,100+400*ratio);
                ctx.moveTo(1000,-500);
                ctx.lineTo(200+800*ratio,-100-400*ratio);
                ctx.moveTo(-1000,500);
                ctx.lineTo(-200-800*ratio,100+400*ratio);
                ctx.moveTo(-1000,-500);
                ctx.lineTo(-200-800*ratio,-100-400*ratio);
                ctx.moveTo(-500,-500);
                ctx.lineTo(-100-450*ratio,-200-450*ratio);
                ctx.moveTo(500,-500);
                ctx.lineTo(100+450*ratio,-200-450*ratio);
                ctx.stroke();
            }

            //windsheild Objects
            {
                let size = 1;

                while (windshield.length > 200) windshield.splice(0,1);
                windshield.forEach( (item) => {
                    switch(item.type) {
                    case "mud": {
                        size = item.durability / item.maxDurability;

                        ctx.beginPath();
                        ctx.moveTo(item.x+300*size, item.y);
                        ctx.lineTo(item.x+300*size*0.7, item.y+300*size*0.7);
                        ctx.lineTo(item.x, item.y+300*size);
                        ctx.lineTo(item.x-300*size*0.7, item.y+300*size*0.7);
                        ctx.lineTo(item.x-300*size, item.y);
                        ctx.lineTo(item.x-300*size*0.7, item.y-300*size*0.7);
                        ctx.lineTo(item.x, item.y-300*size);
                        ctx.lineTo(item.x+300*size*0.7, item.y-300*size*0.7);
                        ctx.closePath();

                        ctx.fillStyle = "#532";
                        ctx.fill();
                        ctx.strokeStyle = "#321";
                        ctx.stroke();

                        break;
                        }
                    case "bug": {
                        size = item.durability / item.maxDurability;

                        ctx.beginPath();
                        ctx.moveTo(item.x+90*size, item.y);
                        ctx.lineTo(item.x+90*size*0.7, item.y+90*size*0.7);
                        ctx.lineTo(item.x, item.y+90*size);
                        ctx.lineTo(item.x-90*size*0.7, item.y+90*size*0.7);
                        ctx.lineTo(item.x-90*size, item.y);
                        ctx.lineTo(item.x-90*size*0.7, item.y-90*size*0.7);
                        ctx.lineTo(item.x, item.y-90*size);
                        ctx.lineTo(item.x+90*size*0.7, item.y-90*size*0.7);
                        ctx.closePath();

                        ctx.fillStyle = "#252";
                        ctx.fill();
                        ctx.strokeStyle = "#232";
                        ctx.stroke();

                        break;
                        }
                    }
                })
            }

            currentCar.drawFunctions.dash();

            currentCar.drawFunctions.ignition(...currentCar.positions.ignition);
            currentCar.drawFunctions.hazard(...currentCar.positions.hazard);
            currentCar.drawFunctions.blinker(...currentCar.positions.blinker);
            currentCar.drawFunctions.radio(...currentCar.positions.radio);
            currentCar.drawFunctions.speedometer(...currentCar.positions.speedometer);
            currentCar.drawFunctions.gasMeter(...currentCar.positions.gasMeter);
            currentCar.drawFunctions.windWipers(...currentCar.positions.windWipers);
            currentCar.drawFunctions.wheel(...currentCar.positions.wheel);
            
            //fps gauge
            {
                ctx.beginPath();

                ctx.rect(-850,-450, 50, 30);

                ctx.strokeStyle = "#222";
                ctx.fillStyle = "#444";
                ctx.stroke();
                ctx.fill();

                ctx.beginPath();
                ctx.strokeStyle = "#777";
                ctx.fillStyle = "#999";
                ctx.font = "20px Jura";
                ctx.fillText(game.fps, -825,-435);
            }     
        }

        function checkHover() {
            if (game.menu) {
                if (game.menu == "main") {
                    if (Math.hypot(mouse.x-200, mouse.y) < 150) {
                        mouse.hover = "drive";
                        return;
                    } else if (mouse.x < -200) {
                        if (mouse.y < -230 && mouse.y > -360) {
                            mouse.hover = "menu1";
                            return;
                        } else if (mouse.y < -80 && mouse.y > -210) {
                            mouse.hover = "menu2";
                            return;
                        } else if (mouse.y < 60 && mouse.y > -60) {
                            mouse.hover = "menu3";
                            return;
                        } else if (mouse.y < 210 && mouse.y > 80) {
                            mouse.hover = "menu4";
                            return;
                        } else if (mouse.y < 360 && mouse.y > 230) {
                            mouse.hover = "menu5";
                            return;
                        }
                    }
                } else if (game.menu == "settings") {
                    if (mouse.x > -100) {
                        if (mouse.y < -230 && mouse.y > -360) {
                            mouse.hover = "menu1";
                            return;
                        } else if (mouse.x < 200) { if (mouse.y < -80 && mouse.y > -210) {
                            mouse.hover = "menu2";
                            return;
                        } else if (mouse.y < 60 && mouse.y > -60) {
                            mouse.hover = "menu3";
                            return;
                        } else if (mouse.y < 210 && mouse.y > 80) {
                            mouse.hover = "menu4";
                            return;
                        } else if (mouse.y < 360 && mouse.y > 230) {
                            mouse.hover = "menu5";
                            return;
                        } }
                    }
                } else if (game.menu == "pause") {
                    if (mouse.y < -50 && mouse.y > -150) {
                        mouse.hover = "menu1";
                        return;
                    } else if (mouse.y < 150 && mouse.y > 50) {
                        mouse.hover = "menu2";
                        return;
                    }
                }
            } else {
                //wheel
                const wheelHypot = Math.hypot(mouse.x-currentCar.positions.wheel[0], mouse.y-currentCar.positions.wheel[1]);
                if (wheelHypot > 150 && wheelHypot < 230) {
                    mouse.hover = "wheel";
                    return;
                } else if (wheelHypot < 75) {
                    mouse.hover = "horn";
                    return;
                } else if (Math.hypot(mouse.x-currentCar.positions.hazard[0], mouse.y-currentCar.positions.hazard[1]) < 50) {
                    mouse.hover = "hazard";
                    return;
                } else if (Math.hypot(mouse.x-currentCar.positions.ignition[0], mouse.y-currentCar.positions.ignition[1]) < 50) {
                    mouse.hover = "ignition";
                    return;
                } else if (Math.hypot(mouse.x-currentCar.positions.windWipers[0] - 125 + 250 * (car.wiper), mouse.y-currentCar.positions.windWipers[1]) < 50) {
                    mouse.hover = "wiper";
                    return;
                } else if (Math.hypot(mouse.x-currentCar.positions.radio[0], mouse.y-currentCar.positions.radio[1]) < 50) {
                    mouse.hover = "radio";
                    return;
                } else if (Math.hypot(mouse.x-currentCar.positions.blinker[0]+20, mouse.y-currentCar.positions.blinker[1]) < 30) {
                    mouse.hover = "blinkerL";
                    return;
                } else if (Math.hypot(mouse.x-currentCar.positions.blinker[0]-20, mouse.y-currentCar.positions.blinker[1]) < 30) {
                    mouse.hover = "blinkerR";
                    return;
                }
            }

            mouse.hover = false;
        }

        function drawChoices() {
            ctx.beginPath();
            ctx.fillStyle = "#ffffff33";
            ctx.strokeStyle = "#99999999";
            ctx.rect(-1000,-1000,3500,3600);
            ctx.fill();

            if (perkChoices[perkChoicePos] == "final" || perkChoicePos == perkChoices.length) {
                ctx.fillStyle = "#f33";
                ctx.font = "100px serif";
                ctx.fillText("R    E    M    O    V    E", 0, -250);
            } else {
                ctx.fillStyle = "#fff";
                ctx.font = "100px serif";
                ctx.fillText("C    H    O    O    S    E", 0, -250);
            }
            
            choices.forEach((choice, i) => {
                ctx.beginPath();

                if (mouse.x > -600+800*i && mouse.x < -200+800*i && mouse.y > -200 && mouse.y < 200) {
                    ctx.strokeStyle = "#ccc";
                    ctx.rect(-620+800*i, -220, 440, 440);
                } else {
                    ctx.strokeStyle = "#999";
                    ctx.rect(-600+800*i, -200, 400, 400);
                }
                ctx.strokeStyle = "#ccc";
                ctx.fillStyle = "#ffffff33";
                ctx.fill();
                ctx.stroke();

                ctx.save();

                ctx.translate(-400+800*i, 0);

                choice.choice.drawFunction();

                ctx.restore();
                
                if (mouse.x > -600+800*i && mouse.x < -200+800*i && mouse.y > -200 && mouse.y < 200) {
                    ctx.beginPath();
                    ctx.rect(mouse.x-choice.choice.desc.length*12.5, mouse.y+50, choice.choice.desc.length*25, 100);
                    ctx.fillStyle = "#ffffff55";
                    ctx.strokeStyle = "#ccc";
                    ctx.fill();
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.fillStyle = "#555";
                    ctx.font = "50px serif";
                    ctx.fillText(choice.choice.desc, mouse.x, mouse.y+100);
                }
            });
        }

        function generateChoices() {
            choices = [];

            const positions = [];

            if (perkChoices[perkChoicePos] == "perk") for (var i = 0; i < 2 && i < stackablePerks.length; i++) {
                let position = Math.round((stackablePerks.length - 1)*Math.random());
                while (positions.includes(position)) position = Math.round((stackablePerks.length - 1)*Math.random());
                let perk = stackablePerks[position];

                positions.push(position);

                choices.push({choice: perk, position: position})
            }

            else if (perkChoices[perkChoicePos] == "punish") for (var i = 0; i < 2 && i < stackablePunishments.length; i++) {
                let position = Math.round((stackablePunishments.length - 1)*Math.random());
                while (positions.includes(position)) position = Math.round((stackablePunishments.length - 1)*Math.random());
                let punishment = stackablePunishments[position];

                positions.push(position);

                choices.push({choice: punishment, position: position})
            }

            else if (perkChoices[perkChoicePos] == "unstackPerk") for (var i = 0; i < 2 && i < unStackablePerks.length; i++) {
                let position = Math.round((unStackablePerks.length - 1)*Math.random());
                while (positions.includes(position)) position = Math.round((unStackablePerks.length - 1)*Math.random());
                let perk = unStackablePerks[position];

                positions.push(position);

                choices.push({choice: perk, position: position})
            }

            else if (perkChoices[perkChoicePos] == "unstackPunish") for (var i = 0; i < 2 && i < unStackablePunishments.length; i++) {
                let position = Math.round((unStackablePunishments.length - 1)*Math.random());
                while (positions.includes(position)) position = Math.round((unStackablePunishments.length - 1)*Math.random());
                let punishment = unStackablePunishments[position];

                positions.push(position);

                choices.push({choice: punishment, position: position})
            }
            else if (perkChoices[perkChoicePos] == "final") for (var i = 0; i < 2 && i < chosenPunish.length; i++) {
                let position = Math.round((chosenPunish.length - 1)*Math.random());
                while (positions.includes(position)) position = Math.round((chosenPunish.length - 1)*Math.random());
                let punishment = chosenPunish[position];

                positions.push(position);

                choices.push({choice: punishment, position: position})
            }
            else if (perkChoicePos == perkChoices.length) for (var i = 0; i < 2 && i < chosenPerk.length; i++) {
                let position = Math.round((chosenPerk.length - 1)*Math.random());
                while (positions.includes(position)) position = Math.round((chosenPerk.length - 1)*Math.random());
                let punishment = chosenPerk[position];

                positions.push(position);

                choices.push({choice: punishment, position: position})
            }
        }

        function chooseChoice() {
            let choiceNum = false;
            if (mouse.x > -600 && mouse.x < -200 && mouse.y > -200 && mouse.y < 200) {
                choiceNum = 0;
            }
            if (mouse.x > 200 && mouse.x < 600 && mouse.y > -200 && mouse.y < 200) {
                choiceNum = 1;
            }

            if (choiceNum !== false) {
                const choice = choices[choiceNum];

                choice.choice.chooseFunction();

                if (perkChoices[perkChoicePos] == "unstackPerk") {
                    chosenPerk.push(choice.choice);
                    unStackablePerks.splice(choice.position, 1);
                }
                else if (perkChoices[perkChoicePos] == "unstackPunish") {
                    chosenPunish.push(choice.choice);
                    unStackablePunishments.splice(choice.position, 1);
                } else if (perkChoices[perkChoicePos] == "final") {
                    chosenPunish.splice(choice.position, 1);

                    perkChoicePos++;
                    generateChoices();

                    return;
                }

                chosenPerkDraw.push(choice.choice.drawFunction);

                car.x = 0;
                car.y = 0;
                car.speed = 0;
                car.angle = Math.PI/2;
                car.speedAngle = Math.PI/2;
                car.running = false;

                game.status = "driving";

                game.timer = 0;
                game.timerCounting = false;
                stats.timerMax *= 0.985;

                if (stats.crack) developCrack();

                if (stats.poltergeist) {
                    currentCar.positions.wheel = currentCar.misc.randomDashPos();
                    currentCar.positions.speedometer = currentCar.misc.randomDashPos();
                    currentCar.positions.gasMeter = currentCar.misc.randomDashPos();
                    currentCar.positions.ignition = currentCar.misc.randomDashPos();
                    currentCar.positions.hazard = currentCar.misc.randomDashPos();
                    currentCar.positions.blinker = currentCar.misc.randomDashPos();
                    currentCar.positions.radio = currentCar.misc.randomDashPos();
                    currentCar.positions.windWipers = currentCar.misc.randomDashPos();
                }

                if (perkChoicePos == perkChoices.length) {
                    chosenPerk.splice(choice.position, 1);
                    if (choice.choice.name == "Windsheild Crack") stats.crack = undefined;

                    currentRegion = regions[0];
                    regions.splice(0,1);

                    perkChoicePos = 0;
                    chosenPerkDraw = [];

                    stats = {
                        roadLength: 80000,
                        roadSize: 200,
                        roadAngle: Math.PI/20,
                        acceleration: 0.05,
                        topSpeed: 30,
                        turnSpeed: Math.PI/25,
                        offroadSpeedLoss: 0.2,
                        offroadMaxSpeed: 8,
                        requiredDriftAngle: Math.PI/17,
                        driftGrip: 0.07,
                        inertia: 1,
                        roadHazardChance: 1,
                        timerMax: 4300,
                        crack: stats.crack,
                    }

                    if (currentRegion == "city") {
                        stats.roadSize *= 1.25;

                        song.src = 'Stick-City.ogg';
                        song.play();

                        songAuthor = "Stick-City - BetaFail";
                    }
                    else if (currentRegion == "abyss") {
                        stats.roadSize *= 0.90;
                        stats.roadLength /= 2.2;

                        song.src = 'The Fallen.mp3';
                        song.play();

                        songAuthor = "The Fallen - CoolTasDude";
                    }
                    else if (currentRegion == "highway") {
                        stats.roadSize *= 1.9;
                        stats.roadLength *= 2;
                        stats.roadAngle *= 0.5;
                        stats.topSpeed *= 2;
                        stats.acceleration *= 2;

                        song.src = 'TraffStick.ogg';
                        song.play();

                        songAuthor = "TraffStick - Mathieu";
                    }
                    else if (currentRegion == "canyon") {
                        stats.roadAngle *= 1.2;
                    }
                    else if (currentRegion == "red carpet") {
                        stats.roadLength *= 3;
                        stats.timerMax *= 3;

                        perkChoices = [ "finish" ];
                    }

                    chosenPerk.forEach((thing) => thing.chooseFunction());
                    chosenPunish.forEach((thing) => thing.chooseFunction());
                } else {
                    perkChoicePos++;

                    //generateChoices();
                    //game.status = "choosing"
                }

                if (stats.wind) stats.windAngle = Math.PI*2*Math.random();

                generatePlatformRoad(stats.roadLength/stats.roadSize);
            }
        }

        function generatePlatformRoad(amount) {
            road = [];
            buildings = [];
            buildingPoints = [];

            let pos = { x: 0, y: 0};
            let angle = -Math.PI/2;
            let size = stats.roadSize;

            for (var i = 0; i <= Math.floor(amount); i++) {
                let roadAngle = Math.PI*Math.random();
                if (currentRegion == "city" || currentRegion == "red carpet") roadAngle = angle;
                road.push( {x: pos.x, y: pos.y, size: size+size*Math.random()/2*(currentRegion != "city" && currentRegion != "red carpet") + size/4*(currentRegion == "city" || currentRegion == "red carpet"), angle: roadAngle, road: true, final: i == Math.floor(amount), roadAngle: angle} );

                pos.x += Math.cos(angle)*size * (1 + 1.2 * (currentRegion == "abyss"));
                pos.y += Math.sin(angle)*size * (1 + 1.2 * (currentRegion == "abyss"));

                if (currentRegion == "city") { if (Math.random() < stats.roadAngle/Math.PI/7) {
                    angle += Math.PI/2-Math.PI*(Math.random() < 0.5)
                    road[road.length-1].size *= 1.25;
                }
                } else angle += stats.roadAngle/2-stats.roadAngle*Math.random();
            }

            if (stats.potholes) {
                road.forEach((roadItem, i) => {if (roadItem.road && (Math.random() < 0.10*stats.roadHazardChance) && i <= road.length-3) {
                    road.push( {x: roadItem.x - roadItem.size + roadItem.size*2*Math.random(), y: roadItem.y - roadItem.size + roadItem.size*2*Math.random(), size: roadItem.size/5, angle: Math.PI*Math.random()-Math.PI/2, pothole: true } );
                } } );
                road[road.length-1].finalPothole = true
            }
            if (stats.oilslick) {
                road.forEach((roadItem, i) => {if (roadItem.road && (Math.random() < 0.035*stats.roadHazardChance) && i <= road.length-3) {
                    road.push( {x: roadItem.x - roadItem.size + roadItem.size*2*Math.random(), y: roadItem.y - roadItem.size + roadItem.size*Math.random(), size: roadItem.size*3, angle: Math.PI*Math.random()-Math.PI/2, oilslick: true } );
                } } );
                road[road.length-1].finalOilslick = true
            }
            if (stats.mud) {
                road.forEach((roadItem, i) => {if (roadItem.road && (Math.random() < 0.020*stats.roadHazardChance) && i <= road.length-3) {
                    road.push( {x: roadItem.x - roadItem.size + roadItem.size*2*Math.random(), y: roadItem.y - roadItem.size + roadItem.size*Math.random(), size: roadItem.size*0.45, angle: Math.PI*Math.random()-Math.PI/2, mud: true } );
                } } );
                road[road.length-1].finalMud = true
            }
            if (stats.booster) {
                road.forEach((roadItem, i) => {if (roadItem.road && (Math.random() < 0.010*stats.roadHazardChance) && i <= road.length-3) {
                    road.push( {x: roadItem.x - roadItem.size + roadItem.size*2*Math.random(), y: roadItem.y - roadItem.size + roadItem.size*Math.random(), size: roadItem.size*0.2, angle: Math.PI*Math.random()-Math.PI/2, booster: true } );
                } } );
                road[road.length-1].finalBooster = true
            }
            if (stats.bIce) {
                road.forEach((roadItem, i) => {if (roadItem.road && (Math.random() < 0.03*stats.roadHazardChance) && i <= road.length-3) {
                    road.push( {x: roadItem.x - roadItem.size + roadItem.size*2*Math.random(), y: roadItem.y - roadItem.size + roadItem.size*2*Math.random(), size: roadItem.size*1.25, angle: Math.PI*Math.random()-Math.PI/2, bIce: true } );
                } } );
                road[road.length-1].finalBIce = true
            }
            if (currentRegion == "city") {

                road.forEach((roadItem, i) => {if (roadItem.road && (Math.random() < 1*stats.roadHazardChance) && i <= road.length-3) {
                    const angle = roadItem.roadAngle+Math.PI/2 + Math.PI*(Math.random() < 0.5);
                    buildings.push( {x: roadItem.x - roadItem.size*4*Math.cos(angle), y: roadItem.y - roadItem.size*4*Math.sin(angle), size: roadItem.size, angle: roadItem.roadAngle, color: ("#" + Math.floor(Math.random()*9) + Math.floor(Math.random()*9) + Math.floor(Math.random()*9)), height: 3 + 5*Math.random() } );
                    i += 3;
                } } );

                buildings = buildings.filter((building, i) => {
                    let thing = true
                    road.forEach( (road) => {if ( Math.hypot(road.x-building.x, road.y-building.y) < building.size*2.5 ) thing = false; } )
                    buildings.forEach( (road, i2) => {if ( i != i2) if (Math.hypot(road.x-building.x, road.y-building.y) < building.size + road.size && (road.exist || i2 > i) ) thing = false; } )

                    building.exist = thing;

                    return thing;
                })
            }
            if (currentRegion == "canyon") {
                let offset = 0;
                road.forEach((roadItem, i) => {if (roadItem.road && i <= road.length-3 && i > offset) {
                    const angle = roadItem.roadAngle+Math.PI/2;
                    buildings.push( {x: roadItem.x - roadItem.size*3*Math.cos(angle), y: roadItem.y - roadItem.size*3*Math.sin(angle), size: roadItem.size*1.5, angle: roadItem.roadAngle, color: `#${(Math.random()*2+7).toFixed(0)}${(Math.random()*2+3).toFixed(0)}1`, height: 20.5+Math.random() } );
                    const angle2 = roadItem.roadAngle+Math.PI/2 + Math.PI;
                    buildings.push( {x: roadItem.x - roadItem.size*3*Math.cos(angle2), y: roadItem.y - roadItem.size*3*Math.sin(angle2), size: roadItem.size*1.5, angle: roadItem.roadAngle, color: `#${(Math.random()*2+7).toFixed(0)}${(Math.random()*2+3).toFixed(0)}1`, height: 20.5+Math.random() } );
                    offset = i + 3;
                } } );

                buildings = buildings.filter((building, i) => {
                    let thing = true
                    road.forEach( (road) => {if ( Math.hypot(road.x-building.x, road.y-building.y) < road.size ) thing = false; } )

                    building.exist = thing;

                    return thing;
                })
            }

            calculateRoadPoints();
        }
        
        let crackPreviousSelected = [];
        function developCrack() {
            let currentPos = stats.crack.length-1;
            stats.crack.forEach( (crack, i) => {
                if (i >= currentPos || crackPreviousSelected.includes[i]) return;

                if (Math.random() < 10/currentPos) {
                    stats.crack.push( [
                        [crack[0][0]+Math.sign(crack[0][0]-crack[1][0])*((currentPos+25)*4*Math.random()-(currentPos+25)/4), crack[0][1]+Math.sign(crack[0][1]-crack[1][1])*((currentPos+25)*4*Math.random()-(currentPos+25)/4), true],
                        [crack[0][0],crack[0][1]]
                    ] )
                    if (Math.random() < 0.4) stats.crack[stats.crack.length-1].push(
                        [crack[0][0]+Math.sign(crack[0][0]-crack[1][0])*((currentPos+25)*4*Math.random()-(currentPos+25)/4), crack[0][1]+Math.sign(crack[0][1]-crack[1][1])*((currentPos+25)*4*Math.random()-(currentPos+25)/4)]
                    )
                    if (crack[2]){
                        stats.crack.push( [
                            [crack[2][0]+Math.sign(crack[2][0]-crack[1][0])*((currentPos+25)*4*Math.random()-(currentPos+25)/4), crack[2][1]+Math.sign(crack[2][1]-crack[1][1])*((currentPos+25)*4*Math.random()-(currentPos+25)/4), true],
                            [crack[2][0],crack[2][1]]
                        ] )
                        if (Math.random() < 0.4) stats.crack[stats.crack.length-1].push(
                            [crack[2][0]+Math.sign(crack[2][0]-crack[1][0])*((currentPos+25)*4*Math.random()-(currentPos+25)/4), crack[2][1]+Math.sign(crack[2][1]-crack[1][1])*((currentPos+25)*4*Math.random()-(currentPos+25)/4)]
                        )
                    }

                    crackPreviousSelected.push(i);
                }
            } )

            stats.crackPath = [];
            stats.crack.forEach( (crack, i) => {
                stats.crackPath.push(...crack);
            } )
        }

        async function drawMenu() {
            const rainbow = ctx.createLinearGradient(0, -8000+game.rgbTimer%8000, 0, game.rgbTimer%8000);

            rainbow.addColorStop(0, "#f00");
            rainbow.addColorStop(0.33, "#0f0");
            rainbow.addColorStop(0.67, "#00f");
            rainbow.addColorStop(1, "#f00");
            
            game.rgbTimer++;
            if (game.rgbTimer > 1000000) game.rgbTimer -= 500*Math.PI;

            if (game.menu == "pause") {
                drawSkybox();
                drawRoadPerspective();
                drawDash();

                ctx.beginPath();
                ctx.fillStyle = "#00000099";
                ctx.rect(-2000,-1000,4000,2000);
                ctx.fill();

                ctx.beginPath();
                ctx.strokeStyle = "#333";
                ctx.fillStyle = "#ad7d53"; 
                ctx.rect(-250-100*(mouse.hover == "menu1"),-150,500+200*(mouse.hover == "menu1"),100);
                ctx.rect(-250-100*(mouse.hover == "menu2"),50,500+200*(mouse.hover == "menu2"),100);
                ctx.stroke();
                ctx.fill();

                ctx.beginPath();
                ctx.strokeStyle = "#222";
                ctx.fillStyle = rainbow;
            //    ctx.filter = "hue-rotate(" + game.rgbTimer/3 + "deg)";
                ctx.font = "70px Jura";
                ctx.strokeText("Resume",0,-100);
                ctx.fillText("Resume",0,-100);
                ctx.strokeText("Main Menu",0,100);
                ctx.fillText("Main Menu",0,100);
            //    ctx.filter = "none";

                drawMouse();

                return;
            }

            ctx.save();
            ctx.scale(1.2,1.2)
            ctx.rotate(-Math.PI/10*Math.sin(game.rgbTimer/100));
            ctx.beginPath();
            ctx.fillStyle = menuGradient;
            ctx.fillRect(-2000,-1000,4000,2000);
            ctx.save();
            xPos = -1000+(game.rgbTimer*5)%(unStackablePerks.length*400)-(unStackablePerks.length*400) + 250;
            ctx.translate(xPos, -300);
            for (var i = 0; i < 3; i++) unStackablePerks.forEach( (item, i2) => {
                if (Math.abs(xPos) < 1100) item.drawFunction(true);
                ctx.translate(400,0);
                xPos += 400;
            } );
            ctx.restore();
            ctx.save();
            xPos = -1000+(game.rgbTimer*5)%(unStackablePunishments.length*400)-(unStackablePunishments.length*400) + 100;
            ctx.translate(xPos, 300);
            for (var i = 0; i < 3; i++) unStackablePunishments.forEach( (item, i2) => {
                if (Math.abs(xPos) < 1100) item.drawFunction(true);
                ctx.translate(400,0);
                xPos += 400;
            } );
            ctx.restore();
            ctx.restore();

            ctx.save();
            ctx.translate(200-700*(game.menu == "settings"),0);

            ctx.beginPath();
            let thing = game.rgbTimer%500;
            let thing2 = thing*0.7;
            for (var i = 0; i < 4; i++) {
                ctx.moveTo(thing,0);
                ctx.lineTo(thing2,thing2);
                ctx.lineTo(0,thing);
                ctx.lineTo(-thing2,thing2);
                ctx.lineTo(-thing,0);
                ctx.lineTo(-thing2,-thing2);
                ctx.lineTo(0,-thing);
                ctx.lineTo(thing2,-thing2);
                ctx.closePath();

                thing += 500;
                thing2 = thing*0.7;
            }
            ctx.strokeStyle = "#00000099";
            ctx.lineWidth = game.defaultLineWidth*20;
            ctx.stroke();
            ctx.lineWidth = game.defaultLineWidth;

            ctx.rotate(Math.PI/10*Math.sin(game.rgbTimer/100));

            ctx.strokeStyle = "#333";
            ctx.fillStyle = "#ad7d53";
            ctx.beginPath();
            ctx.arc(0,0,400,0,Math.PI*2);
            ctx.moveTo(-180,0);
            ctx.arc(0,0,350,0,Math.PI*2, true);
            ctx.rect(-375,-25,750,50);
            ctx.rect(-25,0,50,375);
            ctx.stroke();
            ctx.fill();
            
            //reuse of variables
            xPos = 1 + 0.2*(mouse.hover == "drive");
            ctx.strokeStyle = "#333";
            ctx.beginPath();
            ctx.moveTo(-100*xPos,-40*xPos);
            ctx.lineTo(-60*xPos,-80*xPos);
            ctx.lineTo(60*xPos,-80*xPos);
            ctx.lineTo(100*xPos,-40*xPos);
            ctx.lineTo(100*xPos,60*xPos);
            ctx.lineTo(60*xPos,100*xPos);
            ctx.lineTo(-60*xPos,100*xPos);
            ctx.lineTo(-100*xPos,60*xPos);
            ctx.closePath();
            ctx.stroke();
            ctx.fill();

            ctx.beginPath();

            ctx.strokeStyle = "#222";
            //ctx.fillStyle = "#f90";
            ctx.fillStyle = rainbow;
        //    ctx.filter = "hue-rotate(" + game.rgbTimer/3 + "deg)";
            ctx.font = "70px Jura"
            ctx.rotate(-Math.PI/2);

            ctx.rotate(Math.PI/11);
            ctx.strokeText("S",0,-300);
            ctx.fillText("S",0,-300);
            ctx.rotate(Math.PI/11);
            ctx.strokeText("U",0,-300);
            ctx.fillText("U",0,-300);
            ctx.rotate(Math.PI/11);
            ctx.strokeText("B",0,-300);
            ctx.fillText("B",0,-300);
            ctx.rotate(Math.PI/11);
            ctx.strokeText("L",0,-300);
            ctx.fillText("L",0,-300);
            ctx.rotate(Math.PI/11);
            ctx.strokeText("I",0,-300);
            ctx.fillText("I",0,-300);
            ctx.rotate(Math.PI/11);
            ctx.strokeText("M",0,-300);
            ctx.fillText("M",0,-300);
            ctx.rotate(Math.PI/11);
            ctx.strokeText("I",0,-300);
            ctx.fillText("I",0,-300);
            ctx.rotate(Math.PI/11);
            ctx.strokeText("N",0,-300);
            ctx.fillText("N",0,-300);
            ctx.rotate(Math.PI/11);
            ctx.strokeText("A",0,-300);
            ctx.fillText("A",0,-300);
            ctx.rotate(Math.PI/11);
            ctx.strokeText("L",0,-300);
            ctx.fillText("L",0,-300);
            ctx.rotate(Math.PI/11);
            ctx.rotate(-Math.PI/12);
            ctx.strokeText("S",0,300);
            ctx.fillText("S",0,300);
            ctx.rotate(-Math.PI/12);
            ctx.strokeText("T",0,300);
            ctx.fillText("T",0,300);
            ctx.rotate(-Math.PI/12);
            ctx.strokeText("I",0,300);
            ctx.fillText("I",0,300);
            ctx.rotate(-Math.PI/12);
            ctx.strokeText("C",0,300);
            ctx.fillText("C",0,300);
            ctx.rotate(-Math.PI/12);
            ctx.strokeText("K",0,300);
            ctx.fillText("K",0,300);
            ctx.rotate(-Math.PI/6);
            ctx.strokeText("S",0,300);
            ctx.fillText("S",0,300);
            ctx.rotate(-Math.PI/12);
            ctx.strokeText("H",0,300);
            ctx.fillText("H",0,300);
            ctx.rotate(-Math.PI/12);
            ctx.strokeText("I",0,300);
            ctx.fillText("I",0,300);
            ctx.rotate(-Math.PI/12);
            ctx.strokeText("F",0,300);
            ctx.fillText("F",0,300);
            ctx.rotate(-Math.PI/12);
            ctx.strokeText("T",0,300);
            ctx.fillText("T",0,300);
            ctx.rotate(-Math.PI/12);
            ctx.rotate(Math.PI/2);
            ctx.font = (60 + 10*(mouse.hover == "drive")) + "px Jura"
            ctx.strokeText("DRIVE",0,10);
            ctx.fillText("DRIVE",0,10);

        //    ctx.filter = "none";

            ctx.restore();

            ctx.beginPath();
            ctx.strokeStyle = "#333";
            ctx.fillStyle = "#ad7d53";
            thing = -700*(game.menu == "settings")-(mouse.hover == "menu1" && game.menu == "main")*50 - 175
            ctx.moveTo(thing, -250);
            ctx.lineTo(thing+100, -350);
            ctx.lineTo(thing-400, -350);
            ctx.lineTo(thing-500, -250);
            ctx.closePath();
            thing = -700*(game.menu == "settings")-(mouse.hover == "menu2" && game.menu == "main")*50 - 235
            ctx.moveTo(thing, -100);
            ctx.lineTo(thing+35, -200);
            ctx.lineTo(thing-465, -200);
            ctx.lineTo(thing-500, -100);
            ctx.closePath();
            thing = -700*(game.menu == "settings")-(mouse.hover == "menu3" && game.menu == "main")*50 - 245
            ctx.moveTo(thing, -50);
            ctx.lineTo(thing, 50);
            ctx.lineTo(thing-500, 50);
            ctx.lineTo(thing-500, -50);
            ctx.closePath();
            thing = -700*(game.menu == "settings")-(mouse.hover == "menu4" && game.menu == "main")*50 - 235
            ctx.moveTo(thing, 100);
            ctx.lineTo(thing+35, 200);
            ctx.lineTo(thing-465, 200);
            ctx.lineTo(thing-500, 100);
            ctx.closePath();
            thing = -700*(game.menu == "settings")-(mouse.hover == "menu5" && game.menu == "main")*50 - 175
            ctx.moveTo(thing, 250);
            ctx.lineTo(thing+100, 350);
            ctx.lineTo(thing-400, 350);
            ctx.lineTo(thing-500, 250);
            ctx.closePath();
            ctx.stroke();
            ctx.fill();

            ctx.beginPath();
            ctx.strokeStyle = "#222";
            ctx.fillStyle = rainbow;
        //    ctx.filter = "hue-rotate(" + game.rgbTimer/3 + "deg)";
            ctx.font = "70px Jura";
            ctx.strokeText("Settings",-700*(game.menu == "settings")-400-(mouse.hover == "menu1")*50,-300);
            ctx.fillText("Settings",-700*(game.menu == "settings")-400-(mouse.hover == "menu1")*50,-300);
            ctx.strokeText("Unlocks",-700*(game.menu == "settings")-475-(mouse.hover == "menu2")*50,-150);
            ctx.fillText("Unlocks",-700*(game.menu == "settings")-475-(mouse.hover == "menu2")*50,-150);
            ctx.strokeText("Discord",-700*(game.menu == "settings")-500-(mouse.hover == "menu3")*50,0);
            ctx.fillText("Discord",-700*(game.menu == "settings")-500-(mouse.hover == "menu3")*50,0);
            ctx.strokeText("Credits",-700*(game.menu == "settings")-475-(mouse.hover == "menu4")*50,150);
            ctx.fillText("Credits",-700*(game.menu == "settings")-475-(mouse.hover == "menu4")*50,150);
            ctx.strokeText("Quit",-700*(game.menu == "settings")-400-(mouse.hover == "menu5")*50,300);
            ctx.fillText("Quit",-700*(game.menu == "settings")-400-(mouse.hover == "menu5")*50,300);
        //    ctx.filter = "none";

            if (game.menu == "settings") {
                ctx.beginPath();
                ctx.strokeStyle = "#333";
                ctx.fillStyle = "#ad7d53";
                thing = (mouse.hover == "menu1")*50 + 175 - 300;
                ctx.moveTo(thing, -250);
                ctx.lineTo(thing-100, -350);
                ctx.lineTo(thing+800, -350);
                ctx.lineTo(thing+900, -250);
                ctx.closePath();
                thing = (mouse.hover == "menu2" || game.subMenu == "menu2")*50 + 235 - 300;
                ctx.moveTo(thing, -100);
                ctx.lineTo(thing-35, -200);
                ctx.lineTo(thing+165, -200);
                ctx.lineTo(thing+200, -100);
                ctx.closePath();
                thing = (mouse.hover == "menu3" || game.subMenu == "menu3")*50 + 245 - 300;
                ctx.moveTo(thing, -50);
                ctx.lineTo(thing, 50);
                ctx.lineTo(thing+200, 50);
                ctx.lineTo(thing+200, -50);
                ctx.closePath();
                thing = (mouse.hover == "menu4" || game.subMenu == "menu4")*50 + 235 - 300;
                ctx.moveTo(thing, 100);
                ctx.lineTo(thing-35, 200);
                ctx.lineTo(thing+165, 200);
                ctx.lineTo(thing+200, 100);
                ctx.closePath();
                thing = (mouse.hover == "menu5" || game.subMenu == "menu5")*50 + 175 - 300;
                ctx.moveTo(thing, 250);
                ctx.lineTo(thing-100, 350);
                ctx.lineTo(thing+100, 350);
                ctx.lineTo(thing+200, 250);
                ctx.closePath();
                ctx.stroke();
                ctx.fill();
                
                ctx.beginPath();
                ctx.strokeStyle = "#222";
                ctx.fillStyle = rainbow;
            //    ctx.filter = "hue-rotate(" + game.timer/3 + "deg)";
                ctx.font = "70px Jura";
                ctx.strokeText("Back",-700*(game.menu == "settings")+1000+(mouse.hover == "menu1")*50,-300);
                ctx.fillText("Back",-700*(game.menu == "settings")+1000+(mouse.hover == "menu1")*50,-300);
                ctx.strokeText("VID",-700*(game.menu == "settings")+725+(mouse.hover == "menu2" || game.subMenu == "menu2")*50,-150);
                ctx.fillText("VID",-700*(game.menu == "settings")+725+(mouse.hover == "menu2" || game.subMenu == "menu2")*50,-150);
                ctx.strokeText("AUD",-700*(game.menu == "settings")+750+(mouse.hover == "menu3" || game.subMenu == "menu3")*50,0);
                ctx.fillText("AUD",-700*(game.menu == "settings")+750+(mouse.hover == "menu3" || game.subMenu == "menu3")*50,0);
                ctx.strokeText("GAM",-700*(game.menu == "settings")+725+(mouse.hover == "menu4" || game.subMenu == "menu4")*50,150);
                ctx.fillText("GAM",-700*(game.menu == "settings")+725+(mouse.hover == "menu4" || game.subMenu == "menu4")*50,150);
                ctx.strokeText("CHT",-700*(game.menu == "settings")+640+(mouse.hover == "menu5" || game.subMenu == "menu5")*50,300);
                ctx.fillText("CHT",-700*(game.menu == "settings")+640+(mouse.hover == "menu5" || game.subMenu == "menu5")*50,300);
            //    ctx.filter = "none";

                if (game.subMenu) {
                    ctx.beginPath();
                    ctx.strokeStyle = "#333";
                    ctx.fillStyle = "#ad7d53";
                    ctx.moveTo(200, -200);
                    ctx.lineTo(235, -100);
                    ctx.lineTo(245, -50);
                    ctx.lineTo(245, 50);
                    ctx.lineTo(235, 100);
                    ctx.lineTo(200, 200);
                    ctx.lineTo(175, 250);
                    ctx.lineTo(75, 350);

                    ctx.lineTo(675, 350);
                    ctx.lineTo(775, 250);
                    ctx.lineTo(800, 200);
                    ctx.lineTo(835, 100);
                    ctx.lineTo(845, 50);
                    ctx.lineTo(845, -50);
                    ctx.lineTo(835, -100);
                    ctx.lineTo(800, -200);
                    ctx.closePath();
                    ctx.stroke();
                    ctx.fill();

                    if (game.subMenu == "menu2") {
                        ctx.beginPath();
                        ctx.strokeStyle = "#222";
                        ctx.fillStyle = rainbow;
                    //    ctx.filter = "hue-rotate(" + game.timer/3 + "deg)";
                        ctx.font = "40px Jura";
                        ctx.strokeText("Ctrl +/-",500,-150);
                        ctx.fillText("Ctrl +/-",500,-150);
                        ctx.strokeText("F11",525,0);
                        ctx.fillText("F11",525,0);
                        ctx.font = "30px Jura";
                        ctx.strokeText("decrease/increase resolution",525,-100);
                        ctx.fillText("decrease/increase resolution",525,-100);
                        ctx.strokeText("Toggle fullscreen",525,50);
                        ctx.fillText("Toggle fullscreen",525,50);
                    //    ctx.filter = "none";
                    } else if (game.subMenu == "menu3") {
                        ctx.beginPath();
                        ctx.strokeStyle = "#222";
                        ctx.fillStyle = rainbow;
                    //    ctx.filter = "hue-rotate(" + game.timer/3 + "deg)";
                        ctx.font = "60px Jura";
                        ctx.strokeText("Master",500,-150);
                        ctx.fillText("Master",500,-150);
                        ctx.strokeText("Music",525,25);
                        ctx.fillText("Music",525,25);
                        ctx.strokeText("Sfx",450,200);
                        ctx.fillText("Sfx",450,200);

                        ctx.beginPath();
                        ctx.moveTo(300,-75);
                        ctx.lineTo(700,-75);
                        ctx.moveTo(325,100);
                        ctx.lineTo(725,100);
                        ctx.moveTo(250,275);
                        ctx.lineTo(650,275);
                        ctx.moveTo(300+400*game.masterVolume,-85);
                        ctx.lineTo(300+400*game.masterVolume,-65);
                        ctx.moveTo(325+400*game.musicVolume,90);
                        ctx.lineTo(325+400*game.musicVolume,110);
                        ctx.moveTo(250+400*game.sfxVolume,265);
                        ctx.lineTo(250+400*game.sfxVolume,285);
                        ctx.lineWidth = game.defaultLineWidth*2;
                        ctx.stroke();
                        ctx.lineWidth = game.defaultLineWidth;
                        ctx.strokeStyle = ctx.fillStyle;
                        ctx.stroke();
                        
                    //    ctx.filter = "none";
                    }
                }
            }

            drawMouse();
        }

        //stats.pLaneChange = true;
    </script>
    <script>
        //music handling
        let song = new Audio('PlaStick.ogg');
        song.loop = true;
        song.volume = 0.5;
        let engineRev = new Audio('Engine Rev.ogg');
        engineRev.loop = true;
        engineRev.volume = 0.2;
        let horn = new Audio('Horn.ogg');
        horn.loop = true;
        horn.volume = 0.75;

        let songAuthor = "PlaStick - BetaFail";

        const check = () => {
            if (mouse.down) {
                song.play();
            } else {
                setTimeout(check, 200);
            }
        };
        check();

        //update rev
        setInterval(() => {
            engineRev.volume = 0.10*game.masterVolume*game.sfxVolume;
            horn.volume = 0.75*game.masterVolume*game.sfxVolume;
            engineRev.playbackRate = 1 + Math.abs(car.speed)/60;
            song.volume = (0.6+0.4*(song.src.includes("PlaStick") || song.src.includes("Stick-City")))*game.audioVolume*game.masterVolume*game.musicVolume;
        },100)

        if (1) {
            generatePlatformRoad(stats.roadLength/stats.roadSize);

            calculateRoadPerspectivePoints();

            if (navigator.userAgent.toLowerCase().includes("firefox")) startAnimating(60);
            else setInterval( () => { tickloop() }, 16.66);
        } else setInterval( () => {
            drawSkybox();
            drawDash();

            ctx.beginPath();
            ctx.fillStyle = "#ffffff33";
            ctx.rect(-1000,-1000,3500,3600);
            ctx.fill();
            ctx.beginPath();
            
            generatePlatformRoad(stats.roadLength/stats.roadSize);
            
            //stackablePerks[4].drawFunction();
            //unStackablePerks[14].drawFunction();
            //stackablePunishments[7].drawFunction();
            unStackablePunishments[18].drawFunction()
        },100)
    </script>
</body>
</html>
